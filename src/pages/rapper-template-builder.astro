---
/**
 * rapper-template-builder.astro
 * SVG Template Builder for Rapper PFP Cards
 *
 * Features:
 * - Geodesic angular face styling
 * - Male & Female variations
 * - Animal spirit overlays (Chicken, Cat, Goat, Pigeon)
 * - Customizable: hair, accessories, expressions, colors
 */
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Rapper PFP Template Builder"
  description="Create and customize angular geodesic rapper PFP cards"
  activeSection="templates"
>

<div class="template-builder-container">
  <div class="container mx-auto">

    <!-- Header -->
    <div class="builder-header">
      <h1 class="builder-title">Rapper PFP Template Builder</h1>
      <p class="builder-subtitle">Geodesic Angular Design ‚Ä¢ Animal Spirits ‚Ä¢ Customizable Everything</p>
    </div>

    <!-- Controls Panel -->
    <div class="controls-panel">
      <div class="control-section">
        <h3 class="control-title">Base Style</h3>
        <div class="control-group">
          <label class="control-label">
            <input type="radio" name="gender" value="male" checked onchange="updateTemplate()" />
            <span>Male Rapper</span>
          </label>
          <label class="control-label">
            <input type="radio" name="gender" value="female" onchange="updateTemplate()" />
            <span>Female Rapper</span>
          </label>
        </div>
      </div>

      <div class="control-section">
        <h3 class="control-title">Animal Spirit</h3>
        <div class="animal-spirit-grid">
          <div class="spirit-category">
            <h4 class="spirit-category-title">Farm Spirits</h4>
            <label class="control-label">
              <input type="radio" name="animal" value="chicken" checked onchange="updateTemplate()" />
              <span>üêì Chicken</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="cat" onchange="updateTemplate()" />
              <span>üê± Cat</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="goat" onchange="updateTemplate()" />
              <span>üêê Goat</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="dog" onchange="updateTemplate()" />
              <span>üêï Dog</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="bunny" onchange="updateTemplate()" />
              <span>üê∞ Bunny</span>
            </label>
          </div>

          <div class="spirit-category">
            <h4 class="spirit-category-title">Sky Spirits</h4>
            <label class="control-label">
              <input type="radio" name="animal" value="pigeon" onchange="updateTemplate()" />
              <span>üïäÔ∏è Pigeon</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="cooperhawk" onchange="updateTemplate()" />
              <span>ü¶Ö Cooper's Hawk</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="eagle" onchange="updateTemplate()" />
              <span>ü¶Ö Eagle</span>
            </label>
          </div>

          <div class="spirit-category">
            <h4 class="spirit-category-title">Wild Spirits</h4>
            <label class="control-label">
              <input type="radio" name="animal" value="lion" onchange="updateTemplate()" />
              <span>ü¶Å Lion</span>
            </label>
            <label class="control-label">
              <input type="radio" name="animal" value="coywolf" onchange="updateTemplate()" />
              <span>üê∫ Coywolf</span>
            </label>
          </div>
        </div>
      </div>

      <div class="control-section">
        <h3 class="control-title">Hairstyle</h3>
        <select id="hairstyle" onchange="updateTemplate()" class="control-select">
          <option value="dreads">Dreadlocks</option>
          <option value="fade">Fade Cut</option>
          <option value="afro">Afro</option>
          <option value="braids">Braids</option>
          <option value="bun">Top Bun</option>
          <option value="waves">Waves</option>
        </select>
      </div>

      <div class="control-section">
        <h3 class="control-title">Accessories</h3>
        <label class="control-checkbox">
          <input type="checkbox" id="sunglasses" onchange="updateTemplate()" checked />
          <span>Sunglasses</span>
        </label>
        <label class="control-checkbox">
          <input type="checkbox" id="chain" onchange="updateTemplate()" checked />
          <span>Gold Chain</span>
        </label>
        <label class="control-checkbox">
          <input type="checkbox" id="earrings" onchange="updateTemplate()" checked />
          <span>Diamond Earrings</span>
        </label>
        <label class="control-checkbox">
          <input type="checkbox" id="hat" onchange="updateTemplate()" />
          <span>Hat/Cap</span>
        </label>
      </div>

      <div class="control-section">
        <h3 class="control-title">Skin Tone</h3>
        <div class="color-picker-group">
          <button class="color-btn" data-color="#3d2817" onclick="setSkinTone(this)"></button>
          <button class="color-btn" data-color="#5c3d2e" onclick="setSkinTone(this)"></button>
          <button class="color-btn" data-color="#8d5524" onclick="setSkinTone(this)"></button>
          <button class="color-btn" data-color="#c68642" onclick="setSkinTone(this)"></button>
          <button class="color-btn" data-color="#e0ac69" onclick="setSkinTone(this)"></button>
          <button class="color-btn" data-color="#f1c27d" onclick="setSkinTone(this)"></button>
        </div>
      </div>

      <div class="control-section">
        <button class="btn-generate" onclick="generateRandom()">üé≤ Generate Random</button>
        <button class="btn-export" onclick="exportSVG()">üíæ Export SVG</button>
      </div>
    </div>

    <!-- SVG Preview -->
    <div class="preview-panel">
      <h3 class="preview-title">Live Preview</h3>
      <div id="svg-container" class="svg-container">
        <!-- SVG will be injected here -->
      </div>
    </div>

    <!-- Template Variations Gallery -->
    <div class="variations-gallery">
      <h2 class="gallery-title">Example Variations</h2>
      <div class="gallery-grid">
        <!-- Examples will be generated -->
      </div>
    </div>

  </div>
</div>

<script>
  let currentConfig = {
    gender: 'male',
    animal: 'chicken',
    hairstyle: 'dreads',
    sunglasses: true,
    chain: true,
    earrings: true,
    hat: false,
    skinTone: '#8d5524'
  };

  // Generate SVG template based on config
  function generateSVG(config) {
    const skinTone = config.skinTone;
    const shadowTone = adjustBrightness(skinTone, -30);
    const highlightTone = adjustBrightness(skinTone, 20);

    return `
<svg viewBox="0 0 400 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Gradients -->
    <linearGradient id="skinGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:${highlightTone}" />
      <stop offset="100%" style="stop-color:${skinTone}" />
    </linearGradient>

    <radialGradient id="faceGlow" cx="50%" cy="40%">
      <stop offset="0%" style="stop-color:${highlightTone};stop-opacity:0.4" />
      <stop offset="100%" style="stop-color:${skinTone};stop-opacity:0" />
    </radialGradient>

    <filter id="shadow">
      <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
      <feOffset dx="2" dy="2" result="offsetblur"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.5"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <!-- Animal Spirit Pattern -->
    ${getAnimalPattern(config.animal)}
  </defs>

  <!-- Background -->
  <rect width="400" height="500" fill="url(#animalPattern)" opacity="0.15"/>
  <rect width="400" height="500" fill="linear-gradient(135deg, #1a1a2e 0%, #2d1b4e 100%)"/>

  <!-- Geodesic Face Structure -->
  ${getGeodesicFace(config, skinTone, shadowTone)}

  <!-- Facial Features -->
  ${getFacialFeatures(config)}

  <!-- Hair -->
  ${getHairstyle(config)}

  <!-- Accessories -->
  ${config.sunglasses ? getSunglasses(config) : ''}
  ${config.chain ? getChain(config) : ''}
  ${config.earrings ? getEarrings(config) : ''}
  ${config.hat ? getHat(config) : ''}

  <!-- Animal Spirit Overlay -->
  ${getAnimalSpirit(config)}
</svg>
    `.trim();
  }

  // Geodesic angular face using polygons
  function getGeodesicFace(config, skinTone, shadowTone) {
    const isFemale = config.gender === 'female';

    // Female faces are more rounded/softer, male more angular
    if (isFemale) {
      return `
  <!-- Female Geodesic Face -->
  <g id="face" filter="url(#shadow)">
    <!-- Main face polygon (softer angles) -->
    <polygon points="200,120 250,140 270,180 265,240 240,280 200,295 160,280 135,240 130,180 150,140"
             fill="url(#skinGradient)" stroke="${shadowTone}" stroke-width="2"/>

    <!-- Cheekbones highlight -->
    <polygon points="160,200 180,190 200,195 180,210" fill="${adjustBrightness(skinTone, 15)}" opacity="0.6"/>
    <polygon points="220,190 240,200 220,210 200,195" fill="${adjustBrightness(skinTone, 15)}" opacity="0.6"/>

    <!-- Jaw definition -->
    <polygon points="200,260 220,270 200,280 180,270" fill="${shadowTone}" opacity="0.3"/>

    <!-- Forehead facets -->
    <polygon points="170,140 200,135 230,140 200,155" fill="${adjustBrightness(skinTone, 10)}" opacity="0.5"/>

    <!-- Nose bridge (angular) -->
    <polygon points="195,180 205,180 203,210 197,210" fill="${shadowTone}" opacity="0.4"/>
    <polygon points="190,210 210,210 205,225 195,225" fill="${shadowTone}" opacity="0.5"/>
  </g>
      `;
    } else {
      return `
  <!-- Male Geodesic Face -->
  <g id="face" filter="url(#shadow)">
    <!-- Main face polygon (sharp angles) -->
    <polygon points="200,115 255,135 280,175 275,235 250,285 200,300 150,285 125,235 120,175 145,135"
             fill="url(#skinGradient)" stroke="${shadowTone}" stroke-width="2"/>

    <!-- Strong jawline -->
    <polygon points="150,260 175,275 200,280 225,275 250,260 200,285" fill="${shadowTone}" opacity="0.4"/>

    <!-- Cheekbones (sharp) -->
    <polygon points="155,200 175,185 185,200 170,210" fill="${adjustBrightness(skinTone, 15)}" opacity="0.5"/>
    <polygon points="215,185 245,200 230,210 215,200" fill="${adjustBrightness(skinTone, 15)}" opacity="0.5"/>

    <!-- Forehead planes -->
    <polygon points="165,140 200,130 235,140 200,150" fill="${adjustBrightness(skinTone, 10)}" opacity="0.6"/>
    <polygon points="145,155 165,145 175,165 160,170" fill="${shadowTone}" opacity="0.3"/>
    <polygon points="235,145 255,155 240,170 225,165" fill="${shadowTone}" opacity="0.3"/>

    <!-- Angular nose -->
    <polygon points="193,175 207,175 210,215 190,215" fill="${shadowTone}" opacity="0.5"/>
    <polygon points="187,215 213,215 208,230 192,230" fill="${shadowTone}" opacity="0.6"/>

    <!-- Brow ridge -->
    <polygon points="155,170 175,165 180,175 165,180" fill="${shadowTone}" opacity="0.4"/>
    <polygon points="225,165 245,170 235,180 220,175" fill="${shadowTone}" opacity="0.4"/>
  </g>
      `;
    }
  }

  // Facial features (eyes, mouth, etc)
  function getFacialFeatures(config) {
    const isFemale = config.gender === 'female';

    return `
  <g id="facial-features">
    <!-- Eyes (geometric) -->
    <g id="eyes">
      <!-- Left eye -->
      <polygon points="165,185 180,183 183,195 165,193" fill="white" opacity="0.9"/>
      <circle cx="172" cy="189" r="6" fill="#1a1a2e"/>
      <circle cx="174" cy="187" r="2" fill="white" opacity="0.8"/>

      <!-- Right eye -->
      <polygon points="217,183 232,185 235,193 217,195" fill="white" opacity="0.9"/>
      <circle cx="228" cy="189" r="6" fill="#1a1a2e"/>
      <circle cx="230" cy="187" r="2" fill="white" opacity="0.8"/>

      <!-- Eyebrows (angular) -->
      <polygon points="160,175 185,170 183,173 162,178" fill="#1a1a2e" opacity="0.8"/>
      <polygon points="215,170 240,175 238,178 217,173" fill="#1a1a2e" opacity="0.8"/>
    </g>

    <!-- Nose tip -->
    <polygon points="197,228 203,228 202,235 198,235" fill="#1a1a2e" opacity="0.2"/>

    <!-- Mouth -->
    ${isFemale ?
      `<path d="M 180,250 Q 200,258 220,250" stroke="#c73866" stroke-width="3" fill="none" opacity="0.8"/>
       <path d="M 180,250 Q 200,255 220,250" stroke="#ff6b9d" stroke-width="1.5" fill="none" opacity="0.6"/>` :
      `<path d="M 180,255 Q 200,260 220,255" stroke="#1a1a2e" stroke-width="3" fill="none" opacity="0.6"/>
       <polygon points="190,256 210,256 208,260 192,260" fill="#1a1a2e" opacity="0.1"/>`
    }
  </g>
    `;
  }

  // Hairstyles
  function getHairstyle(config) {
    const styles = {
      dreads: `
  <g id="hair-dreads">
    <!-- Dreadlocks -->
    <ellipse cx="160" cy="130" rx="8" ry="45" fill="#1a1a2e" opacity="0.9" transform="rotate(-20 160 130)"/>
    <ellipse cx="175" cy="125" rx="8" ry="50" fill="#1a1a2e" opacity="0.9" transform="rotate(-10 175 125)"/>
    <ellipse cx="190" cy="120" rx="8" ry="55" fill="#1a1a2e" opacity="0.9"/>
    <ellipse cx="210" cy="120" rx="8" ry="55" fill="#1a1a2e" opacity="0.9"/>
    <ellipse cx="225" cy="125" rx="8" ry="50" fill="#1a1a2e" opacity="0.9" transform="rotate(10 225 125)"/>
    <ellipse cx="240" cy="130" rx="8" ry="45" fill="#1a1a2e" opacity="0.9" transform="rotate(20 240 130)"/>

    <!-- Hair ties/beads -->
    <rect x="187" y="145" width="6" height="4" fill="#ffd700" rx="2"/>
    <rect x="207" y="145" width="6" height="4" fill="#ffd700" rx="2"/>
  </g>
      `,
      fade: `
  <g id="hair-fade">
    <!-- Fade cut (geometric) -->
    <path d="M 145,150 Q 170,115 200,110 Q 230,115 255,150" fill="#1a1a2e" opacity="0.9"/>
    <polygon points="200,110 220,115 210,125 190,125 180,115" fill="#1a1a2e"/>
    <!-- Waves on top -->
    <path d="M 170,120 Q 185,115 200,118 Q 215,115 230,120" stroke="#0a0a0f" stroke-width="2" fill="none" opacity="0.6"/>
  </g>
      `,
      afro: `
  <g id="hair-afro">
    <!-- Afro (geodesic bubble) -->
    <circle cx="200" cy="110" r="70" fill="#1a1a2e" opacity="0.95"/>
    <polygon points="200,60 220,70 230,90 225,110 200,120" fill="#0a0a0f" opacity="0.3"/>
    <polygon points="200,60 180,70 170,90 175,110 200,120" fill="#0a0a0f" opacity="0.3"/>
    <!-- Texture -->
    ${Array.from({length: 20}, (_, i) => {
      const angle = (i / 20) * Math.PI * 2;
      const x = 200 + Math.cos(angle) * 60;
      const y = 110 + Math.sin(angle) * 60;
      return `<circle cx="${x}" cy="${y}" r="3" fill="#0a0a0f" opacity="0.4"/>`;
    }).join('')}
  </g>
      `,
      braids: `
  <g id="hair-braids">
    <!-- Cornrow braids -->
    ${Array.from({length: 8}, (_, i) => {
      const x = 140 + (i * 15);
      return `
        <path d="M ${x},140 Q ${x},110 ${x + 5},80 L ${x + 5},180"
              stroke="#1a1a2e" stroke-width="7" fill="none" opacity="0.9"/>
        <path d="M ${x},140 Q ${x},110 ${x + 5},80"
              stroke="#0a0a0f" stroke-width="2" fill="none" opacity="0.5"/>
      `;
    }).join('')}
  </g>
      `,
      bun: `
  <g id="hair-bun">
    <!-- Top bun -->
    <circle cx="200" cy="90" r="25" fill="#1a1a2e" opacity="0.95"/>
    <ellipse cx="200" cy="90" rx="22" ry="18" fill="#0a0a0f" opacity="0.4"/>
    <!-- Wrap/tie -->
    <ellipse cx="200" cy="90" rx="25" ry="5" fill="#ffd700" opacity="0.8"/>
    <!-- Edges -->
    <path d="M 145,140 Q 150,125 155,140" stroke="#1a1a2e" stroke-width="3" fill="none"/>
    <path d="M 255,140 Q 250,125 245,140" stroke="#1a1a2e" stroke-width="3" fill="none"/>
  </g>
      `,
      waves: `
  <g id="hair-waves">
    <!-- Wave pattern (low cut with waves) -->
    <path d="M 145,145 Q 172,120 200,115 Q 228,120 255,145" fill="#1a1a2e" opacity="0.9"/>
    <!-- Wave lines -->
    <path d="M 160,135 Q 180,130 200,133 Q 220,130 240,135" stroke="#0a0a0f" stroke-width="2" fill="none" opacity="0.6"/>
    <path d="M 165,140 Q 182,136 200,138 Q 218,136 235,140" stroke="#0a0a0f" stroke-width="2" fill="none" opacity="0.5"/>
    <path d="M 170,145 Q 185,142 200,143 Q 215,142 230,145" stroke="#0a0a0f" stroke-width="2" fill="none" opacity="0.4"/>
  </g>
      `
    };

    return styles[config.hairstyle] || styles.dreads;
  }

  // Sunglasses
  function getSunglasses(config) {
    return `
  <g id="sunglasses" opacity="0.95">
    <!-- Frame -->
    <rect x="155" y="180" width="35" height="20" rx="3" fill="#1a1a2e" stroke="#0a0a0f" stroke-width="2"/>
    <rect x="210" y="180" width="35" height="20" rx="3" fill="#1a1a2e" stroke="#0a0a0f" stroke-width="2"/>
    <!-- Bridge -->
    <rect x="190" y="187" width="20" height="4" rx="2" fill="#0a0a0f"/>
    <!-- Lens shine -->
    <polygon points="160,183 170,183 168,187 162,187" fill="#667eea" opacity="0.3"/>
    <polygon points="215,183 225,183 223,187 217,187" fill="#667eea" opacity="0.3"/>
    <!-- Arms -->
    <path d="M 155,190 L 145,195" stroke="#0a0a0f" stroke-width="3"/>
    <path d="M 245,190 L 255,195" stroke="#0a0a0f" stroke-width="3"/>
  </g>
    `;
  }

  // Gold chain
  function getChain(config) {
    return `
  <g id="chain">
    <!-- Chain links -->
    <ellipse cx="200" cy="310" rx="35" ry="40" fill="none" stroke="#ffd700" stroke-width="6" opacity="0.9"/>
    <ellipse cx="200" cy="310" rx="32" ry="37" fill="none" stroke="#ffed4e" stroke-width="2" opacity="0.7"/>

    <!-- Pendant (W for WorldBridge) -->
    <polygon points="200,335 185,345 190,360 200,355 210,360 215,345" fill="#ffd700" stroke="#b8860b" stroke-width="2"/>
    <text x="200" y="356" font-family="Arial Black" font-size="14" font-weight="bold" fill="#1a1a2e" text-anchor="middle">W</text>

    <!-- Chain highlight -->
    <path d="M 180,295 Q 200,290 220,295" stroke="#ffed4e" stroke-width="2" fill="none" opacity="0.6"/>
  </g>
    `;
  }

  // Diamond earrings
  function getEarrings(config) {
    return `
  <g id="earrings">
    <!-- Left earring -->
    <g transform="translate(150, 210)">
      <polygon points="0,0 -4,6 0,10 4,6" fill="#00d4ff" opacity="0.9"/>
      <polygon points="0,2 -2,5 0,8 2,5" fill="#ffffff" opacity="0.6"/>
      <line x1="0" y1="0" x2="0" y2="-3" stroke="#c0c0c0" stroke-width="1"/>
    </g>

    <!-- Right earring -->
    <g transform="translate(250, 210)">
      <polygon points="0,0 -4,6 0,10 4,6" fill="#00d4ff" opacity="0.9"/>
      <polygon points="0,2 -2,5 0,8 2,5" fill="#ffffff" opacity="0.6"/>
      <line x1="0" y1="0" x2="0" y2="-3" stroke="#c0c0c0" stroke-width="1"/>
    </g>
  </g>
    `;
  }

  // Hat
  function getHat(config) {
    return `
  <g id="hat">
    <!-- Snapback cap -->
    <ellipse cx="200" cy="115" rx="65" ry="15" fill="#1a1a2e"/>
    <path d="M 135,115 Q 200,85 265,115" fill="#dc2626" opacity="0.9"/>
    <polygon points="200,90 220,100 200,105 180,100" fill="#7c2d12" opacity="0.6"/>
    <!-- Logo/emblem -->
    <circle cx="200" cy="100" r="8" fill="#ffd700" opacity="0.9"/>
    <text x="200" y="105" font-family="Arial Black" font-size="10" font-weight="bold" fill="#1a1a2e" text-anchor="middle">$</text>
    <!-- Bill -->
    <polygon points="200,115 250,120 245,125 200,120" fill="#1a1a2e" opacity="0.8"/>
  </g>
    `;
  }

  // Animal spirit overlays
  function getAnimalSpirit(config) {
    const spirits = {
      chicken: `
  <g id="spirit-chicken" opacity="0.25">
    <!-- Chicken comb -->
    <path d="M 185,100 L 190,85 L 195,95 L 200,80 L 205,95 L 210,85 L 215,100"
          fill="#dc2626" stroke="#991b1b" stroke-width="1"/>
    <!-- Feather pattern -->
    ${Array.from({length: 5}, (_, i) => `
      <path d="M ${170 + i*15},130 Q ${175 + i*15},120 ${180 + i*15},130"
            stroke="#f59e0b" stroke-width="1" fill="none" opacity="0.6"/>
    `).join('')}
  </g>
      `,
      cat: `
  <g id="spirit-cat" opacity="0.25">
    <!-- Cat ears -->
    <polygon points="155,115 165,80 175,115" fill="#6b7280" stroke="#374151" stroke-width="1"/>
    <polygon points="225,115 235,80 245,115" fill="#6b7280" stroke="#374151" stroke-width="1"/>
    <polygon points="160,110 165,90 170,110" fill="#fbbf24" opacity="0.6"/>
    <polygon points="230,110 235,90 240,110" fill="#fbbf24" opacity="0.6"/>
    <!-- Whiskers -->
    <line x1="145" y1="215" x2="120" y2="210" stroke="#374151" stroke-width="1"/>
    <line x1="145" y1="220" x2="120" y2="220" stroke="#374151" stroke-width="1"/>
    <line x1="255" y1="215" x2="280" y2="210" stroke="#374151" stroke-width="1"/>
    <line x1="255" y1="220" x2="280" y2="220" stroke="#374151" stroke-width="1"/>
  </g>
      `,
      goat: `
  <g id="spirit-goat" opacity="0.25">
    <!-- Goat horns -->
    <path d="M 155,120 Q 140,90 145,70" stroke="#4b5563" stroke-width="6" fill="none" stroke-linecap="round"/>
    <path d="M 245,120 Q 260,90 255,70" stroke="#4b5563" stroke-width="6" fill="none" stroke-linecap="round"/>
    <path d="M 155,120 Q 142,95 146,75" stroke="#6b7280" stroke-width="3" fill="none"/>
    <path d="M 245,120 Q 258,95 254,75" stroke="#6b7280" stroke-width="3" fill="none"/>
    <!-- Goatee -->
    <polygon points="200,270 195,285 200,295 205,285" fill="#1a1a2e" opacity="0.8"/>
  </g>
      `,
      dog: `
  <g id="spirit-dog" opacity="0.25">
    <!-- Dog ears (floppy) -->
    <ellipse cx="150" cy="140" rx="15" ry="35" fill="#8b4513" opacity="0.8" transform="rotate(-25 150 140)"/>
    <ellipse cx="250" cy="140" rx="15" ry="35" fill="#8b4513" opacity="0.8" transform="rotate(25 250 140)"/>
    <ellipse cx="150" cy="140" rx="10" ry="28" fill="#a0522d" opacity="0.6" transform="rotate(-25 150 140)"/>
    <ellipse cx="250" cy="140" rx="10" ry="28" fill="#a0522d" opacity="0.6" transform="rotate(25 250 140)"/>
    <!-- Loyal markings (spots) -->
    <circle cx="170" cy="160" r="8" fill="#654321" opacity="0.5"/>
    <circle cx="230" cy="160" r="8" fill="#654321" opacity="0.5"/>
    <!-- Nose enhancement -->
    <ellipse cx="200" cy="235" rx="8" ry="6" fill="#1a1a2e" opacity="0.6"/>
  </g>
      `,
      bunny: `
  <g id="spirit-bunny" opacity="0.25">
    <!-- Long bunny ears -->
    <ellipse cx="165" cy="75" rx="12" ry="55" fill="#fbbf24" opacity="0.7" transform="rotate(-15 165 75)"/>
    <ellipse cx="235" cy="75" rx="12" ry="55" fill="#fbbf24" opacity="0.7" transform="rotate(15 235 75)"/>
    <ellipse cx="165" cy="75" rx="7" ry="45" fill="#fde68a" opacity="0.5" transform="rotate(-15 165 75)"/>
    <ellipse cx="235" cy="75" rx="7" ry="45" fill="#fde68a" opacity="0.5" transform="rotate(15 235 75)"/>
    <!-- Fluffy cheeks -->
    <circle cx="155" cy="215" r="12" fill="#f3f4f6" opacity="0.4"/>
    <circle cx="245" cy="215" r="12" fill="#f3f4f6" opacity="0.4"/>
    <!-- Whiskers (delicate) -->
    <line x1="150" y1="215" x2="125" y2="213" stroke="#d1d5db" stroke-width="1" opacity="0.7"/>
    <line x1="150" y1="220" x2="125" y2="220" stroke="#d1d5db" stroke-width="1" opacity="0.7"/>
    <line x1="150" y1="225" x2="125" y2="227" stroke="#d1d5db" stroke-width="1" opacity="0.7"/>
    <line x1="250" y1="215" x2="275" y2="213" stroke="#d1d5db" stroke-width="1" opacity="0.7"/>
    <line x1="250" y1="220" x2="275" y2="220" stroke="#d1d5db" stroke-width="1" opacity="0.7"/>
    <line x1="250" y1="225" x2="275" y2="227" stroke="#d1d5db" stroke-width="1" opacity="0.7"/>
  </g>
      `,
      pigeon: `
  <g id="spirit-pigeon" opacity="0.25">
    <!-- Wing patterns -->
    <g transform="translate(130, 250)">
      ${Array.from({length: 4}, (_, i) => `
        <ellipse cx="${i*8}" cy="${i*5}" rx="15" ry="8" fill="#94a3b8" opacity="0.6" transform="rotate(-30 ${i*8} ${i*5})"/>
      `).join('')}
    </g>
    <g transform="translate(270, 250) scale(-1, 1)">
      ${Array.from({length: 4}, (_, i) => `
        <ellipse cx="${i*8}" cy="${i*5}" rx="15" ry="8" fill="#94a3b8" opacity="0.6" transform="rotate(-30 ${i*8} ${i*5})"/>
      `).join('')}
    </g>
    <!-- Crest -->
    <circle cx="200" cy="95" r="8" fill="#8b5cf6" opacity="0.7"/>
    <circle cx="195" cy="92" r="5" fill="#a78bfa" opacity="0.6"/>
    <circle cx="205" cy="92" r="5" fill="#a78bfa" opacity="0.6"/>
  </g>
      `,
      cooperhawk: `
  <g id="spirit-cooperhawk" opacity="0.25">
    <!-- Sharp hawk beak overlay -->
    <polygon points="200,228 195,235 200,240 205,235" fill="#fbbf24" opacity="0.7"/>
    <polygon points="200,235 197,238 203,238" fill="#f59e0b" opacity="0.8"/>
    <!-- Fierce eyes enhancement -->
    <path d="M 160,180 L 175,175 L 180,180" stroke="#b91c1c" stroke-width="2" fill="none"/>
    <path d="M 220,180 L 235,175 L 240,180" stroke="#b91c1c" stroke-width="2" fill="none"/>
    <!-- Wing feather patterns -->
    <g transform="translate(120, 260)">
      ${Array.from({length: 5}, (_, i) => `
        <polygon points="${i*10},0 ${i*10+8},10 ${i*10+4},20" fill="#92400e" opacity="0.6"/>
      `).join('')}
    </g>
    <g transform="translate(280, 260) scale(-1, 1)">
      ${Array.from({length: 5}, (_, i) => `
        <polygon points="${i*10},0 ${i*10+8},10 ${i*10+4},20" fill="#92400e" opacity="0.6"/>
      `).join('')}
    </g>
    <!-- Head feather crest -->
    ${Array.from({length: 3}, (_, i) => `
      <polygon points="${190 + i*10},105 ${192 + i*10},90 ${194 + i*10},105" fill="#7c2d12" opacity="0.6"/>
    `).join('')}
  </g>
      `,
      eagle: `
  <g id="spirit-eagle" opacity="0.25">
    <!-- Majestic eagle beak -->
    <polygon points="200,225 192,235 200,243 208,235" fill="#fbbf24" opacity="0.8"/>
    <polygon points="200,230 196,237 204,237" fill="#eab308" opacity="0.9"/>
    <!-- Intense eagle eyes -->
    <circle cx="172" cy="189" r="8" fill="#fbbf24" opacity="0.5"/>
    <circle cx="228" cy="189" r="8" fill="#fbbf24" opacity="0.5"/>
    <!-- Brow ridge (fierce) -->
    <path d="M 158,175 L 175,168 L 185,173" stroke="#78350f" stroke-width="3" fill="none" opacity="0.7"/>
    <path d="M 242,175 L 225,168 L 215,173" stroke="#78350f" stroke-width="3" fill="none" opacity="0.7"/>
    <!-- Spread wing pattern -->
    <g transform="translate(100, 270)">
      ${Array.from({length: 7}, (_, i) => `
        <ellipse cx="${i*12}" cy="${i*3}" rx="20" ry="10" fill="#1e3a8a" opacity="0.5" transform="rotate(-25 ${i*12} ${i*3})"/>
      `).join('')}
    </g>
    <g transform="translate(300, 270) scale(-1, 1)">
      ${Array.from({length: 7}, (_, i) => `
        <ellipse cx="${i*12}" cy="${i*3}" rx="20" ry="10" fill="#1e3a8a" opacity="0.5" transform="rotate(-25 ${i*12} ${i*3})"/>
      `).join('')}
    </g>
    <!-- Head crown -->
    <path d="M 180,100 Q 200,85 220,100" stroke="#92400e" stroke-width="3" fill="none"/>
  </g>
      `,
      lion: `
  <g id="spirit-lion" opacity="0.25">
    <!-- Majestic mane -->
    ${Array.from({length: 20}, (_, i) => {
      const angle = (i / 20) * Math.PI * 2;
      const x = 200 + Math.cos(angle) * 80;
      const y = 180 + Math.sin(angle) * 80;
      const rotation = (angle * 180 / Math.PI) - 90;
      return `
        <ellipse cx="${x}" cy="${y}" rx="25" ry="12" fill="#d97706" opacity="0.6" transform="rotate(${rotation} ${x} ${y})"/>
        <ellipse cx="${x}" cy="${y}" rx="20" ry="9" fill="#f59e0b" opacity="0.5" transform="rotate(${rotation} ${x} ${y})"/>
      `;
    }).join('')}
    <!-- Nose bridge enhancement -->
    <polygon points="195,215 205,215 208,225 192,225" fill="#92400e" opacity="0.5"/>
    <!-- Regal marking -->
    <path d="M 190,110 Q 200,105 210,110" stroke="#78350f" stroke-width="3" fill="none"/>
    <!-- Powerful jaw -->
    <polygon points="175,265 200,275 225,265 200,270" fill="#451a03" opacity="0.4"/>
  </g>
      `,
      coywolf: `
  <g id="spirit-coywolf" opacity="0.25">
    <!-- Pointed wolf ears -->
    <polygon points="155,110 160,70 170,110" fill="#6b7280" stroke="#374151" stroke-width="2"/>
    <polygon points="245,110 240,70 230,110" fill="#6b7280" stroke="#374151" stroke-width="2"/>
    <polygon points="158,105 160,80 165,105" fill="#9ca3af" opacity="0.7"/>
    <polygon points="242,105 240,80 235,105" fill="#9ca3af" opacity="0.7"/>
    <!-- Wild fur markings -->
    ${Array.from({length: 8}, (_, i) => `
      <path d="M ${160 + i*10},140 Q ${163 + i*10},125 ${166 + i*10},140"
            stroke="#4b5563" stroke-width="2" fill="none" opacity="0.6"/>
    `).join('')}
    <!-- Sharp canine hint -->
    <polygon points="185,258 190,265 188,260" fill="#f3f4f6" opacity="0.7"/>
    <polygon points="215,258 210,265 212,260" fill="#f3f4f6" opacity="0.7"/>
    <!-- Intense eyes -->
    <circle cx="172" cy="189" r="3" fill="#fbbf24" opacity="0.7"/>
    <circle cx="228" cy="189" r="3" fill="#fbbf24" opacity="0.7"/>
    <!-- Snout definition -->
    <polygon points="190,220 210,220 208,235 192,235" fill="#52525b" opacity="0.4"/>
  </g>
      `
    };

    return spirits[config.animal] || '';
  }

  // Animal pattern for background
  function getAnimalPattern(animal) {
    const patterns = {
      chicken: `
    <pattern id="animalPattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 20,10 L 25,5 L 30,10 L 25,15 Z" fill="#dc2626" opacity="0.3"/>
    </pattern>
      `,
      cat: `
    <pattern id="animalPattern" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
      <circle cx="15" cy="15" r="3" fill="#fbbf24" opacity="0.3"/>
    </pattern>
      `,
      goat: `
    <pattern id="animalPattern" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
      <polygon points="25,10 30,20 25,25 20,20" fill="#6b7280" opacity="0.3"/>
    </pattern>
      `,
      dog: `
    <pattern id="animalPattern" x="0" y="0" width="45" height="45" patternUnits="userSpaceOnUse">
      <circle cx="15" cy="15" r="4" fill="#8b4513" opacity="0.25"/>
      <circle cx="30" cy="30" r="4" fill="#8b4513" opacity="0.25"/>
    </pattern>
      `,
      bunny: `
    <pattern id="animalPattern" x="0" y="0" width="35" height="35" patternUnits="userSpaceOnUse">
      <ellipse cx="17" cy="17" rx="5" ry="10" fill="#fbbf24" opacity="0.25" transform="rotate(30 17 17)"/>
    </pattern>
      `,
      pigeon: `
    <pattern id="animalPattern" x="0" y="0" width="35" height="35" patternUnits="userSpaceOnUse">
      <ellipse cx="17" cy="17" rx="8" ry="4" fill="#8b5cf6" opacity="0.3" transform="rotate(45 17 17)"/>
    </pattern>
      `,
      cooperhawk: `
    <pattern id="animalPattern" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
      <polygon points="25,15 30,25 25,35 20,25" fill="#92400e" opacity="0.3"/>
      <path d="M 15,20 L 25,15 L 35,20" stroke="#78350f" stroke-width="2" fill="none" opacity="0.25"/>
    </pattern>
      `,
      eagle: `
    <pattern id="animalPattern" x="0" y="0" width="60" height="60" patternUnits="userSpaceOnUse">
      <polygon points="30,10 40,20 30,30 20,20" fill="#1e3a8a" opacity="0.3"/>
      <circle cx="30" cy="30" r="5" fill="#fbbf24" opacity="0.25"/>
    </pattern>
      `,
      lion: `
    <pattern id="animalPattern" x="0" y="0" width="55" height="55" patternUnits="userSpaceOnUse">
      <circle cx="27" cy="27" r="15" fill="#d97706" opacity="0.2"/>
      <circle cx="27" cy="27" r="8" fill="#f59e0b" opacity="0.3"/>
    </pattern>
      `,
      coywolf: `
    <pattern id="animalPattern" x="0" y="0" width="45" height="45" patternUnits="userSpaceOnUse">
      <polygon points="22,10 25,15 22,20 19,15" fill="#6b7280" opacity="0.3"/>
      <path d="M 15,22 Q 22,18 30,22" stroke="#4b5563" stroke-width="2" fill="none" opacity="0.25"/>
    </pattern>
      `
    };

    return patterns[animal] || patterns.chicken;
  }

  // Helper functions
  function adjustBrightness(hex, percent) {
    const num = parseInt(hex.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = Math.min(255, Math.max(0, (num >> 16) + amt));
    const G = Math.min(255, Math.max(0, (num >> 8 & 0x00FF) + amt));
    const B = Math.min(255, Math.max(0, (num & 0x0000FF) + amt));
    return '#' + (0x1000000 + (R << 16) + (G << 8) + B).toString(16).slice(1);
  }

  function updateTemplate() {
    currentConfig = {
      gender: document.querySelector('input[name="gender"]:checked').value,
      animal: document.querySelector('input[name="animal"]:checked').value,
      hairstyle: document.getElementById('hairstyle').value,
      sunglasses: document.getElementById('sunglasses').checked,
      chain: document.getElementById('chain').checked,
      earrings: document.getElementById('earrings').checked,
      hat: document.getElementById('hat').checked,
      skinTone: currentConfig.skinTone
    };

    const svg = generateSVG(currentConfig);
    document.getElementById('svg-container').innerHTML = svg;
  }

  function setSkinTone(button) {
    const color = button.getAttribute('data-color');
    currentConfig.skinTone = color;

    // Update active state
    document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');

    updateTemplate();
  }

  function generateRandom() {
    const genders = ['male', 'female'];
    const animals = ['chicken', 'cat', 'goat', 'dog', 'bunny', 'pigeon', 'cooperhawk', 'eagle', 'lion', 'coywolf'];
    const hairstyles = ['dreads', 'fade', 'afro', 'braids', 'bun', 'waves'];
    const skinTones = ['#3d2817', '#5c3d2e', '#8d5524', '#c68642', '#e0ac69', '#f1c27d'];

    document.querySelector(`input[name="gender"][value="${genders[Math.floor(Math.random() * genders.length)]}"]`).checked = true;
    document.querySelector(`input[name="animal"][value="${animals[Math.floor(Math.random() * animals.length)]}"]`).checked = true;
    document.getElementById('hairstyle').value = hairstyles[Math.floor(Math.random() * hairstyles.length)];
    document.getElementById('sunglasses').checked = Math.random() > 0.5;
    document.getElementById('chain').checked = Math.random() > 0.3;
    document.getElementById('earrings').checked = Math.random() > 0.4;
    document.getElementById('hat').checked = Math.random() > 0.6;

    currentConfig.skinTone = skinTones[Math.floor(Math.random() * skinTones.length)];
    document.querySelector(`.color-btn[data-color="${currentConfig.skinTone}"]`)?.click();

    updateTemplate();
  }

  function exportSVG() {
    const svg = generateSVG(currentConfig);
    const blob = new Blob([svg], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `rapper-pfp-${config.gender}-${config.animal}-${Date.now()}.svg`;
    a.click();
    URL.revokeObjectURL(url);
  }

  // Initialize on load
  document.addEventListener('DOMContentLoaded', () => {
    updateTemplate();

    // Set first skin tone button as active
    document.querySelector('.color-btn[data-color="#8d5524"]').classList.add('active');
  });
</script>

<style>
  .template-builder-container {
    background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
    min-height: 100vh;
    padding: 3rem 2rem;
    color: white;
  }

  .builder-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .builder-title {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .builder-subtitle {
    font-size: 1.25rem;
    opacity: 0.8;
  }

  /* Controls */
  .controls-panel {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 3rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .control-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .control-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .control-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #a78bfa;
  }

  .control-group {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  /* Animal Spirit Grid */
  .animal-spirit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
  }

  .spirit-category {
    background: rgba(255, 255, 255, 0.03);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  .spirit-category-title {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #fbbf24;
    text-transform: uppercase;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .spirit-category-title::before {
    content: '';
    width: 4px;
    height: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 2px;
  }

  .spirit-category .control-label {
    margin-bottom: 0.5rem;
    width: 100%;
  }

  .control-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    padding: 0.75rem 1.25rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }

  .control-label:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(102, 126, 234, 0.3);
  }

  .control-label input[type="radio"] {
    accent-color: #667eea;
  }

  .control-label input[type="radio"]:checked + span {
    color: #a78bfa;
    font-weight: 600;
  }

  .control-checkbox {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    padding: 0.5rem 0;
  }

  .control-checkbox input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: #667eea;
  }

  .control-select {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: white;
    font-size: 1rem;
    cursor: pointer;
  }

  .control-select:focus {
    outline: none;
    border-color: #667eea;
  }

  .color-picker-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .color-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 3px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }

  .color-btn:nth-child(1) { background: #3d2817; }
  .color-btn:nth-child(2) { background: #5c3d2e; }
  .color-btn:nth-child(3) { background: #8d5524; }
  .color-btn:nth-child(4) { background: #c68642; }
  .color-btn:nth-child(5) { background: #e0ac69; }
  .color-btn:nth-child(6) { background: #f1c27d; }

  .color-btn:hover {
    transform: scale(1.1);
    border-color: #667eea;
  }

  .color-btn.active {
    border-color: #667eea;
    border-width: 4px;
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
  }

  .color-btn.active::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: 900;
    font-size: 1.25rem;
    text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
  }

  .btn-generate,
  .btn-export {
    width: 100%;
    padding: 1rem 2rem;
    border: none;
    border-radius: 12px;
    font-size: 1.125rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 1rem;
  }

  .btn-generate {
    background: linear-gradient(135deg, #f093fb, #f5576c);
    color: white;
  }

  .btn-generate:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(240, 147, 251, 0.4);
  }

  .btn-export {
    background: linear-gradient(135deg, #43e97b, #38f9d7);
    color: #1a1a2e;
  }

  .btn-export:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(67, 233, 123, 0.4);
  }

  /* Preview */
  .preview-panel {
    margin-bottom: 4rem;
  }

  .preview-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 2rem;
    text-align: center;
  }

  .svg-container {
    max-width: 500px;
    margin: 0 auto;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.1);
  }

  .svg-container svg {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Gallery */
  .variations-gallery {
    margin-top: 4rem;
  }

  .gallery-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 2rem;
    text-align: center;
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 2rem;
  }

  /* Mobile */
  @media (max-width: 768px) {
    .template-builder-container {
      padding: 2rem 1rem;
    }

    .builder-title {
      font-size: 2rem;
    }

    .builder-subtitle {
      font-size: 1rem;
    }

    .controls-panel {
      padding: 1.5rem;
    }

    .control-group {
      flex-direction: column;
      gap: 0.75rem;
    }

    .color-picker-group {
      justify-content: center;
    }

    .gallery-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

</BaseLayout>
