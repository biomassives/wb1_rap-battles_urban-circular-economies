---
/**
 * airdrops.astro
 * Scheduled Airdrop Rewards Dashboard
 *
 * Data-driven airdrop system loading from /public/data/purple-point/
 * - Airdrops: 25 reward templates
 * - Projects: 5 core projects for combinations
 * - Event Domains: Educational activity categorization
 */
import BaseLayout from '../layouts/BaseLayout.astro';

// Fetch data from JSON files
const rewardsData = await fetch(new URL('/data/purple-point/airdrops/rewards.json', Astro.url)).then(r => r.json());
const projectsData = await fetch(new URL('/data/purple-point/projects/projects.json', Astro.url)).then(r => r.json());
const eventDomainsData = await fetch(new URL('/data/purple-point/calendar/event-domains.json', Astro.url)).then(r => r.json());
---

<BaseLayout
  title="Airdrop Rewards"
  description="Earn tokens and XP through scheduled airdrops"
  activeSection="progress"
>

  <section class="airdrops-page">
    <div class="container mx-auto" style="padding: 2rem;">

      <!-- Header -->
      <div class="page-header" style="margin-bottom: 3rem;">
        <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">
          üéÅ Airdrop Rewards Dashboard
        </h1>
        <p style="color: #666; font-size: 1.125rem;">
          Earn tokens and XP through artist promotions, education, mentorship, and events
        </p>
      </div>

      <!-- Today's Date Display -->
      <div class="today-display" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 3rem; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3); max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 1.5rem;">
          <div style="font-size: 3rem;">üìÖ</div>
          <div style="text-align: left;">
            <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.25rem;">Today</div>
            <div id="current-date" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.25rem;">Loading...</div>
            <div id="current-time" style="font-size: 1.125rem; opacity: 0.9;">Loading...</div>
          </div>
        </div>
      </div>

      <!-- 7-Day Calendar -->
      <div class="calendar-week">
        <h2 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 1rem;">
          üìÜ This Week's Educational Activities
        </h2>
        <p style="color: #666; font-size: 0.875rem; margin-bottom: 1.5rem;">
          Color-coded by priority and domain: Learning, Cultural, Artistic, Financial
        </p>

        <!-- Calendar Legend -->
        <div class="calendar-legend">
          <div class="legend-item">
            <div class="legend-box" style="background: #10b981;"></div>
            <span>Primary (Most Important)</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background: #86efac;"></div>
            <span>Secondary</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background: #d1fae5;"></div>
            <span>Tertiary</span>
          </div>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-grid" id="calendar-grid">
          <!-- Days will be populated by JavaScript -->
        </div>
      </div>

      <!-- Current Balance -->
      <div class="balance-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 1rem; margin-bottom: 3rem;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Your Balance</div>
            <div id="token-balance" style="font-size: 3rem; font-weight: bold;">0</div>
            <div style="font-size: 0.875rem; opacity: 0.9;">Tokens</div>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Total Earned</div>
            <div id="total-earned" style="font-size: 2rem; font-weight: bold;">0</div>
            <div style="font-size: 0.875rem; opacity: 0.9;">All Time</div>
          </div>
        </div>
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.2);">
          <div style="display: flex; gap: 1rem;">
            <button class="btn-white" onclick="window.airdropManager?.claimAll()">
              üí∞ Claim All Available
            </button>
            <button class="btn-white-outline" onclick="window.airdropManager?.viewHistory()">
              üìú View History
            </button>
          </div>
        </div>
      </div>

      <!-- Project-Airdrop Combination Wheel -->
      <div class="combination-wheel">
        <h2 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.5rem; text-align: center;">
          üé° Project + Airdrop Combinations
        </h2>
        <p class="wheel-subtitle">
          Cycling through all intersectional project support opportunities
        </p>

        <div class="wheel-display">
          <div class="wheel-current" id="wheel-current">
            <div class="combo-project">
              <span class="project-icon">üèïÔ∏è</span>
              <span class="project-name">Kakuma</span>
            </div>
            <div class="combo-connector">√ó</div>
            <div class="combo-airdrop">
              <span class="airdrop-icon">üéµ</span>
              <span class="airdrop-name">Stream Boost</span>
            </div>
          </div>

          <div class="wheel-info">
            <div class="combo-description" id="combo-description">
              Loading combinations...
            </div>
            <div class="combo-stats">
              Combination <span id="combo-current">1</span> of
              <span id="combo-total">125</span>
            </div>
          </div>
        </div>

        <div class="wheel-controls">
          <button class="btn-wheel" onclick="window.wheelManager?.previous()">‚èÆ Previous</button>
          <button class="btn-wheel" onclick="window.wheelManager?.toggleAutoplay()">
            <span id="autoplay-icon">‚è∏Ô∏è</span> <span id="autoplay-text">Pause</span>
          </button>
          <button class="btn-wheel" onclick="window.wheelManager?.next()">Next ‚è≠</button>
        </div>

        <div class="wheel-progress-bar">
          <div class="wheel-progress-fill" id="wheel-progress"></div>
        </div>
      </div>

      <!-- Active Airdrops -->
      <div class="section-block" style="margin-bottom: 3rem;">
        <h2 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5rem;">
          üî• Active Airdrops
        </h2>
        <div id="active-airdrops" class="airdrop-grid">
          <!-- Active airdrops loaded here -->
        </div>
      </div>

      <!-- Upcoming Airdrops -->
      <div class="section-block" style="margin-bottom: 3rem;">
        <h2 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5rem;">
          ‚è∞ Upcoming Airdrops
        </h2>
        <div id="upcoming-airdrops" class="airdrop-grid">
          <!-- Upcoming airdrops loaded here -->
        </div>
      </div>

      <!-- All 25 Reward Templates -->
      <div class="section-block">
        <h2 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 1rem;">
          üéØ All Reward Types (25 Templates)
        </h2>
        <p style="color: #666; margin-bottom: 2rem;">
          These rewards cycle through scheduled airdrops. Complete actions to earn tokens and XP.
        </p>

        <!-- Category Tabs -->
        <div class="category-tabs" style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
          <button class="category-tab active" data-category="all">
            All (25)
          </button>
          <button class="category-tab" data-category="artist_promotion">
            üé§ Artist (7)
          </button>
          <button class="category-tab" data-category="educational">
            üìö Education (7)
          </button>
          <button class="category-tab" data-category="mentorship">
            üéì Mentorship (6)
          </button>
          <button class="category-tab" data-category="events">
            üéâ Events (5)
          </button>
        </div>

        <!-- Reward Templates Grid -->
        <div id="all-rewards" class="rewards-template-grid">
          <!-- All 25 reward cards loaded here -->
        </div>
      </div>

    </div>
  </section>

  <!-- MODALS -->

  <!-- Claim Confirmation Modal -->
  <div id="claim-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.airdropManager?.closeModal('claim-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>üí∞ Claim Reward</h3>
        <button class="modal-close" onclick="window.airdropManager?.closeModal('claim-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <div id="claim-modal-content">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;" id="claim-icon">üéÅ</div>
            <h4 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem;" id="claim-title">Reward Name</h4>
            <p style="color: #666;" id="claim-description">Reward description</p>
          </div>

          <div style="background: #f9fafb; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: center;">
              <div>
                <div style="font-size: 2rem; font-weight: bold; color: #667eea;" id="claim-tokens">50</div>
                <div style="font-size: 0.875rem; color: #666;">Tokens</div>
              </div>
              <div>
                <div style="font-size: 2rem; font-weight: bold; color: #10b981;" id="claim-xp">25</div>
                <div style="font-size: 0.875rem; color: #666;">XP</div>
              </div>
            </div>
          </div>

          <div style="background: #fef3c7; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #f59e0b; margin-bottom: 1.5rem;">
            <div style="font-size: 0.875rem; font-weight: 600; color: #92400e; margin-bottom: 0.5rem;">Requirements:</div>
            <div id="claim-requirements" style="font-size: 0.875rem; color: #78350f;">
              <!-- Requirements will be inserted here -->
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" onclick="window.airdropManager?.closeModal('claim-modal')">Cancel</button>
          <button type="button" class="btn-primary" id="confirm-claim-btn" onclick="window.airdropManager?.confirmClaim()">
            Claim Now
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Claim All Confirmation Modal -->
  <div id="claim-all-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.airdropManager?.closeModal('claim-all-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>üíé Claim All Available Rewards</h3>
        <button class="modal-close" onclick="window.airdropManager?.closeModal('claim-all-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <div id="claim-all-content">
          <div style="text-align: center; margin-bottom: 1.5rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üéâ</div>
            <p style="color: #666; font-size: 1.125rem;">You're about to claim <strong id="claim-all-count">0</strong> available rewards!</p>
          </div>

          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem; text-align: center;">
            <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Total Rewards</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <div style="font-size: 2.5rem; font-weight: bold;" id="claim-all-total-tokens">0</div>
                <div style="font-size: 0.875rem; opacity: 0.9;">Tokens</div>
              </div>
              <div>
                <div style="font-size: 2.5rem; font-weight: bold;" id="claim-all-total-xp">0</div>
                <div style="font-size: 0.875rem; opacity: 0.9;">XP</div>
              </div>
            </div>
          </div>

          <div id="claim-all-list" style="max-height: 300px; overflow-y: auto; margin-bottom: 1.5rem;">
            <!-- Reward list will be inserted here -->
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" onclick="window.airdropManager?.closeModal('claim-all-modal')">Cancel</button>
          <button type="button" class="btn-primary" onclick="window.airdropManager?.confirmClaimAll()">
            Claim All Now
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div id="history-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.airdropManager?.closeModal('history-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>üìú Claim History</h3>
        <button class="modal-close" onclick="window.airdropManager?.closeModal('history-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <div style="background: #f9fafb; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem; text-align: center;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <div style="font-size: 2rem; font-weight: bold; color: #667eea;" id="history-total-rewards">0</div>
              <div style="font-size: 0.875rem; color: #666;">Rewards Claimed</div>
            </div>
            <div>
              <div style="font-size: 2rem; font-weight: bold; color: #10b981;" id="history-total-earned">0</div>
              <div style="font-size: 0.875rem; color: #666;">Total Earned</div>
            </div>
          </div>
        </div>

        <div id="history-list" style="max-height: 400px; overflow-y: auto;">
          <!-- History items will be inserted here -->
        </div>

        <div class="modal-actions" style="justify-content: center;">
          <button type="button" class="btn-primary" onclick="window.airdropManager?.closeModal('history-modal')">Close</button>
        </div>
      </div>
    </div>
  </div>

</BaseLayout>

<script define:vars={{ rewardsData, projectsData, eventDomainsData }}>
  // Load data from JSON files (passed from server-side)
  const REWARD_TEMPLATES = rewardsData.rewards;
  const PROJECTS_DATA = projectsData.projects.map(p => ({
    name: p.name,
    icon: p.icon,
    description: p.description
  }));
  const EVENT_DOMAINS_DATA = eventDomainsData.domains;
</script>

<script>
  // Legacy hardcoded data (can be removed once fully migrated)
  // All 25 Reward Templates - NOW LOADED FROM /public/data/purple-point/airdrops/rewards.json
  const REWARD_TEMPLATES_LEGACY = [
    // ARTIST PROMOTION REWARDS (7)
    {
      id: 'artist-stream-boost',
      category: 'artist_promotion',
      name: 'Stream Boost',
      description: 'Stream featured artist tracks 10+ times',
      reward: '50 tokens',
      xp: 25,
      icon: 'üéµ',
      requirements: ['10 streams', 'Featured artists only'],
      frequency: 'Weekly',
      startDate: '2025-12-30T00:00:00Z',
      endDate: '2026-01-06T23:59:59Z'
    },
    {
      id: 'artist-share-campaign',
      category: 'artist_promotion',
      name: 'Share Campaign',
      description: 'Share artist profiles on social media',
      reward: '75 tokens',
      xp: 30,
      icon: 'üì¢',
      requirements: ['3 shares', 'Tag @WorldBridgerOne'],
      frequency: 'Bi-weekly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-15T23:59:59Z'
    },
    {
      id: 'artist-discovery',
      category: 'artist_promotion',
      name: 'Artist Discovery',
      description: 'Discover and follow 5 new artists',
      reward: '60 tokens',
      xp: 20,
      icon: 'üîç',
      requirements: ['5 new follows', 'Listen to at least 1 track each'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'artist-collab-support',
      category: 'artist_promotion',
      name: 'Collab Support',
      description: 'Vote for collaborations or contribute ideas',
      reward: '100 tokens',
      xp: 40,
      icon: 'ü§ù',
      requirements: ['Vote on 5 collabs', 'Or contribute to 1'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'artist-feedback',
      category: 'artist_promotion',
      name: 'Constructive Feedback',
      description: 'Leave detailed feedback on artist works',
      reward: '80 tokens',
      xp: 35,
      icon: 'üí¨',
      requirements: ['5 quality comments', 'Min 50 characters each'],
      frequency: 'Weekly',
      startDate: '2025-12-30T00:00:00Z',
      endDate: '2026-01-06T23:59:59Z'
    },
    {
      id: 'artist-playlist',
      category: 'artist_promotion',
      name: 'Playlist Creator',
      description: 'Create playlists featuring platform artists',
      reward: '120 tokens',
      xp: 50,
      icon: 'üìù',
      requirements: ['10+ tracks', 'Min 5 different artists'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'artist-battle-spectator',
      category: 'artist_promotion',
      name: 'Battle Spectator',
      description: 'Watch and engage with rap battles',
      reward: '40 tokens',
      xp: 15,
      icon: '‚öîÔ∏è',
      requirements: ['Watch 3 battles', 'Vote on outcomes'],
      frequency: 'Weekly',
      startDate: '2025-12-30T00:00:00Z',
      endDate: '2026-01-06T23:59:59Z'
    },

    // EDUCATIONAL REWARDS (7)
    {
      id: 'edu-course-complete',
      category: 'educational',
      name: 'Course Completion',
      description: 'Complete full environmental course',
      reward: '200 tokens',
      xp: 100,
      icon: 'üéì',
      requirements: ['Complete all modules', 'Pass final quiz'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'edu-quiz-master',
      category: 'educational',
      name: 'Quiz Master',
      description: 'Score 90%+ on course quizzes',
      reward: '75 tokens',
      xp: 40,
      icon: 'üìù',
      requirements: ['5 quizzes', '90%+ average'],
      frequency: 'Bi-weekly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-15T23:59:59Z'
    },
    {
      id: 'edu-project-submit',
      category: 'educational',
      name: 'Project Submission',
      description: 'Submit environmental tech project',
      reward: '250 tokens',
      xp: 120,
      icon: 'üöÄ',
      requirements: ['Working prototype', 'Documentation included'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'edu-research-contribute',
      category: 'educational',
      name: 'Research Contributor',
      description: 'Submit environmental observations',
      reward: '60 tokens',
      xp: 30,
      icon: 'üî¨',
      requirements: ['10 observations', 'Include data and photos'],
      frequency: 'Weekly',
      startDate: '2025-12-30T00:00:00Z',
      endDate: '2026-01-06T23:59:59Z'
    },
    {
      id: 'edu-workshop-attend',
      category: 'educational',
      name: 'Workshop Attendance',
      description: 'Attend live educational workshops',
      reward: '90 tokens',
      xp: 45,
      icon: 'üè´',
      requirements: ['Attend full session', 'Participate actively'],
      frequency: 'Per workshop',
      startDate: '2026-01-10T00:00:00Z',
      endDate: '2026-01-10T23:59:59Z'
    },
    {
      id: 'edu-peer-teach',
      category: 'educational',
      name: 'Peer Teacher',
      description: 'Create tutorial or teach others',
      reward: '180 tokens',
      xp: 80,
      icon: 'üë®‚Äçüè´',
      requirements: ['Create tutorial', 'Min 5 learners engaged'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'edu-certification',
      category: 'educational',
      name: 'Certification Earned',
      description: 'Complete certification program',
      reward: '500 tokens',
      xp: 250,
      icon: 'üèÜ',
      requirements: ['Complete all requirements', 'Pass final exam'],
      frequency: 'Per certification',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-03-31T23:59:59Z'
    },

    // MENTORSHIP REWARDS (6)
    {
      id: 'mentor-session-attend',
      category: 'mentorship',
      name: 'Mentor Session',
      description: 'Attend one-on-one mentor session',
      reward: '100 tokens',
      xp: 50,
      icon: 'üéØ',
      requirements: ['Book and attend session', 'Complete action items'],
      frequency: 'Weekly',
      startDate: '2025-12-30T00:00:00Z',
      endDate: '2026-01-06T23:59:59Z'
    },
    {
      id: 'mentor-become',
      category: 'mentorship',
      name: 'Become a Mentor',
      description: 'Sign up as mentor and conduct sessions',
      reward: '300 tokens',
      xp: 150,
      icon: 'üåü',
      requirements: ['Level 10+', 'Complete mentor training'],
      frequency: 'One-time + per session',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-12-31T23:59:59Z'
    },
    {
      id: 'mentor-milestone',
      category: 'mentorship',
      name: 'Mentorship Milestone',
      description: 'Complete mentorship program milestones',
      reward: '150 tokens',
      xp: 70,
      icon: 'üìä',
      requirements: ['3 sessions attended', 'Goals achieved'],
      frequency: 'Monthly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-31T23:59:59Z'
    },
    {
      id: 'mentor-feedback',
      category: 'mentorship',
      name: 'Mentor Feedback',
      description: 'Provide feedback on mentor sessions',
      reward: '30 tokens',
      xp: 10,
      icon: '‚≠ê',
      requirements: ['Complete feedback form', 'Detailed responses'],
      frequency: 'Per session',
      startDate: '2025-12-30T00:00:00Z',
      endDate: '2026-01-06T23:59:59Z'
    },
    {
      id: 'mentor-peer-group',
      category: 'mentorship',
      name: 'Peer Group Session',
      description: 'Participate in group mentorship',
      reward: '80 tokens',
      xp: 35,
      icon: 'üë•',
      requirements: ['Attend group session', 'Share learnings'],
      frequency: 'Bi-weekly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-15T23:59:59Z'
    },
    {
      id: 'mentor-success-story',
      category: 'mentorship',
      name: 'Success Story',
      description: 'Share your mentorship success journey',
      reward: '200 tokens',
      xp: 90,
      icon: 'üìñ',
      requirements: ['Written story', 'Before/after evidence'],
      frequency: 'Quarterly',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-03-31T23:59:59Z'
    },

    // EVENT REWARDS (5)
    {
      id: 'event-attend-live',
      category: 'events',
      name: 'Live Event Attendance',
      description: 'Attend live platform events',
      reward: '120 tokens',
      xp: 60,
      icon: 'üé™',
      requirements: ['Full attendance', 'Event check-in'],
      frequency: 'Per event',
      startDate: '2026-01-15T00:00:00Z',
      endDate: '2026-01-15T23:59:59Z'
    },
    {
      id: 'event-battle-participate',
      category: 'events',
      name: 'Battle Event',
      description: 'Compete in battle tournament',
      reward: '250 tokens',
      xp: 120,
      icon: '‚öîÔ∏è',
      requirements: ['Enter tournament', 'Complete all rounds'],
      frequency: 'Per tournament',
      startDate: '2026-01-20T00:00:00Z',
      endDate: '2026-01-27T23:59:59Z'
    },
    {
      id: 'event-community-day',
      category: 'events',
      name: 'Community Day',
      description: 'Participate in community day activities',
      reward: '150 tokens',
      xp: 70,
      icon: 'üåà',
      requirements: ['Join activities', 'Connect with 5+ members'],
      frequency: 'Monthly',
      startDate: '2026-01-25T00:00:00Z',
      endDate: '2026-01-25T23:59:59Z'
    },
    {
      id: 'event-hackathon',
      category: 'events',
      name: 'Hackathon',
      description: 'Build project during hackathon',
      reward: '400 tokens',
      xp: 200,
      icon: 'üíª',
      requirements: ['Submit project', 'Demo presentation'],
      frequency: 'Per hackathon',
      startDate: '2026-02-01T00:00:00Z',
      endDate: '2026-02-03T23:59:59Z'
    },
    {
      id: 'event-celebration',
      category: 'events',
      name: 'Milestone Celebration',
      description: 'Celebrate platform milestones',
      reward: '100 tokens',
      xp: 50,
      icon: 'üéâ',
      requirements: ['Participate in celebration', 'Share on social'],
      frequency: 'Per milestone',
      startDate: '2026-01-01T00:00:00Z',
      endDate: '2026-01-07T23:59:59Z'
    }
  ];

  // Airdrop Manager
  class AirdropManager {
    constructor() {
      this.balance = 0;
      this.totalEarned = 0;
      this.claimedRewards = [];
      this.activeAirdrops = [];
      this.upcomingAirdrops = [];

      this.loadFromLocalStorage();
      this.setupCategoryTabs();
      this.renderAllRewards();
      this.renderActiveAirdrops();
      this.renderUpcomingAirdrops();
      this.updateBalance();
    }

    loadFromLocalStorage() {
      const wallet = window.walletManager?.connectedWallet;
      if (wallet) {
        const balanceData = localStorage.getItem(`airdrop_balance_${wallet}`);
        if (balanceData) {
          const data = JSON.parse(balanceData);
          this.balance = data.balance || 0;
          this.totalEarned = data.totalEarned || 0;
          this.claimedRewards = data.claimedRewards || [];
        }
      }

      // Load active and upcoming airdrops based on actual dates
      const now = new Date();
      this.activeAirdrops = REWARD_TEMPLATES.filter(r => {
        if (!r.startDate || !r.endDate) return false;
        const start = new Date(r.startDate);
        const end = new Date(r.endDate);
        return now >= start && now <= end;
      });

      this.upcomingAirdrops = REWARD_TEMPLATES.filter(r => {
        if (!r.startDate) return false;
        return now < new Date(r.startDate);
      }).sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
    }

    saveToLocalStorage() {
      const wallet = window.walletManager?.connectedWallet;
      if (wallet) {
        localStorage.setItem(`airdrop_balance_${wallet}`, JSON.stringify({
          balance: this.balance,
          totalEarned: this.totalEarned,
          claimedRewards: this.claimedRewards
        }));
      }
    }

    updateBalance() {
      document.getElementById('token-balance').textContent = this.balance.toLocaleString();
      document.getElementById('total-earned').textContent = this.totalEarned.toLocaleString();
    }

    setupCategoryTabs() {
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');

          const category = tab.dataset.category;
          this.filterRewards(category);
        });
      });
    }

    filterRewards(category) {
      const cards = document.querySelectorAll('.reward-card');
      cards.forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }

    renderAllRewards() {
      const container = document.getElementById('all-rewards');
      container.innerHTML = REWARD_TEMPLATES.map(reward => this.createRewardCard(reward, 'template')).join('');
    }

    renderActiveAirdrops() {
      const container = document.getElementById('active-airdrops');
      if (this.activeAirdrops.length === 0) {
        container.innerHTML = '<div class="empty-state">No active airdrops right now. Check back soon!</div>';
        return;
      }
      container.innerHTML = this.activeAirdrops.map(reward => this.createRewardCard(reward, 'active')).join('');

      // Start countdown timers
      setTimeout(() => startAllTimers(), 100);
    }

    renderUpcomingAirdrops() {
      const container = document.getElementById('upcoming-airdrops');
      if (this.upcomingAirdrops.length === 0) {
        container.innerHTML = '<div class="empty-state">No upcoming airdrops scheduled</div>';
        return;
      }
      container.innerHTML = this.upcomingAirdrops.map(reward => this.createRewardCard(reward, 'upcoming')).join('');

      // Start countdown timers
      setTimeout(() => startAllTimers(), 100);
    }

    createRewardCard(reward, mode) {
      const isClaimed = this.claimedRewards.includes(reward.id);
      const categoryColors = {
        artist_promotion: '#667eea',
        educational: '#10b981',
        mentorship: '#f59e0b',
        events: '#ec4899'
      };

      const modeClass = mode === 'active' ? 'active-airdrop' : mode === 'upcoming' ? 'upcoming-airdrop' : '';

      return `
        <div class="reward-card ${modeClass} ${isClaimed ? 'claimed' : ''}" data-category="${reward.category}" data-id="${reward.id}">
          <div class="reward-icon" style="background: ${categoryColors[reward.category]}">
            ${reward.icon}
          </div>
          <div class="reward-header">
            <h3 class="reward-name">${reward.name}</h3>
            <div class="reward-category-badge" style="background: ${categoryColors[reward.category]}">
              ${reward.category.replace('_', ' ')}
            </div>
          </div>
          <p class="reward-description">${reward.description}</p>

          <div class="reward-amounts">
            <div class="reward-amount">
              <div class="amount-value">${reward.reward}</div>
              <div class="amount-label">Reward</div>
            </div>
            <div class="reward-amount">
              <div class="amount-value">+${reward.xp} XP</div>
              <div class="amount-label">Experience</div>
            </div>
          </div>

          <div class="reward-requirements">
            <div class="requirements-label">Requirements:</div>
            ${reward.requirements.map(req => `
              <div class="requirement-item">‚úì ${req}</div>
            `).join('')}
          </div>

          <div class="reward-frequency">
            üìÖ ${reward.frequency}
          </div>

          ${mode === 'active' ? `
            <div class="airdrop-timing" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 0.5rem;">
              <div style="font-size: 0.75rem; color: #059669; font-weight: 600; margin-bottom: 0.25rem;">Ends in:</div>
              <div class="countdown-timer" id="timer-${reward.id}" data-airdrop-id="${reward.id}" data-target-date="${reward.endDate}">
                Calculating...
              </div>
            </div>
            <button class="claim-btn ${isClaimed ? 'claimed' : ''}" onclick="window.airdropManager.claimReward('${reward.id}')">
              ${isClaimed ? '‚úÖ Claimed' : 'üí∞ Claim Reward'}
            </button>
          ` : mode === 'upcoming' ? `
            <div class="airdrop-timing upcoming" style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 0.5rem;">
              <div style="font-size: 0.75rem; color: #d97706; font-weight: 600; margin-bottom: 0.25rem;">Starts in:</div>
              <div class="countdown-timer" id="timer-start-${reward.id}" data-airdrop-id="${reward.id}" data-target-date="${reward.startDate}">
                Calculating...
              </div>
            </div>
            <div class="upcoming-badge">Coming Soon</div>
          ` : `
            <div class="template-badge">Template</div>
          `}
        </div>
      `;
    }

    claimReward(rewardId) {
      if (this.claimedRewards.includes(rewardId)) {
        this.showToast('You already claimed this reward!', 'error');
        return;
      }

      const reward = REWARD_TEMPLATES.find(r => r.id === rewardId);
      if (!reward) return;

      // Store current reward for confirmation
      this.currentClaimReward = reward;

      // Populate modal
      document.getElementById('claim-icon').textContent = reward.icon;
      document.getElementById('claim-title').textContent = reward.name;
      document.getElementById('claim-description').textContent = reward.description;
      document.getElementById('claim-tokens').textContent = reward.reward.split(' ')[0];
      document.getElementById('claim-xp').textContent = reward.xp;
      document.getElementById('claim-requirements').innerHTML = reward.requirements.map(req =>
        `<div style="margin-bottom: 0.25rem;">‚úì ${req}</div>`
      ).join('');

      // Open modal
      this.openModal('claim-modal');
    }

    confirmClaim() {
      const reward = this.currentClaimReward;
      if (!reward) return;

      // Extract token amount
      const tokenAmount = parseInt(reward.reward.split(' ')[0]);

      // Update balance
      this.balance += tokenAmount;
      this.totalEarned += tokenAmount;
      this.claimedRewards.push(reward.id);

      // Award XP
      if (window.progressManager) {
        window.progressManager.awardXP(reward.xp, 'airdrop_claim', `Claimed: ${reward.name}`);
      }

      // Save and update
      this.saveToLocalStorage();
      this.updateBalance();

      // Re-render
      this.renderActiveAirdrops();
      this.renderAllRewards();

      // Close modal
      this.closeModal('claim-modal');

      // Show success
      this.showToast(`‚úÖ Claimed ${reward.reward} and +${reward.xp} XP!`, 'success');

      // Clear current reward
      this.currentClaimReward = null;
    }

    claimAll() {
      const unclaimed = this.activeAirdrops.filter(r => !this.claimedRewards.includes(r.id));
      if (unclaimed.length === 0) {
        this.showToast('No unclaimed rewards available!', 'info');
        return;
      }

      // Calculate totals
      let totalTokens = 0;
      let totalXP = 0;
      unclaimed.forEach(reward => {
        totalTokens += parseInt(reward.reward.split(' ')[0]);
        totalXP += reward.xp;
      });

      // Populate modal
      document.getElementById('claim-all-count').textContent = unclaimed.length;
      document.getElementById('claim-all-total-tokens').textContent = totalTokens;
      document.getElementById('claim-all-total-xp').textContent = totalXP;

      // Populate reward list
      document.getElementById('claim-all-list').innerHTML = unclaimed.map(reward => `
        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem; margin-bottom: 0.5rem;">
          <div style="font-size: 2rem;">${reward.icon}</div>
          <div style="flex: 1;">
            <div style="font-weight: 600; margin-bottom: 0.25rem;">${reward.name}</div>
            <div style="font-size: 0.875rem; color: #666;">${reward.reward} ‚Ä¢ +${reward.xp} XP</div>
          </div>
        </div>
      `).join('');

      // Store unclaimed for confirmation
      this.unclaimedRewards = unclaimed;

      // Open modal
      this.openModal('claim-all-modal');
    }

    confirmClaimAll() {
      if (!this.unclaimedRewards || this.unclaimedRewards.length === 0) return;

      let totalTokens = 0;
      let totalXP = 0;

      this.unclaimedRewards.forEach(reward => {
        const tokenAmount = parseInt(reward.reward.split(' ')[0]);
        this.balance += tokenAmount;
        this.totalEarned += tokenAmount;
        totalTokens += tokenAmount;
        totalXP += reward.xp;
        this.claimedRewards.push(reward.id);

        // Award XP
        if (window.progressManager) {
          window.progressManager.awardXP(reward.xp, 'airdrop_claim', `Claimed: ${reward.name}`);
        }
      });

      // Save and update
      this.saveToLocalStorage();
      this.updateBalance();

      // Re-render
      this.renderActiveAirdrops();
      this.renderAllRewards();

      // Close modal
      this.closeModal('claim-all-modal');

      // Show success
      this.showToast(`‚úÖ Claimed ${this.unclaimedRewards.length} rewards: ${totalTokens} tokens and ${totalXP} XP!`, 'success');

      // Clear unclaimed
      this.unclaimedRewards = null;
    }

    viewHistory() {
      // Populate stats
      document.getElementById('history-total-rewards').textContent = this.claimedRewards.length;
      document.getElementById('history-total-earned').textContent = this.totalEarned.toLocaleString();

      // Populate history list
      if (this.claimedRewards.length === 0) {
        document.getElementById('history-list').innerHTML = `
          <div style="text-align: center; padding: 3rem; color: #9ca3af;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üéÅ</div>
            <p>No rewards claimed yet</p>
            <p style="font-size: 0.875rem; margin-top: 0.5rem;">Check out the active airdrops above to get started!</p>
          </div>
        `;
      } else {
        document.getElementById('history-list').innerHTML = this.claimedRewards.map(id => {
          const reward = REWARD_TEMPLATES.find(r => r.id === id);
          if (!reward) return '';

          return `
            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid #e5e7eb;">
              <div style="font-size: 2rem;">${reward.icon}</div>
              <div style="flex: 1;">
                <div style="font-weight: 600; margin-bottom: 0.25rem;">${reward.name}</div>
                <div style="font-size: 0.875rem; color: #666;">${reward.category.replace('_', ' ')}</div>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: bold; color: #667eea;">${reward.reward}</div>
                <div style="font-size: 0.875rem; color: #10b981;">+${reward.xp} XP</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Open modal
      this.openModal('history-modal');
    }

    // Modal management
    openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }

    closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    }

    // Toast notification
    showToast(message, type = 'info') {
      // Remove existing toasts
      document.querySelectorAll('.toast').forEach(t => t.remove());

      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('show');
      }, 10);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  }

  // Airdrop Timer Class
  class AirdropTimer {
    constructor(airdropId, targetDate, isStartTimer = false) {
      this.airdropId = airdropId;
      this.targetDate = new Date(targetDate);
      this.isStartTimer = isStartTimer; // true for "starts in", false for "ends in"
      this.elementId = isStartTimer ? `timer-start-${airdropId}` : `timer-${airdropId}`;
      this.interval = null;
    }

    start() {
      this.update();
      this.interval = setInterval(() => this.update(), 1000);
    }

    stop() {
      if (this.interval) {
        clearInterval(this.interval);
        this.interval = null;
      }
    }

    update() {
      const now = new Date();
      const remaining = this.targetDate - now;

      const element = document.getElementById(this.elementId);
      if (!element) return;

      if (remaining <= 0) {
        element.textContent = this.isStartTimer ? 'Starting now!' : 'Expired';
        element.classList.add('expired');
        this.stop();

        // Reload airdrop data after expiry
        if (window.airdropManager) {
          window.airdropManager.loadFromLocalStorage();
          window.airdropManager.renderActiveAirdrops();
          window.airdropManager.renderUpcomingAirdrops();
        }
        return;
      }

      const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
      const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

      let timeString = '';
      if (days > 0) {
        timeString = `${days}d ${hours}h ${minutes}m ${seconds}s`;
      } else if (hours > 0) {
        timeString = `${hours}h ${minutes}m ${seconds}s`;
      } else {
        timeString = `${minutes}m ${seconds}s`;
      }

      element.textContent = timeString;

      // Add urgent class if less than 1 hour remaining (for "ends in" timers)
      if (!this.isStartTimer && remaining < 3600000) {
        element.classList.add('urgent');
      } else {
        element.classList.remove('urgent');
      }
    }
  }

  // Timer Manager
  const activeTimers = [];

  function startAllTimers() {
    // Clear existing timers
    activeTimers.forEach(timer => timer.stop());
    activeTimers.length = 0;

    // Find all timer elements and start timers
    document.querySelectorAll('[id^="timer-"]').forEach(el => {
      const airdropId = el.dataset.airdropId;
      const targetDate = el.dataset.targetDate;
      const isStartTimer = el.id.includes('timer-start-');

      if (airdropId && targetDate) {
        const timer = new AirdropTimer(airdropId, targetDate, isStartTimer);
        timer.start();
        activeTimers.push(timer);
      }
    });
  }

  // Project-Airdrop Wheel Manager
  // Use data loaded from /public/data/purple-point/projects/projects.json
  const PROJECTS = PROJECTS_DATA || [
    { name: 'Kakuma', icon: 'üèïÔ∏è', description: 'Environmental projects in Kakuma refugee camp' },
    { name: 'Music', icon: 'üéµ', description: 'Music production and artist development' },
    { name: 'Learning', icon: 'üìö', description: 'Educational courses and certification programs' },
    { name: 'Battles', icon: '‚öîÔ∏è', description: 'Creative rap battles and competitions' },
    { name: 'Achievements', icon: 'üèÜ', description: 'Milestone tracking and recognition system' }
  ];

  let PROJECT_AIRDROP_COMBINATIONS = [];

  function generateCombinations() {
    PROJECT_AIRDROP_COMBINATIONS = [];
    PROJECTS.forEach(project => {
      REWARD_TEMPLATES.forEach(airdrop => {
        PROJECT_AIRDROP_COMBINATIONS.push({
          id: `${project.name.toLowerCase()}-${airdrop.id}`,
          project: project.name,
          projectIcon: project.icon,
          projectDescription: project.description,
          airdrop: airdrop.id,
          airdropName: airdrop.name,
          airdropIcon: airdrop.icon,
          airdropDescription: airdrop.description,
          category: airdrop.category
        });
      });
    });
    return PROJECT_AIRDROP_COMBINATIONS;
  }

  class WheelManager {
    constructor() {
      this.combinations = generateCombinations();
      this.currentIndex = 0;
      this.autoplay = true;
      this.intervalId = null;
      this.rotationSpeed = 3000; // 3 seconds per combo
    }

    start() {
      this.render();
      if (this.autoplay) {
        this.intervalId = setInterval(() => this.next(), this.rotationSpeed);
      }
    }

    next() {
      this.currentIndex = (this.currentIndex + 1) % this.combinations.length;
      this.render();
    }

    previous() {
      this.currentIndex = (this.currentIndex - 1 + this.combinations.length) % this.combinations.length;
      this.render();
    }

    toggleAutoplay() {
      this.autoplay = !this.autoplay;

      const icon = document.getElementById('autoplay-icon');
      const text = document.getElementById('autoplay-text');

      if (this.autoplay) {
        icon.textContent = '‚è∏Ô∏è';
        text.textContent = 'Pause';
        this.intervalId = setInterval(() => this.next(), this.rotationSpeed);
      } else {
        icon.textContent = '‚ñ∂Ô∏è';
        text.textContent = 'Play';
        if (this.intervalId) {
          clearInterval(this.intervalId);
          this.intervalId = null;
        }
      }
    }

    render() {
      const combo = this.combinations[this.currentIndex];
      if (!combo) return;

      // Update wheel display
      const wheelCurrent = document.getElementById('wheel-current');
      if (wheelCurrent) {
        wheelCurrent.innerHTML = `
          <div class="combo-project">
            <span class="project-icon">${combo.projectIcon}</span>
            <span class="project-name">${combo.project}</span>
          </div>
          <div class="combo-connector">√ó</div>
          <div class="combo-airdrop">
            <span class="airdrop-icon">${combo.airdropIcon}</span>
            <span class="airdrop-name">${combo.airdropName}</span>
          </div>
        `;

        // Trigger animation
        wheelCurrent.classList.remove('fade-in');
        setTimeout(() => wheelCurrent.classList.add('fade-in'), 10);
      }

      // Update description
      const description = document.getElementById('combo-description');
      if (description) {
        description.textContent = `${combo.projectDescription} + ${combo.airdropDescription}`;
      }

      // Update stats
      const currentSpan = document.getElementById('combo-current');
      const totalSpan = document.getElementById('combo-total');
      if (currentSpan) currentSpan.textContent = this.currentIndex + 1;
      if (totalSpan) totalSpan.textContent = this.combinations.length;

      // Update progress bar
      const progressBar = document.getElementById('wheel-progress');
      if (progressBar) {
        const percentage = ((this.currentIndex + 1) / this.combinations.length) * 100;
        progressBar.style.width = `${percentage}%`;
      }
    }
  }

  // Calendar Manager
  // Build color and icon mappings from loaded event domains data
  const ACTIVITY_COLORS = {};
  const ACTIVITY_ICONS = {};
  const ACTIVITY_CATEGORIES = {};

  if (EVENT_DOMAINS_DATA) {
    EVENT_DOMAINS_DATA.forEach(domain => {
      const domainName = domain.name;
      ACTIVITY_ICONS[domainName] = domain.icon;
      ACTIVITY_CATEGORIES[domainName] = domain.categories;

      if (!ACTIVITY_COLORS.primary) ACTIVITY_COLORS.primary = {};
      if (!ACTIVITY_COLORS.secondary) ACTIVITY_COLORS.secondary = {};
      if (!ACTIVITY_COLORS.tertiary) ACTIVITY_COLORS.tertiary = {};

      ACTIVITY_COLORS.primary[domainName] = domain.colors.primary;
      ACTIVITY_COLORS.secondary[domainName] = domain.colors.secondary;
      ACTIVITY_COLORS.tertiary[domainName] = domain.colors.tertiary;
    });
  } else {
    // Fallback to hardcoded values if data not loaded
    ACTIVITY_COLORS.primary = {
      Learning: '#10b981',
      Cultural: '#667eea',
      Artistic: '#f093fb',
      Financial: '#f59e0b'
    };
    ACTIVITY_COLORS.secondary = {
      Learning: '#86efac',
      Cultural: '#a5b4fc',
      Artistic: '#fbbf24',
      Financial: '#fcd34d'
    };
    ACTIVITY_COLORS.tertiary = {
      Learning: '#d1fae5',
      Cultural: '#e0e7ff',
      Artistic: '#fef3c7',
      Financial: '#fef9c3'
    };
    ACTIVITY_ICONS.Learning = 'üå±';
    ACTIVITY_ICONS.Cultural = 'üéµ';
    ACTIVITY_ICONS.Artistic = 'üé®';
    ACTIVITY_ICONS.Financial = 'üí∞';
  }

  function generateCalendarData() {
    const activities = [];
    const today = new Date();

    for (let i = 0; i < 7; i++) {
      const date = new Date(today);
      date.setDate(today.getDate() + i);

      const dayOfWeek = date.getDay();
      const dateStr = date.toISOString().split('T')[0];

      // Rotate through domains based on day
      const domains = ['Learning', 'Cultural', 'Artistic', 'Financial'];
      const primaryDomain = domains[dayOfWeek % 4];
      const secondaryDomain = domains[(dayOfWeek + 1) % 4];
      const tertiaryDomain = domains[(dayOfWeek + 2) % 4];

      activities.push({
        date: dateStr,
        dayOfWeek: date.toLocaleDateString('en-US', { weekday: 'short' }),
        dayOfMonth: date.getDate(),
        isToday: date.toDateString() === today.toDateString(),
        primary: {
          type: primaryDomain,
          category: getActivityCategory(primaryDomain, 'primary'),
          icon: ACTIVITY_ICONS[primaryDomain]
        },
        secondary: {
          type: secondaryDomain,
          category: getActivityCategory(secondaryDomain, 'secondary'),
          icon: ACTIVITY_ICONS[secondaryDomain]
        },
        tertiary: {
          type: tertiaryDomain,
          category: getActivityCategory(tertiaryDomain, 'tertiary'),
          icon: ACTIVITY_ICONS[tertiaryDomain]
        }
      });
    }

    return activities;
  }

  function getActivityCategory(domain, priority) {
    // Use loaded categories from event domains data
    const domainCategories = ACTIVITY_CATEGORIES[domain] || ['General Activity'];
    const index = (priority === 'primary' ? 0 : priority === 'secondary' ? 1 : 2) % domainCategories.length;
    return domainCategories[index];
  }

  function renderCalendar() {
    const calendarData = generateCalendarData();
    const gridContainer = document.getElementById('calendar-grid');

    if (!gridContainer) return;

    gridContainer.innerHTML = calendarData.map(day => `
      <div class="calendar-day ${day.isToday ? 'today' : ''}" data-date="${day.date}">
        <div class="day-header">
          <div class="day-name">${day.dayOfWeek}</div>
          <div class="day-date">${day.dayOfMonth}</div>
        </div>
        <div class="day-activities">
          <div class="activity-block primary ${day.primary.type.toLowerCase()}"
               style="background: ${ACTIVITY_COLORS.primary[day.primary.type]};"
               data-tooltip="${day.primary.type}: ${day.primary.category}"
               title="${day.primary.type}: ${day.primary.category}">
            <span class="activity-icon">${day.primary.icon}</span>
          </div>
          <div class="activity-block secondary ${day.secondary.type.toLowerCase()}"
               style="background: ${ACTIVITY_COLORS.secondary[day.secondary.type]};"
               data-tooltip="${day.secondary.type}: ${day.secondary.category}"
               title="${day.secondary.type}: ${day.secondary.category}">
            <span class="activity-icon">${day.secondary.icon}</span>
          </div>
          <div class="activity-block tertiary ${day.tertiary.type.toLowerCase()}"
               style="background: ${ACTIVITY_COLORS.tertiary[day.tertiary.type]};"
               data-tooltip="${day.tertiary.type}: ${day.tertiary.category}"
               title="${day.tertiary.type}: ${day.tertiary.category}">
            <span class="activity-icon">${day.tertiary.icon}</span>
          </div>
        </div>
      </div>
    `).join('');
  }

  // Date/Time Display Manager
  function updateDateTime() {
    const now = new Date();

    // Format date: "Thursday, January 2, 2026"
    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const formattedDate = now.toLocaleDateString('en-US', dateOptions);

    // Format time: "2:34 PM"
    const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
    const formattedTime = now.toLocaleTimeString('en-US', timeOptions);

    // Update DOM
    const dateElement = document.getElementById('current-date');
    const timeElement = document.getElementById('current-time');

    if (dateElement) dateElement.textContent = formattedDate;
    if (timeElement) timeElement.textContent = formattedTime;
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    // Update date/time immediately and then every second
    updateDateTime();
    setInterval(updateDateTime, 1000);

    // Render calendar
    renderCalendar();

    // Initialize wheel
    window.wheelManager = new WheelManager();
    window.wheelManager.start();

    setTimeout(() => {
      window.airdropManager = new AirdropManager();
    }, 500);
  });
</script>

<style>
  .airdrop-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .rewards-template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .reward-card {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: all 0.3s;
    border: 2px solid transparent;
  }

  .reward-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }

  .reward-card.active-airdrop {
    border-color: #10b981;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .reward-card.upcoming-airdrop {
    border-color: #f59e0b;
    opacity: 0.9;
  }

  .reward-card.claimed {
    opacity: 0.6;
    border-color: #9ca3af;
  }

  .reward-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin-bottom: 1rem;
    color: white;
  }

  .reward-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 0.75rem;
    gap: 0.5rem;
  }

  .reward-name {
    font-size: 1.125rem;
    font-weight: bold;
    margin: 0;
    flex: 1;
  }

  .reward-category-badge {
    font-size: 0.625rem;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    color: white;
    font-weight: 700;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .reward-description {
    color: #666;
    font-size: 0.875rem;
    margin-bottom: 1rem;
    line-height: 1.5;
  }

  .reward-amounts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
  }

  .reward-amount {
    text-align: center;
  }

  .amount-value {
    font-size: 1.25rem;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 0.25rem;
  }

  .amount-label {
    font-size: 0.75rem;
    color: #666;
  }

  .reward-requirements {
    margin-bottom: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
  }

  .requirements-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
  }

  .requirement-item {
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 0.25rem;
  }

  .reward-frequency {
    font-size: 0.75rem;
    color: #667eea;
    font-weight: 600;
    margin-bottom: 1rem;
    text-align: center;
    padding: 0.5rem;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 0.5rem;
  }

  .claim-btn {
    width: 100%;
    padding: 0.875rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .claim-btn:hover:not(.claimed) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .claim-btn.claimed {
    background: #9ca3af;
    cursor: not-allowed;
  }

  .upcoming-badge, .template-badge {
    text-align: center;
    padding: 0.75rem;
    background: #f3f4f6;
    color: #6b7280;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .category-tab {
    padding: 0.75rem 1.5rem;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 600;
  }

  .category-tab:hover {
    border-color: #667eea;
  }

  .category-tab.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
  }

  .btn-white {
    background: white;
    color: #667eea;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    border: none;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-white:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255,255,255,0.3);
  }

  .btn-white-outline {
    background: transparent;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    border: 2px solid rgba(255,255,255,0.5);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-white-outline:hover {
    border-color: white;
    background: rgba(255,255,255,0.1);
  }

  .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: #9ca3af;
    font-style: italic;
    grid-column: 1 / -1;
  }

  /* Calendar Styles */
  .calendar-week {
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    margin-bottom: 3rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .calendar-legend {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #666;
  }

  .legend-box {
    width: 20px;
    height: 20px;
    border-radius: 0.25rem;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1rem;
  }

  .calendar-day {
    border: 2px solid #e5e7eb;
    border-radius: 0.5rem;
    padding: 1rem;
    transition: all 0.3s;
    background: #f9fafb;
  }

  .calendar-day.today {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    background: white;
  }

  .calendar-day:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .day-header {
    text-align: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .day-name {
    font-size: 0.75rem;
    font-weight: 600;
    color: #667eea;
    text-transform: uppercase;
    margin-bottom: 0.25rem;
  }

  .day-date {
    font-size: 1.25rem;
    font-weight: bold;
    color: #374151;
  }

  .day-activities {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .activity-block {
    height: 60px;
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }

  .activity-block:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  .activity-icon {
    font-size: 1.5rem;
  }

  /* Mobile Responsive Calendar */
  @media (max-width: 768px) {
    .calendar-grid {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .calendar-day {
      padding: 0.75rem;
    }

    .day-activities {
      flex-direction: row;
      gap: 0.5rem;
    }

    .activity-block {
      height: 50px;
      flex: 1;
    }

    .activity-icon {
      font-size: 1.25rem;
    }
  }

  /* Wheel Styles */
  .combination-wheel {
    background: linear-gradient(180deg, #f9fafb 0%, white 100%);
    padding: 3rem 2rem;
    border-radius: 1rem;
    margin-bottom: 3rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .wheel-subtitle {
    text-align: center;
    color: #666;
    font-size: 0.875rem;
    margin-bottom: 2rem;
    font-style: italic;
  }

  .wheel-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    margin: 2rem 0;
    min-height: 200px;
  }

  .wheel-current {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    font-size: 1.5rem;
    padding: 2rem;
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .wheel-current.fade-in {
    animation: fadeInScale 0.5s ease;
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .combo-project, .combo-airdrop {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .project-icon, .airdrop-icon {
    font-size: 3rem;
  }

  .project-name, .airdrop-name {
    font-weight: bold;
    color: #374151;
  }

  .combo-connector {
    font-size: 2rem;
    color: #667eea;
    font-weight: bold;
  }

  .wheel-info {
    text-align: center;
    max-width: 600px;
  }

  .combo-description {
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .combo-stats {
    font-size: 0.75rem;
    color: #999;
    font-weight: 600;
  }

  .combo-stats span {
    color: #667eea;
    font-weight: bold;
  }

  .wheel-controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
  }

  .btn-wheel {
    padding: 0.75rem 1.5rem;
    background: white;
    border: 2px solid #667eea;
    border-radius: 0.5rem;
    color: #667eea;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-wheel:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }

  .wheel-progress-bar {
    width: 100%;
    height: 6px;
    background: #e5e7eb;
    border-radius: 3px;
    margin-top: 2rem;
    overflow: hidden;
  }

  .wheel-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.3s ease;
    border-radius: 3px;
  }

  /* Mobile Responsive Wheel */
  @media (max-width: 768px) {
    .wheel-current {
      flex-direction: column;
      gap: 1rem;
      font-size: 1.125rem;
      padding: 1.5rem;
    }

    .project-icon, .airdrop-icon {
      font-size: 2rem;
    }

    .combo-connector {
      font-size: 1.5rem;
      transform: rotate(90deg);
    }

    .wheel-controls {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .btn-wheel {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }
  }

  /* Countdown Timer Styles */
  .countdown-timer {
    font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
    font-size: 1.125rem;
    font-weight: bold;
    color: #667eea;
    text-align: center;
  }

  .countdown-timer.urgent {
    color: #ef4444;
    animation: pulse 1.5s ease-in-out infinite;
  }

  .countdown-timer.expired {
    color: #9ca3af;
    font-style: italic;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.6;
    }
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: 1rem;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
    z-index: 10000;
  }

  @keyframes slideUp {
    from {
      transform: translateY(30px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .modal-header h3 {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0;
    color: #111827;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    color: #9ca3af;
    cursor: pointer;
    padding: 0;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.5rem;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: #f3f4f6;
    color: #374151;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 2px solid #e5e7eb;
  }

  .btn-primary, .btn-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .btn-secondary {
    background: #e5e7eb;
    color: #374151;
  }

  .btn-secondary:hover {
    background: #d1d5db;
  }

  /* Toast Notifications */
  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    font-weight: 600;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    z-index: 10001;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.3s ease;
    max-width: 400px;
  }

  .toast.show {
    transform: translateX(0);
    opacity: 1;
  }

  .toast-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
  }

  .toast-error {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
  }

  .toast-info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .modal-content {
      width: 95%;
      max-height: 85vh;
    }

    .modal-header {
      padding: 1rem;
    }

    .modal-body {
      padding: 1rem;
    }

    .modal-actions {
      flex-direction: column-reverse;
    }

    .modal-actions button {
      width: 100%;
    }

    .toast {
      right: 1rem;
      left: 1rem;
      bottom: 1rem;
      max-width: calc(100% - 2rem);
    }

    .airdrop-grid,
    .rewards-template-grid {
      grid-template-columns: 1fr;
    }

    .calendar-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

