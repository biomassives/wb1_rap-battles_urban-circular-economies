---
/**
 * interact.astro
 * Community Interaction Panel
 *
 * Multi-role dashboard for:
 * - Rap Battles (MC/Judge/Spectator)
 * - Reggae Collaborations (Artist/Producer/Contributor)
 * - Urban Environmental Tech (Developer/Researcher/Citizen Scientist)
 * - Food Security Projects (Grower/Organizer/Supporter)
 */
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Community Interaction Panel"
  description="Engage with battles, collaborations, environmental tech, and food security projects"
  activeSection="music"
>

  <section class="interaction-panel">
    <div class="container mx-auto" style="padding: 2rem;">

      <!-- Header -->
      <div class="panel-header" style="margin-bottom: 3rem;">
        <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">
          üåç Community Interaction Panel
        </h1>
        <p style="color: #666; font-size: 1.125rem;">
          Connect, create, and collaborate across music, tech, and sustainability
        </p>
      </div>

      <!-- Role Selector -->
      <div class="role-selector-panel" style="margin-bottom: 3rem;">
        <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">
          Select Your Primary Role
        </h2>
        <div class="role-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">

          <div class="role-card active" data-role="mc">
            <div class="role-icon">üé§</div>
            <div class="role-name">MC / Rapper</div>
            <div class="role-subtitle">Battles & Lyrics</div>
          </div>

          <div class="role-card" data-role="musician">
            <div class="role-icon">üéµ</div>
            <div class="role-name">Musician</div>
            <div class="role-subtitle">Reggae & Collabs</div>
          </div>

          <div class="role-card" data-role="developer">
            <div class="role-icon">üíª</div>
            <div class="role-name">Developer</div>
            <div class="role-subtitle">Open Tech</div>
          </div>

          <div class="role-card" data-role="grower">
            <div class="role-icon">üå±</div>
            <div class="role-name">Grower</div>
            <div class="role-subtitle">Food Security</div>
          </div>

          <div class="role-card" data-role="activist">
            <div class="role-icon">‚úä</div>
            <div class="role-name">Activist</div>
            <div class="role-subtitle">Environmental</div>
          </div>

          <div class="role-card" data-role="supporter">
            <div class="role-icon">ü§ù</div>
            <div class="role-name">Supporter</div>
            <div class="role-subtitle">All Projects</div>
          </div>

        </div>
      </div>

      <!-- Activity Dashboard -->
      <div id="activity-dashboard" class="activity-dashboard">

        <!-- RAP BATTLES SECTION -->
        <div class="activity-section rap-battles" data-roles="mc,supporter">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
              <h2 style="font-size: 1.75rem; font-weight: bold;">‚öîÔ∏è Rap Battles</h2>
              <p style="color: #666;">Compete, judge, and spectate epic lyrical showdowns</p>
            </div>
            <button class="btn-primary" onclick="window.interactionPanel?.createBattle()">
              + New Battle
            </button>
          </div>

          <div class="activity-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

            <!-- Open Battles -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üîî</div>
                <h3>Open Challenges</h3>
              </div>
              <div class="card-content">
                <div id="open-battles-list" class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Flow Master</strong> seeks challenger
                      <div class="item-meta">Wordplay ‚Ä¢ 3 rounds ‚Ä¢ 0.5 SOL</div>
                    </div>
                    <button class="btn-small">Accept</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Lyric King</strong> awaits opponent
                      <div class="item-meta">Conscious ‚Ä¢ 3 rounds ‚Ä¢ 1 SOL</div>
                    </div>
                    <button class="btn-small">Accept</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/music?filter=battles">View All ‚Üí</a>
              </div>
            </div>

            <!-- Your Active Battles -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">‚öîÔ∏è</div>
                <h3>Your Active Battles</h3>
              </div>
              <div class="card-content">
                <div id="active-battles-list" class="list-items">
                  <div class="empty-state">
                    No active battles
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <button onclick="window.interactionPanel?.viewMyBattles()">View History ‚Üí</button>
              </div>
            </div>

            <!-- Judge Opportunities -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">‚öñÔ∏è</div>
                <h3>Judge & Vote</h3>
              </div>
              <div class="card-content">
                <div id="judge-battles-list" class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Battle #42</strong> needs judges
                      <div class="item-meta">Voting ends in 4h ‚Ä¢ +10 XP</div>
                    </div>
                    <button class="btn-small">Judge</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/music?tab=voting">All Voting ‚Üí</a>
              </div>
            </div>

          </div>

          <!-- Battle Categories -->
          <div class="category-chips" style="margin-top: 1.5rem;">
            <span class="chip active">All</span>
            <span class="chip">üß† Conscious Bars</span>
            <span class="chip">üé≠ Wordplay Wizard</span>
            <span class="chip">üåä Flow Master</span>
            <span class="chip">üìñ Storyteller</span>
            <span class="chip">üèïÔ∏è Kakuma Chronicles</span>
            <span class="chip">üé≤ Freestyle</span>
          </div>
        </div>

        <!-- REGGAE COLLABORATIONS SECTION -->
        <div class="activity-section reggae-collabs" data-roles="musician,mc,supporter">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
              <h2 style="font-size: 1.75rem; font-weight: bold;">üéµ Reggae Collaborations</h2>
              <p style="color: #666;">Connect with artists, create together, share the vibes</p>
            </div>
            <button class="btn-primary" onclick="window.interactionPanel?.startCollab()">
              + Start Collab
            </button>
          </div>

          <div class="activity-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

            <!-- Open Collabs -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üé∏</div>
                <h3>Open Collaborations</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>"One Love Remix"</strong>
                      <div class="item-meta">Need: Vocals, Bass ‚Ä¢ Roots Reggae</div>
                      <div class="collab-tags">
                        <span class="tag">üé§ Vocals Needed</span>
                        <span class="tag">üé∏ Bass Needed</span>
                      </div>
                    </div>
                    <button class="btn-small">Join</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>"Freedom Dub"</strong>
                      <div class="item-meta">Need: Keys, Percussion ‚Ä¢ Dub</div>
                      <div class="collab-tags">
                        <span class="tag">üéπ Keys Needed</span>
                      </div>
                    </div>
                    <button class="btn-small">Join</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/collaborations">Browse All ‚Üí</a>
              </div>
            </div>

            <!-- Your Collaborations -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üë•</div>
                <h3>Your Collabs</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="empty-state">
                    No active collaborations
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <button onclick="window.interactionPanel?.viewMyCollabs()">View All ‚Üí</button>
              </div>
            </div>

            <!-- Matching Suggestions -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üéØ</div>
                <h3>Suggested Matches</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>SunnyVoice</strong>
                      <div class="item-meta">Vocalist ‚Ä¢ Similar style ‚Ä¢ 92% match</div>
                    </div>
                    <button class="btn-small">Connect</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/find-collaborators">Find More ‚Üí</a>
              </div>
            </div>

          </div>

          <!-- Collab Styles -->
          <div class="category-chips" style="margin-top: 1.5rem;">
            <span class="chip active">All Styles</span>
            <span class="chip">üå¥ Roots</span>
            <span class="chip">üîä Dub</span>
            <span class="chip">‚ö° Dancehall</span>
            <span class="chip">üé∫ Ska</span>
            <span class="chip">üåä Lovers Rock</span>
            <span class="chip">üî• Ragga</span>
          </div>
        </div>

        <!-- URBAN ENVIRONMENTAL TECH SECTION -->
        <div class="activity-section env-tech" data-roles="developer,activist,supporter">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
              <h2 style="font-size: 1.75rem; font-weight: bold;">üíª Urban Environmental Open Tech</h2>
              <p style="color: #666;">Build, contribute, and deploy sustainable tech solutions</p>
            </div>
            <button class="btn-primary" onclick="window.interactionPanel?.createProject()">
              + New Project
            </button>
          </div>

          <div class="activity-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

            <!-- Active Projects -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üöÄ</div>
                <h3>Active Projects</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Solar Tracker IoT</strong>
                      <div class="item-meta">Arduino ‚Ä¢ Python ‚Ä¢ 5 contributors</div>
                      <div class="progress-mini">
                        <div class="progress-fill" style="width: 65%"></div>
                      </div>
                      <div class="item-meta">65% complete</div>
                    </div>
                    <button class="btn-small">Contribute</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Air Quality Monitor</strong>
                      <div class="item-meta">Raspberry Pi ‚Ä¢ Node.js ‚Ä¢ 8 contributors</div>
                      <div class="progress-mini">
                        <div class="progress-fill" style="width: 40%"></div>
                      </div>
                      <div class="item-meta">40% complete</div>
                    </div>
                    <button class="btn-small">Contribute</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/learning#projects">View All Projects ‚Üí</a>
              </div>
            </div>

            <!-- Contribution Opportunities -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üõ†Ô∏è</div>
                <h3>Help Wanted</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Need: Frontend Dev</strong>
                      <div class="item-meta">Water Monitor Dashboard ‚Ä¢ React</div>
                      <span class="tag tag-urgent">Urgent</span>
                    </div>
                    <button class="btn-small">Help</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Need: Hardware Tester</strong>
                      <div class="item-meta">Soil Sensor Calibration</div>
                    </div>
                    <button class="btn-small">Help</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/learning#help-wanted">All Opportunities ‚Üí</a>
              </div>
            </div>

            <!-- Your Contributions -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üìä</div>
                <h3>Your Impact</h3>
              </div>
              <div class="card-content">
                <div class="stats-mini">
                  <div class="stat-mini">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Projects</div>
                  </div>
                  <div class="stat-mini">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Commits</div>
                  </div>
                  <div class="stat-mini">
                    <div class="stat-value">0</div>
                    <div class="stat-label">Issues Closed</div>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <button onclick="window.interactionPanel?.viewMyContributions()">View Details ‚Üí</button>
              </div>
            </div>

          </div>

          <!-- Tech Categories -->
          <div class="category-chips" style="margin-top: 1.5rem;">
            <span class="chip active">All Tech</span>
            <span class="chip">‚òÄÔ∏è Solar</span>
            <span class="chip">üíß Water</span>
            <span class="chip">üå¨Ô∏è Air Quality</span>
            <span class="chip">üå°Ô∏è Climate</span>
            <span class="chip">‚ôªÔ∏è Recycling</span>
            <span class="chip">üèôÔ∏è Smart City</span>
          </div>
        </div>

        <!-- FOOD SECURITY SECTION -->
        <div class="activity-section food-security" data-roles="grower,activist,supporter">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
              <h2 style="font-size: 1.75rem; font-weight: bold;">üå± Food Security Projects</h2>
              <p style="color: #666;">Grow together, share knowledge, build resilient food systems</p>
            </div>
            <button class="btn-primary" onclick="window.interactionPanel?.startGarden()">
              + Start Garden
            </button>
          </div>

          <div class="activity-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

            <!-- Community Gardens -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üè°</div>
                <h3>Community Gardens</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Kakuma Victory Garden</strong>
                      <div class="item-meta">45 plots ‚Ä¢ 120 participants</div>
                      <div class="item-tags">
                        <span class="tag tag-active">üå± Active</span>
                        <span class="tag">ü•¨ Vegetables</span>
                      </div>
                    </div>
                    <button class="btn-small">Join</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Urban Rooftop Farm</strong>
                      <div class="item-meta">12 plots ‚Ä¢ 30 participants</div>
                      <div class="item-tags">
                        <span class="tag tag-active">üå± Active</span>
                        <span class="tag">üçÖ Mixed</span>
                      </div>
                    </div>
                    <button class="btn-small">Join</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/gardens">Find Gardens ‚Üí</a>
              </div>
            </div>

            <!-- Knowledge Sharing -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">üìö</div>
                <h3>Learn & Share</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Composting Workshop</strong>
                      <div class="item-meta">Tomorrow 2pm ‚Ä¢ 15 spots left</div>
                    </div>
                    <button class="btn-small">Register</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Seed Saving Basics</strong>
                      <div class="item-meta">Online ‚Ä¢ Watch anytime</div>
                    </div>
                    <button class="btn-small">Watch</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/learning#food">All Workshops ‚Üí</a>
              </div>
            </div>

            <!-- Harvest Sharing -->
            <div class="activity-card">
              <div class="card-header">
                <div class="card-icon">ü•ï</div>
                <h3>Harvest & Trade</h3>
              </div>
              <div class="card-content">
                <div class="list-items">
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Available: Tomatoes</strong>
                      <div class="item-meta">5kg ‚Ä¢ Ready now</div>
                    </div>
                    <button class="btn-small">Request</button>
                  </div>
                  <div class="list-item">
                    <div class="item-content">
                      <strong>Wanted: Lettuce Seeds</strong>
                      <div class="item-meta">Will trade kale</div>
                    </div>
                    <button class="btn-small">Offer</button>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <a href="/harvest-exchange">View Exchange ‚Üí</a>
              </div>
            </div>

          </div>

          <!-- Growing Methods -->
          <div class="category-chips" style="margin-top: 1.5rem;">
            <span class="chip active">All Methods</span>
            <span class="chip">üåø Permaculture</span>
            <span class="chip">üíß Hydroponics</span>
            <span class="chip">üè¢ Vertical</span>
            <span class="chip">‚ôªÔ∏è Aquaponics</span>
            <span class="chip">üåæ Traditional</span>
            <span class="chip">üå± Organic</span>
          </div>
        </div>

        <!-- CROSS-ACTIVITY OPPORTUNITIES -->
        <div class="activity-section cross-activity" data-roles="all">
          <div class="section-header" style="margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.75rem; font-weight: bold;">üåü Cross-Activity Opportunities</h2>
            <p style="color: #666;">Unique projects that combine multiple areas</p>
          </div>

          <div class="activity-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

            <div class="activity-card highlight">
              <div class="card-header">
                <div class="card-icon">üéµüå±</div>
                <h3>Music for Gardens</h3>
              </div>
              <div class="card-content">
                <p>Create reggae tracks inspired by urban farming, with proceeds supporting community gardens</p>
                <div class="item-tags" style="margin-top: 1rem;">
                  <span class="tag">Music</span>
                  <span class="tag">Food Security</span>
                  <span class="tag">Impact</span>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn-primary">Join Initiative ‚Üí</button>
              </div>
            </div>

            <div class="activity-card highlight">
              <div class="card-header">
                <div class="card-icon">üíªüåæ</div>
                <h3>Tech for Food</h3>
              </div>
              <div class="card-content">
                <p>Build IoT monitoring systems for community gardens using open-source hardware</p>
                <div class="item-tags" style="margin-top: 1rem;">
                  <span class="tag">Tech</span>
                  <span class="tag">Food Security</span>
                  <span class="tag">Open Source</span>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn-primary">Start Building ‚Üí</button>
              </div>
            </div>

            <div class="activity-card highlight">
              <div class="card-header">
                <div class="card-icon">üé§üèïÔ∏è</div>
                <h3>Kakuma Voices</h3>
              </div>
              <div class="card-content">
                <p>Rap battles with themes about refugee experiences, environmental challenges, and resilience</p>
                <div class="item-tags" style="margin-top: 1rem;">
                  <span class="tag">Battles</span>
                  <span class="tag">Kakuma</span>
                  <span class="tag">Storytelling</span>
                </div>
              </div>
              <div class="card-footer">
                <button class="btn-primary">Create Battle ‚Üí</button>
              </div>
            </div>

          </div>
        </div>

      </div>

    </div>
  </section>

  <!-- MODALS -->

  <!-- Create Battle Modal -->
  <div id="create-battle-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.interactionPanel?.closeModal('create-battle-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚öîÔ∏è Create New Battle</h3>
        <button class="modal-close" onclick="window.interactionPanel?.closeModal('create-battle-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="create-battle-form" onsubmit="window.interactionPanel?.submitBattle(event)">
          <div class="form-group">
            <label for="battle-title">Battle Title *</label>
            <input type="text" id="battle-title" name="title" placeholder="e.g., Climate Champions Showdown" required>
          </div>

          <div class="form-group">
            <label for="battle-theme">Theme / Topic *</label>
            <select id="battle-theme" name="theme" required>
              <option value="">Select theme...</option>
              <option value="environmental">Environmental Justice</option>
              <option value="cultural">Cultural Heritage</option>
              <option value="social">Social Change</option>
              <option value="freestyle">Freestyle / No Theme</option>
            </select>
          </div>

          <div class="form-group">
            <label for="battle-rounds">Number of Rounds *</label>
            <select id="battle-rounds" name="rounds" required>
              <option value="1">1 Round</option>
              <option value="2">2 Rounds</option>
              <option value="3" selected>3 Rounds (Standard)</option>
              <option value="5">5 Rounds (Extended)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="battle-deadline">Submission Deadline *</label>
            <input type="datetime-local" id="battle-deadline" name="deadline" required>
          </div>

          <div class="form-group">
            <label for="battle-prize">Prize Pool (Optional)</label>
            <input type="number" id="battle-prize" name="prize" placeholder="Tokens" min="0">
          </div>

          <div class="form-group">
            <label for="battle-description">Description</label>
            <textarea id="battle-description" name="description" rows="3" placeholder="Describe your battle..."></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="window.interactionPanel?.closeModal('create-battle-modal')">Cancel</button>
            <button type="submit" class="btn-primary">Create Battle</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Start Collaboration Modal -->
  <div id="start-collab-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.interactionPanel?.closeModal('start-collab-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>üéµ Start Collaboration</h3>
        <button class="modal-close" onclick="window.interactionPanel?.closeModal('start-collab-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="start-collab-form" onsubmit="window.interactionPanel?.submitCollab(event)">
          <div class="form-group">
            <label for="collab-title">Collaboration Title *</label>
            <input type="text" id="collab-title" name="title" placeholder="e.g., Island Vibes Riddim" required>
          </div>

          <div class="form-group">
            <label for="collab-type">Collaboration Type *</label>
            <select id="collab-type" name="type" required>
              <option value="">Select type...</option>
              <option value="track">Full Track</option>
              <option value="riddim">Riddim/Beat</option>
              <option value="vocals">Vocals Only</option>
              <option value="remix">Remix</option>
            </select>
          </div>

          <div class="form-group">
            <label for="collab-genre">Genre *</label>
            <select id="collab-genre" name="genre" required>
              <option value="">Select genre...</option>
              <option value="reggae">Reggae</option>
              <option value="dancehall">Dancehall</option>
              <option value="afrobeat">Afrobeat</option>
              <option value="hip-hop">Hip Hop</option>
              <option value="fusion">Fusion</option>
            </select>
          </div>

          <div class="form-group">
            <label for="collab-roles">Looking For *</label>
            <div class="checkbox-group">
              <label><input type="checkbox" name="roles" value="vocalist"> Vocalist</label>
              <label><input type="checkbox" name="roles" value="producer"> Producer</label>
              <label><input type="checkbox" name="roles" value="instrumentalist"> Instrumentalist</label>
              <label><input type="checkbox" name="roles" value="mixer"> Mixing Engineer</label>
            </div>
          </div>

          <div class="form-group">
            <label for="collab-description">Description</label>
            <textarea id="collab-description" name="description" rows="3" placeholder="Describe your vision..."></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="window.interactionPanel?.closeModal('start-collab-modal')">Cancel</button>
            <button type="submit" class="btn-primary">Start Collaboration</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Create Project Modal -->
  <div id="create-project-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.interactionPanel?.closeModal('create-project-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>üíª Create New Project</h3>
        <button class="modal-close" onclick="window.interactionPanel?.closeModal('create-project-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="create-project-form" onsubmit="window.interactionPanel?.submitProject(event)">
          <div class="form-group">
            <label for="project-title">Project Title *</label>
            <input type="text" id="project-title" name="title" placeholder="e.g., Air Quality Monitor" required>
          </div>

          <div class="form-group">
            <label for="project-category">Category *</label>
            <select id="project-category" name="category" required>
              <option value="">Select category...</option>
              <option value="climate">Climate & Weather</option>
              <option value="water">Water Quality</option>
              <option value="air">Air Quality</option>
              <option value="biodiversity">Biodiversity</option>
              <option value="waste">Waste Management</option>
              <option value="energy">Renewable Energy</option>
            </select>
          </div>

          <div class="form-group">
            <label for="project-tech">Technology Stack</label>
            <input type="text" id="project-tech" name="tech" placeholder="e.g., Raspberry Pi, Python, Sensors">
          </div>

          <div class="form-group">
            <label for="project-impact">Expected Impact *</label>
            <textarea id="project-impact" name="impact" rows="3" placeholder="What environmental problem will this solve?" required></textarea>
          </div>

          <div class="form-group">
            <label for="project-description">Full Description</label>
            <textarea id="project-description" name="description" rows="4" placeholder="Describe your project in detail..."></textarea>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" name="open-source" value="yes"> Open Source (Share with community)
            </label>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="window.interactionPanel?.closeModal('create-project-modal')">Cancel</button>
            <button type="submit" class="btn-primary">Create Project</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Start Garden Modal -->
  <div id="start-garden-modal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="window.interactionPanel?.closeModal('start-garden-modal')"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>üå± Start New Garden</h3>
        <button class="modal-close" onclick="window.interactionPanel?.closeModal('start-garden-modal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="start-garden-form" onsubmit="window.interactionPanel?.submitGarden(event)">
          <div class="form-group">
            <label for="garden-name">Garden Name *</label>
            <input type="text" id="garden-name" name="name" placeholder="e.g., Kakuma Community Garden" required>
          </div>

          <div class="form-group">
            <label for="garden-location">Location *</label>
            <input type="text" id="garden-location" name="location" placeholder="Community, neighborhood, or coordinates" required>
          </div>

          <div class="form-group">
            <label for="garden-size">Garden Size</label>
            <select id="garden-size" name="size">
              <option value="small">Small (< 100 sq ft)</option>
              <option value="medium" selected>Medium (100-500 sq ft)</option>
              <option value="large">Large (500-2000 sq ft)</option>
              <option value="xlarge">Extra Large (> 2000 sq ft)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="garden-type">Garden Type *</label>
            <div class="checkbox-group">
              <label><input type="checkbox" name="type" value="vegetables"> Vegetables</label>
              <label><input type="checkbox" name="type" value="herbs"> Herbs</label>
              <label><input type="checkbox" name="type" value="fruits"> Fruits</label>
              <label><input type="checkbox" name="type" value="medicinal"> Medicinal Plants</label>
            </div>
          </div>

          <div class="form-group">
            <label for="garden-participants">Expected Participants</label>
            <input type="number" id="garden-participants" name="participants" placeholder="How many people will help?" min="1">
          </div>

          <div class="form-group">
            <label for="garden-goals">Goals & Purpose</label>
            <textarea id="garden-goals" name="goals" rows="3" placeholder="What do you hope to achieve?"></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="window.interactionPanel?.closeModal('start-garden-modal')">Cancel</button>
            <button type="submit" class="btn-primary">Start Garden</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</BaseLayout>

<script>
  // Interaction Panel Manager
  class InteractionPanelManager {
    constructor() {
      this.currentRole = 'mc';
      this.setupRoleSwitching();
      this.filterActivitiesByRole();
    }

    setupRoleSwitching() {
      document.querySelectorAll('.role-card').forEach(card => {
        card.addEventListener('click', () => {
          // Update active state
          document.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));
          card.classList.add('active');

          // Update current role
          this.currentRole = card.dataset.role;

          // Filter activities
          this.filterActivitiesByRole();

          // Award XP for exploring roles
          if (window.progressManager) {
            window.progressManager.awardXP(5, 'role_explore', `Explored ${this.currentRole} role`);
          }
        });
      });
    }

    filterActivitiesByRole() {
      const sections = document.querySelectorAll('.activity-section');

      sections.forEach(section => {
        const roles = section.dataset.roles?.split(',') || [];

        if (roles.includes('all') || roles.includes(this.currentRole)) {
          section.style.display = 'block';
        } else {
          section.style.display = 'none';
        }
      });
    }

    // Modal management
    openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }

    closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        // Reset form if exists
        const form = modal.querySelector('form');
        if (form) form.reset();
      }
    }

    // Action handlers
    createBattle() {
      this.openModal('create-battle-modal');
    }

    viewMyBattles() {
      window.location.href = '/music?filter=my-battles';
    }

    startCollab() {
      this.openModal('start-collab-modal');
    }

    viewMyCollabs() {
      window.location.href = '/music?filter=my-collabs';
    }

    createProject() {
      this.openModal('create-project-modal');
    }

    viewMyContributions() {
      window.location.href = '/learning#my-contributions';
    }

    startGarden() {
      this.openModal('start-garden-modal');
    }

    // Form submission handlers
    async submitBattle(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        // TODO: Replace with actual API call
        console.log('Creating battle:', data);

        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 500));

        // Show success message
        this.showToast('‚úÖ Battle created successfully!', 'success');
        this.closeModal('create-battle-modal');

        // Navigate to battle
        setTimeout(() => {
          window.location.href = '/music?tab=battles';
        }, 1000);

      } catch (error) {
        this.showToast('‚ùå Failed to create battle. Please try again.', 'error');
        console.error('Battle creation error:', error);
      }
    }

    async submitCollab(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);

      // Handle checkboxes
      const roles = formData.getAll('roles');
      const data = {
        ...Object.fromEntries(formData.entries()),
        roles: roles
      };

      try {
        console.log('Starting collaboration:', data);
        await new Promise(resolve => setTimeout(resolve, 500));

        this.showToast('‚úÖ Collaboration started successfully!', 'success');
        this.closeModal('start-collab-modal');

        setTimeout(() => {
          window.location.href = '/music?tab=collabs';
        }, 1000);

      } catch (error) {
        this.showToast('‚ùå Failed to start collaboration. Please try again.', 'error');
        console.error('Collab creation error:', error);
      }
    }

    async submitProject(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        console.log('Creating project:', data);
        await new Promise(resolve => setTimeout(resolve, 500));

        this.showToast('‚úÖ Project created successfully!', 'success');
        this.closeModal('create-project-modal');

        setTimeout(() => {
          window.location.href = '/learning?filter=my-projects';
        }, 1000);

      } catch (error) {
        this.showToast('‚ùå Failed to create project. Please try again.', 'error');
        console.error('Project creation error:', error);
      }
    }

    async submitGarden(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);

      // Handle checkboxes
      const types = formData.getAll('type');
      const data = {
        ...Object.fromEntries(formData.entries()),
        type: types
      };

      try {
        console.log('Starting garden:', data);
        await new Promise(resolve => setTimeout(resolve, 500));

        this.showToast('‚úÖ Garden started successfully!', 'success');
        this.closeModal('start-garden-modal');

        setTimeout(() => {
          window.location.href = '/kakuma?filter=gardens';
        }, 1000);

      } catch (error) {
        this.showToast('‚ùå Failed to start garden. Please try again.', 'error');
        console.error('Garden creation error:', error);
      }
    }

    // Toast notification
    showToast(message, type = 'info') {
      // Remove existing toasts
      document.querySelectorAll('.toast').forEach(t => t.remove());

      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('show');
      }, 10);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  }

  // Initialize
  window.interactionPanel = new InteractionPanelManager();

  // Load dynamic data
  async function loadDynamicData() {
    const wallet = window.walletManager?.connectedWallet;

    if (wallet) {
      // Load user's active battles
      // Load user's collaborations
      // Load user's projects
      // etc.
    }
  }

  // Load on ready
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(loadDynamicData, 500);
  });
</script>

<style>
  .role-grid {
    margin-bottom: 2rem;
  }

  .role-card {
    background: white;
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: all 0.3s;
    border: 3px solid transparent;
    text-align: center;
  }

  .role-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
  }

  .role-card.active {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
  }

  .role-icon {
    font-size: 3rem;
    margin-bottom: 0.5rem;
  }

  .role-name {
    font-size: 1.125rem;
    font-weight: bold;
    margin-bottom: 0.25rem;
  }

  .role-subtitle {
    font-size: 0.875rem;
    color: #666;
  }

  .activity-section {
    background: #f9fafb;
    padding: 2rem;
    border-radius: 1rem;
    margin-bottom: 2rem;
  }

  .activity-card {
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    overflow: hidden;
  }

  .activity-card.highlight {
    border: 2px solid #667eea;
  }

  .card-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .card-icon {
    font-size: 1.5rem;
  }

  .card-header h3 {
    font-size: 1.125rem;
    font-weight: bold;
    margin: 0;
  }

  .card-content {
    padding: 1.5rem;
  }

  .card-footer {
    padding: 1rem 1.5rem;
    background: #f9fafb;
    border-top: 1px solid #e5e7eb;
  }

  .list-items {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
  }

  .item-content {
    flex: 1;
  }

  .item-meta {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.25rem;
  }

  .item-tags, .collab-tags {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
    flex-wrap: wrap;
  }

  .tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: #e5e7eb;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .tag-active {
    background: #d1fae5;
    color: #065f46;
  }

  .tag-urgent {
    background: #fee2e2;
    color: #991b1b;
  }

  .chip {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 2rem;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .chip:hover {
    border-color: #667eea;
  }

  .chip.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
  }

  .empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: #9ca3af;
    font-style: italic;
  }

  .progress-mini {
    height: 6px;
    background: #e5e7eb;
    border-radius: 3px;
    overflow: hidden;
    margin: 0.5rem 0;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.3s;
  }

  .stats-mini {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    text-align: center;
  }

  .stat-mini {
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
  }

  .stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
  }

  .stat-label {
    font-size: 0.75rem;
    color: #666;
    margin-top: 0.25rem;
  }

  .btn-primary, .btn-secondary, .btn-small {
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }

  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .btn-secondary {
    background: #e5e7eb;
    color: #374151;
  }

  .btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: 1rem;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
    z-index: 10000;
  }

  @keyframes slideUp {
    from {
      transform: translateY(30px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .modal-header h3 {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0;
    color: #111827;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 2rem;
    color: #9ca3af;
    cursor: pointer;
    padding: 0;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.5rem;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: #f3f4f6;
    color: #374151;
  }

  .modal-body {
    padding: 1.5rem;
  }

  /* Form Styles */
  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #374151;
    font-size: 0.875rem;
  }

  .form-group input[type="text"],
  .form-group input[type="number"],
  .form-group input[type="datetime-local"],
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 0.5rem;
    font-size: 1rem;
    transition: all 0.2s;
    font-family: inherit;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 80px;
  }

  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.5rem 0;
  }

  .checkbox-group label {
    display: flex;
    align-items: center;
    font-weight: normal;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: background 0.2s;
  }

  .checkbox-group label:hover {
    background: #f9fafb;
  }

  .checkbox-group input[type="checkbox"] {
    width: auto;
    margin-right: 0.5rem;
    cursor: pointer;
  }

  .modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 2px solid #e5e7eb;
  }

  /* Toast Notifications */
  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    font-weight: 600;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    z-index: 10001;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.3s ease;
    max-width: 400px;
  }

  .toast.show {
    transform: translateX(0);
    opacity: 1;
  }

  .toast-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
  }

  .toast-error {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
  }

  .toast-info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .modal-content {
      width: 95%;
      max-height: 85vh;
    }

    .modal-header {
      padding: 1rem;
    }

    .modal-body {
      padding: 1rem;
    }

    .modal-actions {
      flex-direction: column-reverse;
    }

    .modal-actions button {
      width: 100%;
    }

    .toast {
      right: 1rem;
      left: 1rem;
      bottom: 1rem;
      max-width: calc(100% - 2rem);
    }

    .role-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .activity-cards {
      grid-template-columns: 1fr !important;
    }

    .stats-mini {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .role-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

