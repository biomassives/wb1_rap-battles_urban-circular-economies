---
/**
 * profile.astro
 * User Profile Settings & Customization
 *
 * Features:
 * - Edit profile information
 * - Manage NFT collection
 * - Customize preferences
 * - View mentor history
 * - Export data
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import OracleStatusBand from '../components/OracleStatusBand.astro';
---

<BaseLayout 
  title="Profile Settings" 
  description="Manage your account, preferences, and NFT collection"
  activeSection="profile"
>

  <div class="profile-container">
    <div class="container mx-auto">
      
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="profile-avatar-section">
          <div class="profile-avatar-large" id="profile-avatar">
            <div class="avatar-placeholder">
              <span id="avatar-initials">MU</span>
            </div>
            <button class="avatar-edit-btn" onclick="openAvatarUpload()">
              <span>üì∑</span>
            </button>
            <!-- 
            TODO: Avatar upload functionality
            - Click to upload image
            - Crop and resize
            - Save to storage (IPFS/S3)
            - Update profile
            -->
          </div>
          
          <div class="profile-header-info">
            <h1 class="profile-username" id="profile-username-display">Loading...</h1>
            <div class="profile-wallet-address" id="profile-wallet-display">
              <!-- Wallet address will be displayed here -->
            </div>
            <!-- Generative Level Badge with Animation -->
            <div class="profile-level-badge-container">
              <svg class="level-badge-bg" viewBox="0 0 300 120" xmlns="http://www.w3.org/2000/svg">
                <!-- Animated gradient background -->
                <defs>
                  <linearGradient id="levelGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" class="gradient-start">
                      <animate attributeName="stop-color" values="#667eea;#764ba2;#f093fb;#667eea" dur="8s" repeatCount="indefinite"/>
                    </stop>
                    <stop offset="100%" class="gradient-end">
                      <animate attributeName="stop-color" values="#764ba2;#f093fb;#667eea;#764ba2" dur="8s" repeatCount="indefinite"/>
                    </stop>
                  </linearGradient>

                  <!-- Glow filter -->
                  <filter id="glow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge>
                      <feMergeNode in="coloredBlur"/>
                      <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                  </filter>
                </defs>

                <!-- Animated egg shape with curves -->
                <ellipse cx="60" cy="60" rx="45" ry="55" fill="url(#levelGradient)" opacity="0.3" class="egg-outer">
                  <animate attributeName="rx" values="45;48;45" dur="4s" repeatCount="indefinite"/>
                  <animate attributeName="ry" values="55;52;55" dur="4s" repeatCount="indefinite"/>
                </ellipse>

                <ellipse cx="60" cy="60" rx="35" ry="45" fill="url(#levelGradient)" opacity="0.5" class="egg-middle">
                  <animate attributeName="rx" values="35;38;35" dur="3s" repeatCount="indefinite"/>
                  <animate attributeName="ry" values="45;42;45" dur="3s" repeatCount="indefinite"/>
                </ellipse>

                <ellipse cx="60" cy="60" rx="25" ry="35" fill="url(#levelGradient)" opacity="0.8" filter="url(#glow)" class="egg-inner">
                  <animate attributeName="rx" values="25;28;25" dur="2s" repeatCount="indefinite"/>
                  <animate attributeName="ry" values="35;32;35" dur="2s" repeatCount="indefinite"/>
                </ellipse>

                <!-- Animated curves/particles -->
                <path class="curve-1" d="M 30 30 Q 45 45 60 30" stroke="#ffffff" stroke-width="2" fill="none" opacity="0.4">
                  <animate attributeName="d"
                    values="M 30 30 Q 45 45 60 30;M 30 35 Q 45 40 60 35;M 30 30 Q 45 45 60 30"
                    dur="3s" repeatCount="indefinite"/>
                  <animate attributeName="opacity" values="0.4;0.7;0.4" dur="3s" repeatCount="indefinite"/>
                </path>

                <path class="curve-2" d="M 35 50 Q 50 60 65 50" stroke="#ffffff" stroke-width="2" fill="none" opacity="0.3">
                  <animate attributeName="d"
                    values="M 35 50 Q 50 60 65 50;M 35 55 Q 50 55 65 55;M 35 50 Q 50 60 65 50"
                    dur="4s" repeatCount="indefinite"/>
                  <animate attributeName="opacity" values="0.3;0.6;0.3" dur="4s" repeatCount="indefinite"/>
                </path>

                <!-- Sparkle particles -->
                <circle cx="40" cy="40" r="2" fill="#ffffff" opacity="0">
                  <animate attributeName="opacity" values="0;1;0" dur="2s" begin="0s" repeatCount="indefinite"/>
                </circle>
                <circle cx="80" cy="50" r="2" fill="#ffffff" opacity="0">
                  <animate attributeName="opacity" values="0;1;0" dur="2s" begin="0.7s" repeatCount="indefinite"/>
                </circle>
                <circle cx="50" cy="80" r="2" fill="#ffffff" opacity="0">
                  <animate attributeName="opacity" values="0;1;0" dur="2s" begin="1.4s" repeatCount="indefinite"/>
                </circle>
              </svg>

              <div class="level-badge-content">
                <div class="level-icon-animated">
                  <span class="star-icon">‚≠ê</span>
                  <div class="icon-glow"></div>
                </div>
                <div class="level-text">
                  <span class="level-number">Level <span id="profile-level">1</span></span>
                  <span class="life-stage" id="profile-life-stage">Egg Stage</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="profile-quick-stats">
          <div class="quick-stat">
            <div class="stat-value" id="profile-total-xp">0</div>
            <div class="stat-label">Total XP</div>
          </div>
          <div class="quick-stat">
            <div class="stat-value" id="profile-owned-nfts">0</div>
            <div class="stat-label">NFTs Owned</div>
          </div>
          <div class="quick-stat">
            <div class="stat-value" id="profile-member-since">Jan 2025</div>
            <div class="stat-label">Member Since</div>
          </div>
        </div>
      </div>

      <!-- E8 Oracle Status Band -->
      <OracleStatusBand />

      <!-- Profile Tabs -->
      <div class="profile-tabs">
        <button class="profile-tab active" data-tab="info">
          <span class="tab-icon">üë§</span>
          <span>Profile Info</span>
        </button>
        <button class="profile-tab" data-tab="stats">
          <span class="tab-icon">üìä</span>
          <span>Stats</span>
        </button>
        <button class="profile-tab" data-tab="preferences">
          <span class="tab-icon">‚öôÔ∏è</span>
          <span>Preferences</span>
        </button>
        <button class="profile-tab" data-tab="nfts">
          <span class="tab-icon">üñºÔ∏è</span>
          <span>My NFTs</span>
        </button>
        <button class="profile-tab" data-tab="mentor-history">
          <span class="tab-icon">üìú</span>
          <span>Mentor History</span>
        </button>
        <button class="profile-tab" data-tab="privacy">
          <span class="tab-icon">üîí</span>
          <span>Privacy & Data</span>
        </button>
      </div>

      <!-- ============================================ -->
      <!-- TAB 1: PROFILE INFO -->
      <!-- ============================================ -->
      <div id="tab-info" class="profile-tab-content active">
        
        <h2 class="tab-title">Profile Information</h2>
        <p class="tab-description">Update your public profile information</p>

        <form id="profile-info-form" class="profile-form">
          
          <!-- Username -->
          <div class="form-group">
            <label for="username" class="form-label">
              Username *
            </label>
            <input 
              type="text" 
              id="username" 
              name="username"
              class="form-input" 
              placeholder="Your username"
              maxlength="50"
              required
            />
            <span class="form-hint">
              This is your public display name. 3-50 characters.
            </span>
          </div>

          <!-- Email -->
          <div class="form-group">
            <label for="email" class="form-label">
              Email (Optional)
            </label>
            <input 
              type="email" 
              id="email" 
              name="email"
              class="form-input" 
              placeholder="your.email@example.com"
            />
            <span class="form-hint">
              Used for notifications and account recovery. Never shared publicly.
            </span>
          </div>

          <!-- Bio -->
          <div class="form-group">
            <label for="bio" class="form-label">
              Bio
            </label>
            <textarea 
              id="bio" 
              name="bio"
              class="form-textarea" 
              rows="4"
              placeholder="Tell the community about yourself..."
              maxlength="500"
            ></textarea>
            <div class="form-actions-row">
              <span class="form-hint" id="bio-counter">0 / 500 characters</span>
            </div>
          </div>

          <!-- Location (Optional) -->
          <div class="form-group">
            <label for="location" class="form-label">
              Location (Optional)
            </label>
            <input 
              type="text" 
              id="location" 
              name="location"
              class="form-input" 
              placeholder="e.g., Nairobi, Kenya"
            />
            <span class="form-hint">
              Share your location to connect with nearby users
            </span>
          </div>

          <!-- Favorite Animals (Multi-select) -->
          <div class="form-group">
            <label class="form-label">
              Favorite Farm Animals
            </label>
            <div class="checkbox-grid">
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="chicken" />
                <span>üêì Chicken</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="cat" />
                <span>üê± Cat</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="goat" />
                <span>üêê Goat</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="pigeon" />
                <span>üïäÔ∏è Pigeon</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="dog" />
                <span>üêï Dog</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="rabbit" />
                <span>üê∞ Rabbit</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="cow" />
                <span>üïäÔ∏è Pigeon</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="pitbull-pog" />
                <span>üêï Dog</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="favoriteAnimals" value="australian-shepherd-dog" />
                <span>üê∞ Rabbit</span>
              </label>
            </div>
          </div>

          <!-- Social Links -->
          <div class="form-group">
            <label class="form-label">Social Links (Optional)</label>
            
            <div class="social-inputs">
              <div class="social-input-group">
                <span class="social-icon">üê¶</span>
                <input 
                  type="text" 
                  name="twitter"
                  class="form-input" 
                  placeholder="Twitter username"
                />
              </div>
              
              <div class="social-input-group">
                <span class="social-icon">üí¨</span>
                <input 
                  type="text" 
                  name="discord"
                  class="form-input" 
                  placeholder="Discord username#1234"
                />
              </div>
              
              <div class="social-input-group">
                <span class="social-icon">üåê</span>
                <input 
                  type="url" 
                  name="website"
                  class="form-input" 
                  placeholder="https://yourwebsite.com"
                />
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="resetProfileForm()">
              Cancel
            </button>
            <button type="submit" class="btn-primary">
              Save Profile
            </button>
          </div>

        </form>

      </div>

      <!-- ============================================ -->
      <!-- TAB 2: STATS DASHBOARD -->
      <!-- ============================================ -->
      <div id="tab-stats" class="profile-tab-content" style="display: none;">

        <h2 class="tab-title">Your Stats Dashboard</h2>
        <p class="tab-description">Track your progress across music, battles, learning, and community impact</p>

        <div id="profile-stats-dashboard">

          <!-- Stats Grid -->
          <div class="stats-grid">

            <!-- Music Stats Section -->
            <div class="stats-section">
              <h3 class="section-title">üéµ Music Creation</h3>
              <div class="stat-cards-row">
                <div class="stat-card" id="music-tracks">
                  <!-- Populated by profile-stats.js -->
                </div>
                <div class="stat-card" id="music-time">
                  <!-- Populated by profile-stats.js -->
                </div>
              </div>
            </div>

            <!-- Battle Stats Section -->
            <div class="stats-section">
              <h3 class="section-title">‚öîÔ∏è Battle Record</h3>
              <div class="stat-cards-row">
                <div class="stat-card" id="battle-record">
                  <!-- Populated by profile-stats.js -->
                </div>
                <div class="stat-card" id="battle-streak">
                  <!-- Populated by profile-stats.js -->
                </div>
              </div>
            </div>

            <!-- Learning Stats Section -->
            <div class="stats-section">
              <h3 class="section-title">üìö Learning Progress</h3>
              <div class="stat-cards-row">
                <div class="stat-card" id="courses-completed">
                  <!-- Populated by profile-stats.js -->
                </div>
                <div class="stat-card" id="quiz-score">
                  <!-- Populated by profile-stats.js -->
                </div>
              </div>
            </div>

            <!-- NFT Collection Stats -->
            <div class="stats-section">
              <h3 class="section-title">üíé NFT Collection</h3>
              <div class="stat-cards-row">
                <div class="stat-card" id="nft-collection">
                  <!-- Populated by profile-stats.js -->
                </div>
              </div>
            </div>

            <!-- Community Impact -->
            <div class="stats-section">
              <h3 class="section-title">üèïÔ∏è Community Impact</h3>
              <div class="stat-cards-row">
                <div class="stat-card" id="community-impact">
                  <!-- Populated by profile-stats.js -->
                </div>
              </div>
            </div>

          </div>

          <!-- Charts Section -->
          <div class="charts-section">

            <!-- XP Over Time -->
            <div class="chart-container">
              <h3 class="chart-title">XP Progress Over Time</h3>
              <div class="chart-wrapper">
                <canvas id="xp-chart"></canvas>
              </div>
            </div>

            <!-- Battle Performance -->
            <div class="chart-container">
              <h3 class="chart-title">Battle Performance</h3>
              <div class="chart-wrapper">
                <canvas id="battle-chart"></canvas>
              </div>
            </div>

            <!-- Weekly Activity -->
            <div class="chart-container full-width">
              <h3 class="chart-title">Weekly Activity Breakdown</h3>
              <div class="chart-wrapper">
                <canvas id="weekly-activity-chart"></canvas>
              </div>
            </div>

            <!-- Activity Heatmap -->
            <div class="chart-container full-width">
              <h3 class="chart-title">Activity Heatmap (Last Year)</h3>
              <div id="activity-heatmap" class="heatmap-container">
                <!-- Populated by profile-stats.js -->
              </div>
            </div>

          </div>

        </div>

      </div>

<div class="network-escalation">
    <div class="brutalist-card action">
        <h3>MINT_DATA_ASSET</h3>
        <div class="button-stack">
            <button class="mint-btn sol" onclick="handleMintSolana()">MINT_TO_SOLANA_DEVNET</button>
            <button class="mint-btn dot" onclick="handleMintPolkadot()">MINT_TO_DOT_TESTNET</button>
        </div>
    </div>

    <div class="brutalist-card node">
        <h3>INFRASTRUCTURE_STATE</h3>
        <div class="node-status">
            <div class="status-indicator" id="node-indicator"></div>
            <span>E8_LATTICE_NODE: <strong id="node-state">INACTIVE</strong></span>
        </div>
        <p class="node-meta">ORACLE_VALIDATOR_V1 // RUST_WASM_ENGINE</p>
        <button class="brutalist-btn full-width" onclick="window.wbNode.toggleNode()">
            BOOT_VALIDATOR_NODE
        </button>
    </div>
</div>

<style>
    .network-escalation { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem; }
    .brutalist-card { border: 6px solid #000; padding: 1.5rem; background: #fff; box-shadow: 10px 10px 0 #000; }
    .brutalist-card.node { background: #000; color: #b4f55b; }
    .node-status { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .status-indicator { width: 12px; height: 12px; border-radius: 50%; background: #ff4757; }
    .status-indicator.active { background: #b4f55b; box-shadow: 0 0 10px #b4f55b; }
    .full-width { width: 100%; margin-top: 15px; background: #b4f55b; color: #000; border: 4px solid #fff; font-weight: 900; }
    .mint-btn { font-weight: 900; padding: 12px; border: 4px solid #000; cursor: pointer; box-shadow: 4px 4px 0 #000; }
    .mint-btn.sol { background: #9945FF; color: #fff; }
    .mint-btn.dot { background: #E6007A; color: #fff; }
</style>


      <!-- ============================================ -->
      <!-- TAB 2: PREFERENCES -->
      <!-- ============================================ -->
      <div id="tab-preferences" class="profile-tab-content" style="display: none;">
        
        <h2 class="tab-title">Preferences</h2>
        <p class="tab-description">Customize your platform experience</p>

        <form id="preferences-form" class="profile-form">
          
          <!-- Theme Preference -->
          <div class="form-group">
            <label class="form-label">Theme Preference</label>
            <div class="radio-group">
              <label class="form-radio">
                <input type="radio" name="themeMode" value="auto" checked />
                <span>
                  <strong>Auto (Time-based)</strong><br/>
                  Theme changes based on time of day
                </span>
              </label>
              <label class="form-radio">
                <input type="radio" name="themeMode" value="light" />
                <span>
                  <strong>Always Light</strong><br/>
                  Use light theme all day
                </span>
              </label>
              <label class="form-radio">
                <input type="radio" name="themeMode" value="dark" />
                <span>
                  <strong>Always Dark</strong><br/>
                  Use dark theme all day
                </span>
              </label>
            </div>
          </div>

          <!-- Notification Settings -->
          <div class="form-group">
            <label class="form-label">Notifications</label>
            
            <div class="notification-settings">
              <div class="notification-category">
                <h4>üéµ Music Activity</h4>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyNewComments" checked />
                  <span>Comments on my tracks</span>
                </label>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyBattleInvites" checked />
                  <span>Battle invitations</span>
                </label>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyCollabRequests" checked />
                  <span>Collaboration requests</span>
                </label>
              </div>

              <div class="notification-category">
                <h4>üèÜ Achievements & Progress</h4>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyAchievements" checked />
                  <span>Achievement unlocks</span>
                </label>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyLevelUp" checked />
                  <span>Level ups</span>
                </label>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyMilestones" checked />
                  <span>Milestones reached</span>
                </label>
              </div>

              <div class="notification-category">
                <h4>üåç Learning & Projects</h4>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyCourseUpdates" />
                  <span>New course releases</span>
                </label>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyProjectUpdates" />
                  <span>Project updates</span>
                </label>
              </div>

              <div class="notification-category">
                <h4>üèïÔ∏è Kakuma Updates</h4>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifyKakumaImpact" checked />
                  <span>Impact reports</span>
                </label>
                <label class="form-checkbox">
                  <input type="checkbox" name="notifySuccessStories" />
                  <span>Success stories</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Email Digest -->
          <div class="form-group">
            <label class="form-label">Email Digest</label>
            <select id="email-digest" name="emailDigest" class="form-select">
              <option value="never">Never send emails</option>
              <option value="daily">Daily summary</option>
              <option value="weekly" selected>Weekly summary</option>
              <option value="monthly">Monthly summary</option>
            </select>
          </div>

          <!-- Language Preference -->
          <div class="form-group">
            <label for="language" class="form-label">
              Language
            </label>
            <select id="language" name="language" class="form-select">
              <option value="en" selected>English</option>
              <option value="sw">Swahili</option>
              <option value="ar">Arabic</option>
              <option value="fr">French</option>
              <!-- TODO: Add more languages -->
            </select>
            <span class="form-hint">
              Some features may not be available in all languages yet
            </span>
          </div>

          <!-- Accessibility Options -->
          <div class="form-group">
            <label class="form-label">Accessibility</label>
            <label class="form-checkbox">
              <input type="checkbox" name="reduceMotion" />
              <span>Reduce motion and animations</span>
            </label>
            <label class="form-checkbox">
              <input type="checkbox" name="highContrast" />
              <span>High contrast mode</span>
            </label>
            <label class="form-checkbox">
              <input type="checkbox" name="largerText" />
              <span>Larger text size</span>
            </label>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="resetPreferencesForm()">
              Reset to Defaults
            </button>
            <button type="submit" class="btn-primary">
              Save Preferences
            </button>
          </div>

        </form>

      </div>

      <!-- ============================================ -->
      <!-- TAB 3: MY NFTs -->
      <!-- ============================================ -->
      <div id="tab-nfts" class="profile-tab-content" style="display: none;">
        
        <h2 class="tab-title">My NFT Collection</h2>
        <p class="tab-description">NFTs you own from the Hobby Farm collection</p>

        <div class="nft-collection-stats">
          <div class="collection-stat">
            <span class="stat-label">Total Owned:</span>
            <span class="stat-value" id="nfts-owned-count">0 / 55</span>
          </div>
          <div class="collection-stat">
            <span class="stat-label">Collection Progress:</span>
            <div class="progress-bar">
              <div class="progress-fill" id="collection-progress" style="width: 0%"></div>
            </div>
            <span class="stat-value" id="collection-percentage">0%</span>
          </div>
        </div>

        <!-- Owned NFTs Grid -->
        <div id="owned-nfts-grid" class="owned-nfts-grid">
          <!--
          TODO: Load user's owned NFTs from database
          Display NFT cards with:
          - NFT image/emoji
          - Name and rarity
          - When acquired
          - Special abilities unlocked
          - Option to set as profile picture
          
          If no NFTs owned, show message with link to collection
          -->
          <div class="empty-state">
            <div class="empty-icon">üñºÔ∏è</div>
            <h3>No NFTs Yet</h3>
            <p>You don't own any Hobby Farm NFTs yet.</p>
            <a href="/" class="btn-primary">Browse Collection</a>
          </div>
        </div>

      </div>

      <!-- ============================================ -->
      <!-- TAB 4: MENTOR HISTORY -->
      <!-- ============================================ -->
      <div id="tab-mentor-history" class="profile-tab-content" style="display: none;">
        
        <h2 class="tab-title">Mentor Journey</h2>
        <p class="tab-description">Your progression through different animal mentors</p>

        <!-- Current Mentor -->
        <div class="current-mentor-card">
          <div class="mentor-badge">Current Mentor</div>
          <div class="mentor-content">
            <div class="mentor-emoji" id="current-mentor-emoji">üêì</div>
            <div class="mentor-info">
              <h3 id="current-mentor-name">Chicken Mentor</h3>
              <p id="current-mentor-since">Mentoring since: Jan 1, 2025</p>
              <div class="mentor-stats">
                <div class="mentor-stat">
                  <span class="stat-label">Sessions:</span>
                  <span class="stat-value" id="mentor-sessions-count">0</span>
                </div>
                <div class="mentor-stat">
                  <span class="stat-label">Lessons Learned:</span>
                  <span class="stat-value" id="mentor-lessons-count">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mentor History Timeline -->
        <div class="mentor-timeline">
          <h3>Your Mentor History</h3>
          <div id="mentor-timeline-list" class="timeline-list">
            <!--
            TODO: Load mentor history from database
            Display timeline showing:
            - When each mentor was assigned
            - How long mentorship lasted
            - Key achievements during that time
            - Wisdom learned
            
            Timeline item template:
            <div class="timeline-item">
              <div class="timeline-date">Jan 1, 2025</div>
              <div class="timeline-icon">üêì</div>
              <div class="timeline-content">
                <h4>Started with Chicken Mentor</h4>
                <p>Began your journey learning foundations and community building</p>
                <div class="timeline-achievements">
                  <span class="achievement-mini">First Verse</span>
                  <span class="achievement-mini">Green Thumb</span>
                </div>
              </div>
            </div>
            -->
          </div>
        </div>

        <!-- Change Mentor (if eligible) -->
        <div class="change-mentor-section">
          <h3>Ready for a New Mentor?</h3>
          <p>You can choose Cat or Goat mentor at level 11</p>
          <button class="btn-primary" disabled>
            Unlock at Level 11
          </button>
          <!--
          TODO: Enable when user reaches level 11
          Show modal with Cat vs Goat choice
          Update user's current_animal_mentor in database
          Award XP for making choice
          -->
        </div>

      </div>

      <!-- ============================================ -->
      <!-- TAB 5: PRIVACY & DATA -->
      <!-- ============================================ -->
      <div id="tab-privacy" class="profile-tab-content" style="display: none;">
        
        <h2 class="tab-title">Privacy & Data</h2>
        <p class="tab-description">Manage your privacy settings and data</p>

        <!-- Privacy Settings -->
        <div class="privacy-section">
          <h3>Privacy Settings</h3>
          
          <div class="privacy-options">
            <div class="privacy-option">
              <div class="privacy-option-header">
                <h4>Profile Visibility</h4>
              </div>
              <select class="form-select" name="profileVisibility">
                <option value="public">Public - Anyone can view</option>
                <option value="community">Community - Only registered users</option>
                <option value="private">Private - Only me</option>
              </select>
            </div>

            <div class="privacy-option">
              <div class="privacy-option-header">
                <h4>Activity Visibility</h4>
              </div>
              <label class="form-checkbox">
                <input type="checkbox" name="showActivity" checked />
                <span>Show my recent activity on profile</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="showStats" checked />
                <span>Show my stats publicly</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="showNFTs" checked />
                <span>Show my NFT collection</span>
              </label>
            </div>

            <div class="privacy-option">
              <div class="privacy-option-header">
                <h4>Discoverability</h4>
              </div>
              <label class="form-checkbox">
                <input type="checkbox" name="allowSearch" checked />
                <span>Allow others to find me by username</span>
              </label>
              <label class="form-checkbox">
                <input type="checkbox" name="showOnLeaderboard" checked />
                <span>Show me on leaderboards</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Data Management -->
        <div class="data-section">
          <h3>Data Management</h3>
          
          <div class="data-actions">
            <div class="data-action-card">
              <div class="data-action-icon">üì•</div>
              <h4>Export Your Data</h4>
              <p>Download all your data in JSON format</p>
              <button class="btn-secondary" onclick="exportUserData()">
                Export Data
              </button>
              <!--
              TODO: Implement data export
              - Gather all user data from database
              - Generate JSON file
              - Include: profile, tracks, battles, observations, achievements
              - Trigger download
              -->
            </div>

            <div class="data-action-card">
              <div class="data-action-icon">üóëÔ∏è</div>
              <h4>Delete Account</h4>
              <p>Permanently delete your account and all data</p>
              <button class="btn-secondary danger" onclick="confirmDeleteAccount()">
                Delete Account
              </button>
              <!--
              TODO: Implement account deletion
              - Show confirmation modal with warnings
              - Require password/wallet signature
              - Delete all user data
              - Disconnect wallet
              - Redirect to homepage
              -->
            </div>
          </div>
        </div>

        <!-- Connected Apps -->
        <div class="connected-apps-section">
          <h3>Connected Apps & Permissions</h3>
          <p class="section-hint">Manage apps that have access to your account</p>
          
          <div id="connected-apps-list" class="connected-apps-list">
            <!-- List of connected apps will be shown here -->
            <div class="empty-state-small">
              No connected apps
            </div>
          </div>
        </div>

      </div>

    </div>

    <!-- ============================================ -->
    <!-- AVATAR UPLOAD MODAL -->
    <!-- ============================================ -->
    <div id="avatar-upload-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content avatar-upload-modal">

        <div class="modal-header">
          <h3>Update Profile Avatar</h3>
          <button class="btn-close" onclick="closeAvatarUpload()">√ó</button>
        </div>

        <div class="modal-body">

          <div class="avatar-upload-options">
            <button class="avatar-option-btn" onclick="document.getElementById('avatar-file-input').click()">
              <span class="option-icon">üì∑</span>
              <span class="option-text">Upload Image</span>
              <span class="option-hint">JPG, PNG, GIF (max 5MB)</span>
            </button>

            <button class="avatar-option-btn" onclick="openVectorAvatarBuilder()">
              <span class="option-icon">üé®</span>
              <span class="option-text">Create Avatar</span>
              <span class="option-hint">Vector avatar builder</span>
            </button>
          </div>

          <input
            type="file"
            id="avatar-file-input"
            accept="image/*"
            hidden
            onchange="handleAvatarSelection(event)"
          />

          <!-- Avatar Preview -->
          <div class="avatar-preview-container">
            <div id="avatar-preview-placeholder" class="avatar-preview-placeholder">
              <span class="preview-icon">üë§</span>
              <span class="preview-text">Select an image to preview</span>
            </div>
            <img id="avatar-preview-image" class="avatar-preview-image" style="display: none;" />
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn-secondary" onclick="closeAvatarUpload()">Cancel</button>
          <button id="save-avatar-btn" class="btn-primary" onclick="saveAvatar()" disabled>
            Save Avatar
          </button>
        </div>

      </div>
    </div>

  </div>

</BaseLayout>

<!-- Chart.js for visualizations -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" is:inline></script>

<!-- Profile Stats Manager -->
<script src="/scripts/profile-stats.js" is:inline></script>

<script>
  /**
   * Profile Page Manager
   */
  class ProfilePageManager {
    constructor() {
      this.userData = null;
    }

    async initialize() {
      const walletAddress = window.walletManager?.connectedWallet;
      const isAnonymous = window.walletManager?.isAnonymous;

      if (!walletAddress) {
        // This shouldn't happen since WalletManager creates anonymous wallet
        // But if it does, redirect to home
        window.location.href = '/';
        return;
      }

      // Show anonymous user notice if applicable
      if (isAnonymous) {
        this.showAnonymousNotice();
      }

      await this.loadUserProfile(walletAddress);
      this.populateForms();
      this.setupEventListeners();
    }

    showAnonymousNotice() {
      const notice = document.createElement('div');
      notice.className = 'anonymous-profile-notice';
      notice.innerHTML = `
        <div class="notice-content">
          <span class="notice-icon">üë§</span>
          <div class="notice-text">
            <strong>Anonymous Profile</strong>
            <p>Your progress is saved locally. Connect a wallet to sync across devices!</p>
          </div>
        </div>
      `;
      const container = document.querySelector('.profile-container');
      if (container) {
        container.insertBefore(notice, container.firstChild);
      }
    }

    async loadUserProfile(walletAddress) {
      try {
        const response = await fetch(
          `/api/profile/get?walletAddress=${walletAddress}`
        );
        const data = await response.json();
        
        if (data.success) {
          this.userData = data.profile;
          this.updateProfileDisplay();
        }
      } catch (error) {
        console.error('Failed to load profile:', error);
      }
    }

    updateProfileDisplay() {
      if (!this.userData) return;

      // Update header
      document.getElementById('profile-username-display').textContent =
        this.userData.username || 'Set your username';
      document.getElementById('profile-wallet-display').textContent =
        this.formatWalletAddress(this.userData.wallet_address);

      // Update avatar initials
      if (this.userData.username) {
        const initials = this.userData.username.substring(0, 2).toUpperCase();
        document.getElementById('avatar-initials').textContent = initials;
      }

      // Update level and life stage with generative art
      const level = this.userData.level || 1;
      const lifeStage = this.userData.life_stage || 'egg';

      document.getElementById('profile-level').textContent = level;
      document.getElementById('profile-life-stage').textContent =
        this.formatLifeStage(lifeStage);

      // Set data attribute for stage-specific styling
      const badgeContainer = document.querySelector('.profile-level-badge-container');
      if (badgeContainer) {
        badgeContainer.setAttribute('data-stage', lifeStage);
        badgeContainer.setAttribute('data-level', level);

        // Update gradient colors based on stage
        this.updateStageColors(lifeStage);
      }

      // TODO: Update other profile fields
    }

    formatLifeStage(stage) {
      const stageMap = {
        'egg': 'Egg Stage',
        'hatchling': 'Hatchling',
        'fledgling': 'Fledgling',
        'soaring': 'Soaring',
        'master': 'Master'
      };
      return stageMap[stage] || 'Egg Stage';
    }

    updateStageColors(stage) {
      // Define color schemes for each life stage
      const colorSchemes = {
        egg: ['#667eea', '#764ba2', '#f093fb'], // Purple/Pink
        hatchling: ['#4ade80', '#22c55e', '#10b981'], // Green
        fledgling: ['#fbbf24', '#f59e0b', '#f97316'], // Orange/Yellow
        soaring: ['#06b6d4', '#0891b2', '#0e7490'], // Cyan
        master: ['#dc2626', '#b91c1c', '#991b1b'] // Red
      };

      const colors = colorSchemes[stage] || colorSchemes.egg;

      // Update gradient dynamically
      const gradient = document.getElementById('levelGradient');
      if (gradient) {
        const stops = gradient.querySelectorAll('stop');
        if (stops[0]) {
          stops[0].setAttribute('stop-color', colors[0]);
          const anim0 = stops[0].querySelector('animate');
          if (anim0) {
            anim0.setAttribute('values', `${colors[0]};${colors[1]};${colors[2]};${colors[0]}`);
          }
        }
        if (stops[1]) {
          stops[1].setAttribute('stop-color', colors[1]);
          const anim1 = stops[1].querySelector('animate');
          if (anim1) {
            anim1.setAttribute('values', `${colors[1]};${colors[2]};${colors[0]};${colors[1]}`);
          }
        }
      }
    }

    populateForms() {
      if (!this.userData) return;

      // Populate profile info form
      document.getElementById('username').value = this.userData.username || '';
      document.getElementById('email').value = this.userData.email || '';
      document.getElementById('bio').value = this.userData.bio || '';
      
      // TODO: Populate other form fields
    }

    setupEventListeners() {
      // Profile info form
      document.getElementById('profile-info-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        await this.saveProfileInfo();
      });

      // Preferences form
      document.getElementById('preferences-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        await this.savePreferences();
      });

      // Bio character counter
      document.getElementById('bio').addEventListener('input', (e) => {
        document.getElementById('bio-counter').textContent = 
          `${e.target.value.length} / 500 characters`;
      });

      // Tab switching
      document.querySelectorAll('.profile-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;
          this.switchTab(tabName);
        });
      });
    }

    async saveProfileInfo() {
      const walletAddress = window.walletManager?.connectedWallet;

      // Don't save if no wallet connected
      if (!walletAddress) {
        this.showError('Please connect your wallet first');
        return;
      }

      const formData = {
        walletAddress,
        username: document.getElementById('username')?.value || null,
        email: document.getElementById('email')?.value || null,
        bio: document.getElementById('bio')?.value || null,
        location: document.getElementById('location')?.value || null,
      };

      try {
        const response = await fetch('/api/profile/upsert', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
          this.showSuccess('Profile updated successfully!');
          await window.progressManager?.awardXP(25, 'profile_updated', 'Updated profile information');
        } else {
          this.showError(data.message || 'Failed to save profile');
        }
      } catch (error) {
        console.error('Failed to save profile:', error);
        this.showError('Failed to save profile. Please try again.');
      }
    }

    async savePreferences() {
      // TODO: Implement preferences saving
      console.log('Save preferences');
    }

    switchTab(tabName) {
      // Update active tab
      document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      
      // Show corresponding content
      document.querySelectorAll('.profile-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      document.getElementById(`tab-${tabName}`).style.display = 'block';
    }

    formatWalletAddress(address) {
      if (!address) return '';
      return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
    }

    showSuccess(message) {
      // TODO: Show success toast
      alert(message);
    }

    showError(message) {
      // TODO: Show error toast
      alert(message);
    }
  }

  window.profilePageManager = new ProfilePageManager();

  /**
   * E8 Oracle Manager - Connects OracleStatusBand to E8 Lattice system
   */
  class OracleManager {
    constructor() {
      this.initialized = false;
    }

    async initialize() {
      const walletAddress = window.walletManager?.connectedWallet;
      if (!walletAddress) return;

      try {
        // Initialize E8 secure storage if available
        if (window.secureStorage) {
          await window.secureStorage.initialize(walletAddress);
          this.initialized = true;

          // Update oracle UI with actual keys
          this.updateOracleUI();

          console.log('‚úÖ Oracle Manager initialized');
        } else {
          console.log('‚ö†Ô∏è E8 Oracle not loaded yet - will retry');
          // Retry after E8 script loads
          setTimeout(() => this.initialize(), 1000);
        }
      } catch (error) {
        console.error('Failed to initialize Oracle:', error);
      }
    }

    updateOracleUI() {
      if (!window.secureStorage || !this.initialized) return;

      // Update public key display
      const publicKeyElement = document.getElementById('oracle-public-key');
      if (publicKeyElement && window.secureStorage.keyPair) {
        const pubKey = window.secureStorage.keyPair.publicKey.toString();
        publicKeyElement.textContent = pubKey;
      }

      // Update consent token ID
      const tokenIdElement = document.getElementById('oracle-token-id');
      if (tokenIdElement && window.secureStorage.consentToken) {
        const tokenId = window.secureStorage.consentToken.tokenId;
        tokenIdElement.textContent = `${tokenId.substring(0, 8)}...${tokenId.substring(tokenId.length - 8)}`;
      }

      // Wire up permission toggles
      this.setupPermissionToggles();
    }

    setupPermissionToggles() {
      const toggles = document.querySelectorAll('.permission-toggle input[type="checkbox"]');
      toggles.forEach(toggle => {
        const permission = toggle.dataset.permission;

        // Set initial state from consent token
        if (window.secureStorage.consentToken) {
          toggle.checked = window.secureStorage.consentToken.hasPermission(permission);
        }

        // Listen for changes
        toggle.addEventListener('change', async (e) => {
          await this.updatePermission(permission, e.target.checked);
        });
      });
    }

    async updatePermission(permission, granted) {
      if (!window.secureStorage?.consentToken) return;

      try {
        if (granted) {
          window.secureStorage.consentToken.grantPermission(permission);
        } else {
          window.secureStorage.consentToken.revokePermission(permission);
        }

        // Save to localStorage
        const walletAddress = window.walletManager?.connectedWallet;
        if (walletAddress) {
          localStorage.setItem(
            `consent_${walletAddress}`,
            JSON.stringify(window.secureStorage.consentToken)
          );
        }

        // Send to API
        await fetch('/api/oracle/consent', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            walletAddress,
            action: granted ? 'GRANT_PERMISSION' : 'REVOKE_PERMISSION',
            permission
          })
        });

        console.log(`${granted ? '‚úÖ Granted' : '‚ùå Revoked'} permission: ${permission}`);
      } catch (error) {
        console.error('Failed to update permission:', error);
      }
    }
  }

  window.oracleManager = new OracleManager();

  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      window.profilePageManager.initialize();
      window.oracleManager.initialize();
    }, 500);
  });

  // Avatar upload handling
  let selectedAvatarFile = null;

  function openAvatarUpload() {
    document.getElementById('avatar-upload-modal').style.display = 'flex';
  }

  function closeAvatarUpload() {
    document.getElementById('avatar-upload-modal').style.display = 'none';
    clearAvatarPreview();
  }

  function handleAvatarSelection(event) {
    const file = event.target.files[0];
    if (!file) return;

    // Validate file type
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }

    // Validate file size (max 5MB)
    if (file.size > 5 * 1024 * 1024) {
      alert('File size must be less than 5MB');
      return;
    }

    selectedAvatarFile = file;
    previewAvatar(file);
  }

  function previewAvatar(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const previewImg = document.getElementById('avatar-preview-image');
      previewImg.src = e.target.result;
      previewImg.style.display = 'block';
      document.getElementById('avatar-preview-placeholder').style.display = 'none';
      document.getElementById('save-avatar-btn').disabled = false;
    };
    reader.readAsDataURL(file);
  }

  function clearAvatarPreview() {
    selectedAvatarFile = null;
    document.getElementById('avatar-file-input').value = '';
    document.getElementById('avatar-preview-image').style.display = 'none';
    document.getElementById('avatar-preview-placeholder').style.display = 'flex';
    document.getElementById('save-avatar-btn').disabled = true;
  }

  async function saveAvatar() {
    if (!selectedAvatarFile) return;

    const walletAddress = window.walletManager?.connectedWallet;
    if (!walletAddress) return;

    // In a real implementation, you would:
    // 1. Upload to IPFS or cloud storage
    // 2. Get the URL
    // 3. Save to user profile

    try {
      // Simulate upload for now
      const reader = new FileReader();
      reader.onload = async (e) => {
        const avatarDataUrl = e.target.result;

        // Update profile avatar display
        const avatarPlaceholder = document.querySelector('.avatar-placeholder');
        avatarPlaceholder.style.backgroundImage = `url(${avatarDataUrl})`;
        avatarPlaceholder.style.backgroundSize = 'cover';
        avatarPlaceholder.style.backgroundPosition = 'center';
        avatarPlaceholder.innerHTML = '';

        // Award XP
        await window.progressManager?.awardXP(50, 'avatar_uploaded', 'Uploaded profile avatar');

        closeAvatarUpload();
        alert('Avatar updated successfully!');
      };
      reader.readAsDataURL(selectedAvatarFile);

    } catch (error) {
      console.error('Failed to save avatar:', error);
      alert('Failed to save avatar. Please try again.');
    }
  }

  function openVectorAvatarBuilder() {
    window.location.href = '/avatar-builder';
  }

  function resetProfileForm() {
    window.profilePageManager.populateForms();
  }

  function resetPreferencesForm() {
    document.getElementById('preferences-form').reset();
  }

  function exportUserData() {
    // TODO: Implement data export
    console.log('Export user data');
  }

  function confirmDeleteAccount() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
      // TODO: Implement account deletion
      console.log('Delete account');
    }
  }

  // Minting handlers (global)
  window.handleMintSolana = function() {
    if (!window.walletManager?.connectedWallet) {
      alert('‚ö†Ô∏è Please connect your wallet first');
      return;
    }

    // TODO: Implement Solana minting
    console.log('üöÄ Minting to Solana Devnet...');
    alert('üöÄ Solana minting coming soon!\n\nThis will mint your profile data as an NFT on Solana Devnet.');
  }

  window.handleMintPolkadot = function() {
    if (!window.walletManager?.connectedWallet) {
      alert('‚ö†Ô∏è Please connect your wallet first');
      return;
    }

    // TODO: Implement Polkadot minting
    console.log('üöÄ Minting to Polkadot Testnet...');
    alert('üöÄ Polkadot minting coming soon!\n\nThis will mint your profile data as an NFT on Polkadot Testnet.');
  }
</script>

<style>
  .profile-container {
    padding: 2rem 0;
  }

  .profile-header {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .profile-avatar-section {
    display: flex;
    gap: 2rem;
    align-items: center;
  }

  .profile-avatar-large {
    position: relative;
    width: 120px;
    height: 120px;
  }

  .avatar-placeholder {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 700;
  }

  .avatar-edit-btn {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: white;
    border: 2px solid var(--color-gray-300);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
  }

  .profile-tabs {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid var(--color-gray-200);
    margin-bottom: 2rem;
    overflow-x: auto;
  }

  .profile-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.5rem;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    transition: all var(--transition-base);
    white-space: nowrap;
  }

  .profile-tab.active {
    border-bottom-color: var(--color-primary);
    color: var(--color-primary);
  }

  .profile-form {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: var(--shadow-md);
  }

  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }

  .social-inputs {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .social-input-group {
    display: grid;
    grid-template-columns: 3rem 1fr;
    gap: 0.5rem;
    align-items: center;
  }

  .social-icon {
    font-size: 1.5rem;
    text-align: center;
  }

  .notification-category {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: var(--color-gray-50);
    border-radius: var(--radius-md);
  }

  .notification-category h4 {
    margin-bottom: 1rem;
    color: var(--color-gray-800);
  }

  .privacy-options,
  .data-actions {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .data-action-card {
    padding: 2rem;
    background: var(--color-gray-50);
    border-radius: var(--radius-md);
    text-align: center;
  }

  .data-action-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .btn-secondary.danger {
    border-color: var(--color-error);
    color: var(--color-error);
  }

  .btn-secondary.danger:hover {
    background: var(--color-error);
    color: white;
  }

  /* Avatar Upload Modal Styles */
  .avatar-upload-modal {
    max-width: 500px;
  }

  .avatar-upload-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .avatar-option-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1.5rem;
    background: var(--color-gray-50);
    border: 2px solid var(--color-gray-200);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-base);
  }

  .avatar-option-btn:hover {
    border-color: var(--color-primary);
    background: var(--color-primary-light);
    transform: translateY(-2px);
  }

  .option-icon {
    font-size: 2rem;
  }

  .option-text {
    font-weight: 600;
    color: var(--color-gray-900);
  }

  .option-hint {
    font-size: 0.75rem;
    color: var(--color-gray-600);
  }

  .avatar-preview-container {
    width: 100%;
    aspect-ratio: 1;
    max-width: 300px;
    margin: 0 auto;
    position: relative;
    border: 2px dashed var(--color-gray-300);
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  .avatar-preview-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    background: var(--color-gray-50);
  }

  .preview-icon {
    font-size: 4rem;
    opacity: 0.3;
  }

  .preview-text {
    font-size: 0.875rem;
    color: var(--color-gray-500);
  }

  .avatar-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Generative Level Badge Styles */
  .profile-level-badge-container {
    position: relative;
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border-radius: 1rem;
    border: 2px solid rgba(102, 126, 234, 0.2);
    overflow: hidden;
  }

  .level-badge-bg {
    position: absolute;
    left: -10px;
    top: 50%;
    transform: translateY(-50%);
    width: 120px;
    height: 120px;
    pointer-events: none;
    z-index: 0;
  }

  .level-badge-content {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding-left: 100px;
  }

  .level-icon-animated {
    position: relative;
    font-size: 2rem;
    animation: starPulse 2s ease-in-out infinite;
  }

  @keyframes starPulse {
    0%, 100% {
      transform: scale(1) rotate(0deg);
    }
    50% {
      transform: scale(1.1) rotate(5deg);
    }
  }

  .star-icon {
    position: relative;
    z-index: 2;
    display: inline-block;
    filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
  }

  .icon-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.4), transparent);
    border-radius: 50%;
    animation: glowPulse 2s ease-in-out infinite;
    z-index: 1;
  }

  @keyframes glowPulse {
    0%, 100% {
      opacity: 0.5;
      transform: translate(-50%, -50%) scale(1);
    }
    50% {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.3);
    }
  }

  .level-text {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .level-number {
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--color-gray-900);
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .life-stage {
    font-size: 0.875rem;
    color: var(--color-gray-600);
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    animation: stageShimmer 3s ease-in-out infinite;
  }

  @keyframes stageShimmer {
    0%, 100% {
      opacity: 0.7;
    }
    50% {
      opacity: 1;
    }
  }

  /* Stage-specific animations */

  /* Egg Stage - Gentle pulsing */
  .profile-level-badge-container[data-stage="egg"] .level-badge-bg {
    animation: eggGrow 4s ease-in-out infinite;
  }

  @keyframes eggGrow {
    0%, 100% {
      transform: translateY(-50%) scale(1);
    }
    50% {
      transform: translateY(-50%) scale(1.05);
    }
  }

  /* Hatchling Stage - Cracking animation */
  .profile-level-badge-container[data-stage="hatchling"] .level-badge-bg {
    animation: hatchlingShake 3s ease-in-out infinite;
  }

  @keyframes hatchlingShake {
    0%, 100% {
      transform: translateY(-50%) rotate(0deg) scale(1);
    }
    25% {
      transform: translateY(-50%) rotate(-2deg) scale(1.02);
    }
    50% {
      transform: translateY(-50%) rotate(2deg) scale(1.04);
    }
    75% {
      transform: translateY(-50%) rotate(-1deg) scale(1.02);
    }
  }

  /* Fledgling Stage - Flutter animation */
  .profile-level-badge-container[data-stage="fledgling"] .level-badge-bg {
    animation: fledglingFlutter 2s ease-in-out infinite;
  }

  @keyframes fledglingFlutter {
    0%, 100% {
      transform: translateY(-50%) translateX(0) scale(1);
    }
    25% {
      transform: translateY(-48%) translateX(-2px) scale(1.03);
    }
    50% {
      transform: translateY(-52%) translateX(0) scale(1.06);
    }
    75% {
      transform: translateY(-48%) translateX(2px) scale(1.03);
    }
  }

  /* Soaring Stage - Gliding animation */
  .profile-level-badge-container[data-stage="soaring"] .level-badge-bg {
    animation: soaringGlide 5s ease-in-out infinite;
  }

  @keyframes soaringGlide {
    0%, 100% {
      transform: translateY(-50%) translateX(0) scale(1);
    }
    50% {
      transform: translateY(-45%) translateX(5px) scale(1.08);
    }
  }

  /* Master Stage - Powerful pulse */
  .profile-level-badge-container[data-stage="master"] .level-badge-bg {
    animation: masterPulse 3s ease-in-out infinite;
  }

  @keyframes masterPulse {
    0%, 100% {
      transform: translateY(-50%) scale(1);
      filter: brightness(1);
    }
    50% {
      transform: translateY(-50%) scale(1.1);
      filter: brightness(1.2);
    }
  }

  /* Stage-specific border colors */
  .profile-level-badge-container[data-stage="egg"] {
    border-color: rgba(102, 126, 234, 0.3);
  }

  .profile-level-badge-container[data-stage="hatchling"] {
    border-color: rgba(74, 222, 128, 0.3);
  }

  .profile-level-badge-container[data-stage="fledgling"] {
    border-color: rgba(251, 191, 36, 0.3);
  }

  .profile-level-badge-container[data-stage="soaring"] {
    border-color: rgba(6, 182, 212, 0.3);
  }

  .profile-level-badge-container[data-stage="master"] {
    border-color: rgba(220, 38, 38, 0.3);
    box-shadow: 0 0 20px rgba(220, 38, 38, 0.2);
  }

  /* ============================================ */
  /* STATS DASHBOARD STYLES */
  /* ============================================ */

  .stats-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .stats-section {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: var(--shadow-md);
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--color-gray-900);
  }

  .stat-cards-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .stat-card {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
    border: 2px solid rgba(102, 126, 234, 0.1);
    border-radius: 0.75rem;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(102, 126, 234, 0.15);
  }

  .stat-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .stat-main {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-primary);
    line-height: 1;
  }

  .stat-label {
    font-size: 0.875rem;
    color: var(--color-gray-600);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-trend {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.875rem;
    font-weight: 600;
    margin-top: 0.5rem;
  }

  .stat-trend.positive {
    color: #10b981;
  }

  .stat-trend.negative {
    color: #ef4444;
  }

  .stat-trend.neutral {
    color: var(--color-gray-500);
  }

  .trend-arrow {
    font-size: 1rem;
  }

  .stat-subtext {
    font-size: 0.875rem;
    color: var(--color-gray-600);
    margin-top: 0.5rem;
  }

  /* Charts Section */
  .charts-section {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
  }

  .chart-container {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: var(--shadow-md);
  }

  .chart-container.full-width {
    grid-column: 1 / -1;
  }

  .chart-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--color-gray-900);
  }

  .chart-wrapper {
    position: relative;
    height: 300px;
  }

  .chart-container.full-width .chart-wrapper {
    height: 400px;
  }

  /* Heatmap Styles */
  .heatmap-container {
    padding: 1rem 0;
    overflow-x: auto;
  }

  .heatmap-grid {
    display: flex;
    gap: 3px;
    padding: 1rem 0;
  }

  .heatmap-week {
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .heatmap-day {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    background: var(--color-gray-100);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .heatmap-day:hover {
    transform: scale(1.2);
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
  }

  .heatmap-day.level-0 {
    background: var(--color-gray-100);
  }

  .heatmap-day.level-1 {
    background: rgba(102, 126, 234, 0.2);
  }

  .heatmap-day.level-2 {
    background: rgba(102, 126, 234, 0.4);
  }

  .heatmap-day.level-3 {
    background: rgba(102, 126, 234, 0.6);
  }

  .heatmap-day.level-4 {
    background: rgba(102, 126, 234, 0.9);
  }

  .heatmap-legend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    font-size: 0.75rem;
    color: var(--color-gray-600);
  }

  .legend-square {
    width: 12px;
    height: 12px;
    border-radius: 2px;
  }

  @media (max-width: 1024px) {
    .charts-section {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .profile-header {
      flex-direction: column;
      gap: 2rem;
    }

    .checkbox-grid {
      grid-template-columns: 1fr;
    }

    .avatar-upload-options {
      grid-template-columns: 1fr;
    }

    /* Mobile responsive level badge */
    .profile-level-badge-container {
      padding: 0.5rem 1rem;
    }

    .level-badge-bg {
      width: 90px;
      height: 90px;
      left: -5px;
    }

    .level-badge-content {
      padding-left: 75px;
      gap: 0.5rem;
    }

    .level-icon-animated {
      font-size: 1.5rem;
    }

    .level-number {
      font-size: 1rem;
    }

    .life-stage {
      font-size: 0.75rem;
    }

    .stat-cards-row {
      grid-template-columns: 1fr;
    }
  }
</style>
