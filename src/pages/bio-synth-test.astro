---
/**
 * bio-synth-test.astro
 * Test page for Bio Synth WAV Generator
 *
 * Navigate to /bio-synth-test to generate sample files
 */
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bio Synth Generator Test | Worldbridger One</title>
  <style>
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --success: #10b981;
      --healing: #00d4aa;
      --reggae: #ffd700;
      --schumann: #4ecdc4;
      --bg: #0f0f0f;
      --card: #1a1a1a;
      --card-hover: #252525;
      --text: #e0e0e0;
      --text-dim: #888;
      --border: #333;
      --border-bright: #555;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 2rem;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 40px rgba(102, 126, 234, 0.3);
    }

    h2 {
      margin-bottom: 1rem;
      color: white;
      font-size: 1.75rem;
      position: relative;
      padding-left: 1rem;
    }

    h2::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 60%;
      background: linear-gradient(180deg, var(--primary), var(--secondary));
      border-radius: 2px;
    }

    h2.healing::before {
      background: linear-gradient(180deg, var(--healing), var(--schumann));
    }

    h2.reggae::before {
      background: linear-gradient(180deg, var(--reggae), #ff8c00);
    }

    .subtitle {
      font-size: 1.125rem;
      color: var(--text-dim);
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .section-description {
      font-size: 0.95rem;
      color: var(--text-dim);
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(102, 126, 234, 0.05);
      border-left: 3px solid var(--primary);
      border-radius: 4px;
    }

    .section-description.healing {
      background: rgba(0, 212, 170, 0.05);
      border-left-color: var(--healing);
    }

    .section-description.reggae {
      background: rgba(255, 215, 0, 0.05);
      border-left-color: var(--reggae);
    }

    .controls {
      background: var(--card);
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      border: 1px solid #333;
    }

    .btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      margin-right: 1rem;
      margin-bottom: 1rem;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: #2a2a2a;
      border: 1px solid #444;
    }

    .btn-secondary:hover {
      background: #333;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .samples-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .sample-card {
      background: linear-gradient(135deg, var(--card) 0%, #1f1f1f 100%);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .sample-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .sample-card:hover {
      border-color: var(--border-bright);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
      background: linear-gradient(135deg, var(--card-hover) 0%, #2a2a2a 100%);
    }

    .sample-card:hover::before {
      opacity: 1;
    }

    .sample-card.generated {
      border-color: var(--success);
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
    }

    .sample-card.generated::before {
      background: linear-gradient(90deg, transparent, var(--success), transparent);
      opacity: 1;
    }

    .sample-card.healing {
      border-color: var(--healing);
    }

    .sample-card.healing::before {
      background: linear-gradient(90deg, transparent, var(--healing), transparent);
    }

    .sample-card.reggae {
      border-color: var(--reggae);
    }

    .sample-card.reggae::before {
      background: linear-gradient(90deg, transparent, var(--reggae), transparent);
    }

    .sample-name {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: white;
    }

    .sample-info {
      font-size: 0.875rem;
      color: #888;
      margin-bottom: 1rem;
    }

    .sample-actions {
      display: flex;
      gap: 0.5rem;
    }

    .sample-btn {
      flex: 1;
      padding: 0.5rem 1rem;
      background: #2a2a2a;
      border: 1px solid #444;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .sample-btn:hover:not(:disabled) {
      background: #333;
      border-color: var(--primary);
    }

    .sample-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .status {
      background: var(--card);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid #333;
      margin-bottom: 2rem;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #333;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-label {
      color: #888;
    }

    .status-value {
      color: white;
      font-weight: 600;
    }

    .log {
      background: #000;
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid #333;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      max-height: 400px;
      overflow-y: auto;
      color: #0f0;
    }

    .log-entry {
      margin-bottom: 0.5rem;
    }

    .log-success {
      color: #10b981;
    }

    .log-error {
      color: #ef4444;
    }

    .log-info {
      color: #3b82f6;
    }

    .waveform {
      width: 100%;
      height: 60px;
      background: #0a0a0a;
      border-radius: 6px;
      margin: 0.5rem 0;
      position: relative;
      overflow: hidden;
    }

    .waveform canvas {
      width: 100%;
      height: 100%;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .generating {
      animation: pulse 1s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß¨ Bio Synth WAV Generator</h1>
    <p class="subtitle">
      Generate synthesized audio samples using bio-inspired mathematical algorithms
    </p>

    <div class="controls">
      <button class="btn" id="generate-all">
        Generate All Samples
      </button>
      <button class="btn btn-secondary" id="download-all" disabled>
        Download All WAV Files
      </button>
      <button class="btn btn-secondary" id="clear-log">
        Clear Log
      </button>
    </div>

    <div class="status">
      <div class="status-item">
        <span class="status-label">Generated:</span>
        <span class="status-value" id="generated-count">0 / 29</span>
      </div>
      <div class="status-item">
        <span class="status-label">Total Size:</span>
        <span class="status-value" id="total-size">0 KB</span>
      </div>
      <div class="status-item">
        <span class="status-label">Sample Rate:</span>
        <span class="status-value">44.1 kHz</span>
      </div>
      <div class="status-item">
        <span class="status-label">Bit Depth:</span>
        <span class="status-value">16-bit PCM</span>
      </div>
      <div class="status-item">
        <span class="status-label">Categories:</span>
        <span class="status-value">ü•Å Beats ‚Ä¢ üßò Healing ‚Ä¢ üé∂ Reggae</span>
      </div>
    </div>

    <h2>üéµ Beat Making Samples</h2>
    <p class="section-description">
      Bio-inspired drum and instrument samples for beat production
    </p>
    <div class="samples-grid" id="samples-grid">
      <!-- Sample cards will be added here by JavaScript -->
    </div>

    <h2 class="healing">üßò Healing & Meditation Frequencies</h2>
    <p class="section-description healing">
      <strong>Solfeggio frequencies</strong> are ancient sacred tones used for spiritual healing and DNA repair.
      <strong>Schumann resonances</strong> are Earth's natural electromagnetic frequencies, promoting deep relaxation and connection to nature.
    </p>
    <div class="samples-grid" id="healing-grid">
      <!-- Healing frequency cards will be added here by JavaScript -->
    </div>

    <h2 class="reggae">üé∂ Reggae & Dub Bass Presets</h2>
    <p class="section-description reggae">
      Deep sub-bass tones with authentic dub echo effects for reggae and dancehall production
    </p>
    <div class="samples-grid" id="reggae-grid">
      <!-- Reggae bass cards will be added here by JavaScript -->
    </div>

    <h2>Console Log</h2>
    <div class="log" id="console-log">
      <div class="log-entry log-info">üß¨ Bio Synth Generator ready. Click "Generate All Samples" to start.</div>
    </div>
  </div>

  <script is:inline src="/scripts/bio-synth-generator.js"></script>
  <script is:inline>
    const sampleDefinitions = [
      { id: 'kick', name: 'Kick Drum', description: 'Bio-inspired frequency sweep', icon: 'ü•Å' },
      { id: 'snare', name: 'Snare Drum', description: 'Fractal noise synthesis', icon: 'ü•Å' },
      { id: 'hihat', name: 'Hi-Hat', description: 'Fibonacci-filtered shimmer', icon: 'ü•Å' },
      { id: 'bass-e', name: 'Bass E1', description: 'Harmonic series bass', icon: 'üé∏' },
      { id: 'bass-g', name: 'Bass G1', description: 'Harmonic series bass', icon: 'üé∏' },
      { id: 'bass-a', name: 'Bass A1', description: 'Harmonic series bass', icon: 'üé∏' },
      { id: 'clap', name: 'Clap', description: 'Chaos theory multi-hit', icon: 'üëè' },
      { id: 'horn', name: 'Reggaeton Horn', description: 'Harmonic stacking', icon: 'üìØ' },
      { id: 'hihat-open', name: 'Hi-Hat Open', description: 'Extended decay', icon: 'ü•Å' },
      { id: 'shout', name: 'Shout', description: 'Formant synthesis', icon: 'üì£' },
      { id: 'water', name: 'Water Drop', description: 'Damped oscillation', icon: 'üíß' },
      { id: 'electric', name: 'Electric Zap', description: 'FM synthesis', icon: '‚ö°' },
    ];

    const healingDefinitions = [
      { id: 'schumann-7.83', name: 'Schumann 7.83Hz', description: 'Earth resonance - Deep calm', icon: 'üåç', freq: 7.83, type: 'schumann' },
      { id: 'solfeggio-174', name: '174Hz - Pain Relief', description: 'Foundation & grounding', icon: 'üí´', freq: 174, type: 'solfeggio' },
      { id: 'solfeggio-285', name: '285Hz - Energy', description: 'Tissue regeneration', icon: '‚ö°', freq: 285, type: 'solfeggio' },
      { id: 'solfeggio-396', name: '396Hz - Liberation', description: 'Release fear & guilt', icon: 'ü¶ã', freq: 396, type: 'solfeggio' },
      { id: 'solfeggio-417', name: '417Hz - Change', description: 'Facilitate transformation', icon: 'üåÄ', freq: 417, type: 'solfeggio' },
      { id: 'solfeggio-528', name: '528Hz - Love', description: 'DNA repair & miracles', icon: 'üíö', freq: 528, type: 'solfeggio' },
      { id: 'solfeggio-639', name: '639Hz - Connection', description: 'Relationships & harmony', icon: 'ü§ù', freq: 639, type: 'solfeggio' },
      { id: 'solfeggio-741', name: '741Hz - Awakening', description: 'Expression & solutions', icon: 'üß†', freq: 741, type: 'solfeggio' },
      { id: 'solfeggio-852', name: '852Hz - Intuition', description: 'Spiritual order', icon: 'üëÅÔ∏è', freq: 852, type: 'solfeggio' },
      { id: 'solfeggio-963', name: '963Hz - Divine', description: 'Pineal activation', icon: '‚ú®', freq: 963, type: 'solfeggio' },
      { id: 'meditation-528-7.83', name: 'Meditation Blend', description: 'Solfeggio + Schumann', icon: 'üßò', freq: 528, type: 'meditation' },
    ];

    const reggaeDefinitions = [
      { id: 'reggae-e', name: 'Reggae Bass E', description: 'Deep roots foundation', icon: 'üéµ', note: 'E' },
      { id: 'reggae-f', name: 'Reggae Bass F', description: 'Steppers vibe', icon: 'üéµ', note: 'F' },
      { id: 'reggae-g', name: 'Reggae Bass G', description: 'Rockers movement', icon: 'üéµ', note: 'G' },
      { id: 'reggae-a', name: 'Reggae Bass A', description: 'One drop groove', icon: 'üéµ', note: 'A' },
      { id: 'reggae-b', name: 'Reggae Bass B', description: 'Dancehall energy', icon: 'üéµ', note: 'B' },
      { id: 'dub-e', name: 'Dub Echo E', description: 'Classic dub delay', icon: 'üîä', note: 'E', dub: true },
    ];

    const generator = new BioSynthGenerator();
    const generatedSamples = new Map();
    let totalSize = 0;

    // Create sample cards
    function createSampleCards() {
      const grid = document.getElementById('samples-grid');
      sampleDefinitions.forEach(sample => {
        const card = document.createElement('div');
        card.className = 'sample-card';
        card.id = `card-${sample.id}`;
        card.innerHTML = `
          <div class="sample-name">${sample.icon} ${sample.name}</div>
          <div class="sample-info">${sample.description}</div>
          <div class="waveform" id="waveform-${sample.id}"></div>
          <div class="sample-actions">
            <button class="sample-btn" id="preview-${sample.id}" disabled>‚ñ∂Ô∏è Preview</button>
            <button class="sample-btn" id="download-${sample.id}" disabled>‚¨áÔ∏è Download</button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // Create healing frequency cards
    function createHealingCards() {
      const grid = document.getElementById('healing-grid');
      healingDefinitions.forEach(sample => {
        const card = document.createElement('div');
        card.className = 'sample-card healing';
        card.id = `card-${sample.id}`;
        card.innerHTML = `
          <div class="sample-name">${sample.icon} ${sample.name}</div>
          <div class="sample-info">${sample.description}</div>
          <div class="waveform" id="waveform-${sample.id}"></div>
          <div class="sample-actions">
            <button class="sample-btn" id="preview-${sample.id}" disabled>‚ñ∂Ô∏è Preview</button>
            <button class="sample-btn" id="download-${sample.id}" disabled>‚¨áÔ∏è Download</button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // Create reggae bass cards
    function createReggaeCards() {
      const grid = document.getElementById('reggae-grid');
      reggaeDefinitions.forEach(sample => {
        const card = document.createElement('div');
        card.className = 'sample-card reggae';
        card.id = `card-${sample.id}`;
        card.innerHTML = `
          <div class="sample-name">${sample.icon} ${sample.name}</div>
          <div class="sample-info">${sample.description}</div>
          <div class="waveform" id="waveform-${sample.id}"></div>
          <div class="sample-actions">
            <button class="sample-btn" id="preview-${sample.id}" disabled>‚ñ∂Ô∏è Preview</button>
            <button class="sample-btn" id="download-${sample.id}" disabled>‚¨áÔ∏è Download</button>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // Log to console
    function log(message, type = 'info') {
      const logDiv = document.getElementById('console-log');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.textContent = `[${timestamp}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // Update status
    function updateStatus() {
      const totalSamples = sampleDefinitions.length + healingDefinitions.length + reggaeDefinitions.length;
      document.getElementById('generated-count').textContent = `${generatedSamples.size} / ${totalSamples}`;
      document.getElementById('total-size').textContent = `${(totalSize / 1024).toFixed(1)} KB`;
      document.getElementById('download-all').disabled = generatedSamples.size === 0;
    }

    // Draw waveform
    function drawWaveform(audioData, canvasId) {
      const container = document.getElementById(canvasId);
      if (!container) return;

      const canvas = document.createElement('canvas');
      canvas.width = container.offsetWidth;
      canvas.height = 60;
      container.appendChild(canvas);

      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;

      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(0, 0, width, height);

      // Draw waveform
      ctx.strokeStyle = '#667eea';
      ctx.lineWidth = 1;
      ctx.beginPath();

      const step = Math.floor(audioData.length / width);
      for (let i = 0; i < width; i++) {
        const value = audioData[i * step] || 0;
        const y = height / 2 + (value * height / 2);
        if (i === 0) {
          ctx.moveTo(i, y);
        } else {
          ctx.lineTo(i, y);
        }
      }

      ctx.stroke();
    }

    // Generate single sample
    async function generateSample(sampleDef) {
      const card = document.getElementById(`card-${sampleDef.id}`);
      card.classList.add('generating');
      log(`Generating ${sampleDef.name}...`, 'info');

      try {
        let audioData;

        // Handle healing frequencies
        if (sampleDef.type === 'schumann') {
          audioData = generator.generateSchumann(sampleDef.freq);
        } else if (sampleDef.type === 'solfeggio') {
          audioData = generator.generateSolfeggio(sampleDef.freq);
        } else if (sampleDef.type === 'meditation') {
          audioData = generator.generateMeditationTone(sampleDef.freq, 7.83);
        }
        // Handle reggae bass
        else if (sampleDef.note) {
          audioData = generator.generateReggaeBass(sampleDef.note, 2.0, sampleDef.dub || false);
        }
        // Handle beat samples
        else {
          switch (sampleDef.id) {
            case 'kick':
              audioData = generator.generateKick();
              break;
            case 'snare':
              audioData = generator.generateSnare();
              break;
            case 'hihat':
              audioData = generator.generateHiHat();
              break;
            case 'bass-e':
              audioData = generator.generateBass(1.0, 'E', 1);
              break;
            case 'bass-g':
              audioData = generator.generateBass(1.0, 'G', 1);
              break;
            case 'bass-a':
              audioData = generator.generateBass(1.0, 'A', 1);
              break;
            case 'clap':
              audioData = generator.generateClap();
              break;
            case 'horn':
              audioData = generator.generateReggaetonHorn();
              break;
            case 'hihat-open':
              audioData = generator.generateHiHat(0.5, 0.4);
              break;
            case 'shout':
              audioData = generator.generateShout();
              break;
            case 'water':
              audioData = generator.generateWater();
              break;
            case 'electric':
              audioData = generator.generateElectric();
              break;
          }
        }

        const wavBlob = generator.audioDataToWav(audioData);
        generatedSamples.set(sampleDef.id, { blob: wavBlob, audioData, name: `${sampleDef.id}.wav` });
        totalSize += wavBlob.size;

        // Draw waveform
        drawWaveform(audioData, `waveform-${sampleDef.id}`);

        // Enable buttons
        document.getElementById(`preview-${sampleDef.id}`).disabled = false;
        document.getElementById(`download-${sampleDef.id}`).disabled = false;

        card.classList.remove('generating');
        card.classList.add('generated');

        log(`‚úÖ ${sampleDef.name} generated (${(wavBlob.size / 1024).toFixed(1)} KB)`, 'success');
        updateStatus();

        return { success: true, sample: sampleDef.id };
      } catch (error) {
        card.classList.remove('generating');
        log(`‚ùå Failed to generate ${sampleDef.name}: ${error.message}`, 'error');
        return { success: false, sample: sampleDef.id, error };
      }
    }

    // Generate all samples
    async function generateAllSamples() {
      const btn = document.getElementById('generate-all');
      btn.disabled = true;
      btn.textContent = 'Generating...';

      log('üéµ Starting batch generation...', 'info');

      // Generate beat samples
      log('ü•Å Generating beat samples...', 'info');
      for (const sampleDef of sampleDefinitions) {
        await generateSample(sampleDef);
      }

      // Generate healing frequencies
      log('üßò Generating healing frequencies...', 'info');
      for (const sampleDef of healingDefinitions) {
        await generateSample(sampleDef);
      }

      // Generate reggae bass
      log('üé∂ Generating reggae bass...', 'info');
      for (const sampleDef of reggaeDefinitions) {
        await generateSample(sampleDef);
      }

      btn.disabled = false;
      btn.textContent = 'Regenerate All Samples';
      log(`üéâ Batch generation complete! ${generatedSamples.size} samples ready.`, 'success');
    }

    // Download single sample
    function downloadSample(sampleId) {
      const sample = generatedSamples.get(sampleId);
      if (!sample) return;

      generator.downloadWav(sample.blob, sample.name);
      log(`üì• Downloaded ${sample.name}`, 'info');
    }

    // Download all samples
    function downloadAllSamples() {
      log('üì¶ Downloading all samples...', 'info');
      generatedSamples.forEach((sample, id) => {
        generator.downloadWav(sample.blob, sample.name);
      });
      log(`üì• Downloaded ${generatedSamples.size} samples`, 'success');
    }

    // Preview sample
    async function previewSample(sampleId) {
      const sample = generatedSamples.get(sampleId);
      if (!sample) return;

      log(`‚ñ∂Ô∏è Previewing ${sample.name}`, 'info');
      await generator.previewAudio(sample.audioData);
    }

    // Event listeners
    document.getElementById('generate-all').addEventListener('click', generateAllSamples);
    document.getElementById('download-all').addEventListener('click', downloadAllSamples);
    document.getElementById('clear-log').addEventListener('click', () => {
      document.getElementById('console-log').innerHTML = '';
      log('üßπ Log cleared', 'info');
    });

    // Add preview and download handlers for beat samples
    sampleDefinitions.forEach(sample => {
      document.getElementById(`preview-${sample.id}`).addEventListener('click', () => previewSample(sample.id));
      document.getElementById(`download-${sample.id}`).addEventListener('click', () => downloadSample(sample.id));
    });

    // Add preview and download handlers for healing frequencies
    healingDefinitions.forEach(sample => {
      document.getElementById(`preview-${sample.id}`).addEventListener('click', () => previewSample(sample.id));
      document.getElementById(`download-${sample.id}`).addEventListener('click', () => downloadSample(sample.id));
    });

    // Add preview and download handlers for reggae bass
    reggaeDefinitions.forEach(sample => {
      document.getElementById(`preview-${sample.id}`).addEventListener('click', () => previewSample(sample.id));
      document.getElementById(`download-${sample.id}`).addEventListener('click', () => downloadSample(sample.id));
    });

    // Initialize
    createSampleCards();
    createHealingCards();
    createReggaeCards();
    log('üß¨ Bio Synth Generator initialized', 'success');
    log('üéµ Beat samples, üßò healing frequencies, and üé∂ reggae bass ready', 'info');
    log('üí° Click "Generate All Samples" to create WAV files', 'info');
  </script>
</body>
</html>
