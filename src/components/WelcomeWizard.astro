---
/**
 * WelcomeWizard.astro
 * Onboarding wizard for new users
 *
 * Features:
 * - Multi-step wizard (6 steps)
 * - Wallet setup (connect or create)
 * - Role selection
 * - Areas of interest
 * - Assistance preferences
 * - First NFT claim
 * - Progress saved to localStorage
 */
---

<div id="welcomeWizard" class="wizard-container" style="display: none;">
  <div class="wizard-overlay" id="wizardOverlay"></div>

  <div class="wizard-modal card-retro-neon scanlines">

    <!-- Progress Bar -->
    <div class="wizard-progress">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-steps mono">
        <span class="step-indicator active" data-step="1">1</span>
        <span class="step-indicator" data-step="2">2</span>
        <span class="step-indicator" data-step="3">3</span>
        <span class="step-indicator" data-step="4">4</span>
        <span class="step-indicator" data-step="5">5</span>
        <span class="step-indicator" data-step="6">6</span>
      </div>
    </div>

    <!-- Step 1: Welcome -->
    <div class="wizard-step active" data-step="1">
      <div class="step-header">
        <div class="step-icon">üé§</div>
        <h2 class="step-title glitch">
          <span class="neon-text">WELCOME TO</span><br/>
          PURPLE POINT
        </h2>
      </div>
      <div class="step-content">
        <p class="step-description mono">
          > INITIALIZE_ONBOARDING()<br/>
          > STATUS: <span class="text-neon blink">READY</span><br/>
          <br/>
          Join the ultimate rap battle platform where you can:<br/>
          ‚Ä¢ Create beats & record raps<br/>
          ‚Ä¢ Battle other artists & earn NFTs<br/>
          ‚Ä¢ Support Kakuma refugee youth<br/>
          ‚Ä¢ Learn about sustainability<br/>
          <span class="text-cyan blink">‚ñà</span>
        </p>
        <div class="step-features">
          <div class="feature-badge">
            <span class="badge-icon">üéµ</span>
            <span class="badge-text">Music Studio</span>
          </div>
          <div class="feature-badge">
            <span class="badge-icon">‚öîÔ∏è</span>
            <span class="badge-text">Rap Battles</span>
          </div>
          <div class="feature-badge">
            <span class="badge-icon">üíé</span>
            <span class="badge-text">NFT Cards</span>
          </div>
          <div class="feature-badge">
            <span class="badge-icon">üåç</span>
            <span class="badge-text">Global Impact</span>
          </div>
        </div>
      </div>
      <div class="step-actions">
        <button class="btn-wizard btn-retro-neon" onclick="nextStep()">
          <span>LET'S GO</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
        <button class="btn-wizard-skip" onclick="skipWizard()">Skip for now</button>
      </div>
    </div>

    <!-- Step 2: Wallet Setup -->
    <div class="wizard-step" data-step="2">
      <div class="step-header">
        <div class="step-icon">üëõ</div>
        <h2 class="step-title">
          <span class="neon-text">WALLET SETUP</span>
        </h2>
      </div>
      <div class="step-content">
        <p class="step-description mono">
          Choose how to connect to Web3:<br/>
          <span class="text-cyan blink">‚ñà</span>
        </p>

        <div class="wallet-options">
          <!-- Phantom Wallet -->
          <button class="wallet-option card-retro" onclick="connectPhantom()">
            <div class="option-icon">üëª</div>
            <div class="option-info">
              <h3 class="option-title mono">PHANTOM WALLET</h3>
              <p class="option-desc">Connect your existing Phantom wallet</p>
              <div class="option-status mono" id="phantomStatus">
                <span class="status-dot"></span>
                <span>Not detected</span>
              </div>
            </div>
            <div class="option-arrow">‚Üí</div>
          </button>

          <!-- Solflare Wallet -->
          <button class="wallet-option card-retro" onclick="connectSolflare()">
            <div class="option-icon">‚òÄÔ∏è</div>
            <div class="option-info">
              <h3 class="option-title mono">SOLFLARE WALLET</h3>
              <p class="option-desc">Connect your Solflare wallet</p>
              <div class="option-status mono" id="solflareStatus">
                <span class="status-dot"></span>
                <span>Not detected</span>
              </div>
            </div>
            <div class="option-arrow">‚Üí</div>
          </button>

          <!-- Create New (Testnet) -->
          <button class="wallet-option card-retro-neon" onclick="createTestWallet()">
            <div class="option-icon">‚ú®</div>
            <div class="option-info">
              <h3 class="option-title mono">CREATE TEST WALLET</h3>
              <p class="option-desc">Get a free testnet wallet with 2 SOL to start</p>
              <div class="option-badge">
                <span class="badge-text">RECOMMENDED FOR BEGINNERS</span>
              </div>
            </div>
            <div class="option-arrow">‚Üí</div>
          </button>
        </div>

        <div id="walletConnected" class="wallet-connected" style="display: none;">
          <div class="connected-badge">
            <span class="badge-icon">‚úì</span>
            <span class="badge-text mono">WALLET CONNECTED</span>
          </div>
          <div class="wallet-address mono">
            Address: <span id="walletAddress" class="text-neon">Loading...</span>
          </div>
          <div class="wallet-balance mono">
            Balance: <span id="walletBalance" class="text-cyan">0 SOL</span>
          </div>
        </div>
      </div>
      <div class="step-actions">
        <button class="btn-wizard btn-retro" onclick="prevStep()">
          <span class="btn-arrow">‚Üê</span>
          <span>BACK</span>
        </button>
        <button class="btn-wizard btn-retro-neon" id="walletNextBtn" onclick="nextStep()" disabled>
          <span>CONTINUE</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </div>
    </div>

    <!-- Step 3: Role Selection -->
    <div class="wizard-step" data-step="3">
      <div class="step-header">
        <div class="step-icon">üé≠</div>
        <h2 class="step-title">
          <span class="neon-text">CHOOSE YOUR ROLE</span>
        </h2>
      </div>
      <div class="step-content">
        <p class="step-description mono">
          What brings you to Purple Point?<br/>
          <span class="text-muted">(You can change this later)</span><br/>
          <span class="text-cyan blink">‚ñà</span>
        </p>

        <div class="role-grid">
          <button class="role-card card-retro" data-role="rapper" onclick="selectRole('rapper')">
            <div class="role-icon">üé§</div>
            <h3 class="role-title mono">RAPPER</h3>
            <p class="role-desc">Battle others, record verses, earn NFTs</p>
            <div class="role-perks">
              <span class="perk">Access to battles</span>
              <span class="perk">Recording studio</span>
              <span class="perk">Profile cards</span>
            </div>
          </button>

          <button class="role-card card-retro" data-role="producer" onclick="selectRole('producer')">
            <div class="role-icon">üéõÔ∏è</div>
            <h3 class="role-title mono">PRODUCER</h3>
            <p class="role-desc">Create beats, sell tracks, collaborate</p>
            <div class="role-perks">
              <span class="perk">Music tools</span>
              <span class="perk">Beat marketplace</span>
              <span class="perk">Royalty splits</span>
            </div>
          </button>

          <button class="role-card card-retro" data-role="judge" onclick="selectRole('judge')">
            <div class="role-icon">‚öñÔ∏è</div>
            <h3 class="role-title mono">JUDGE</h3>
            <p class="role-desc">Vote on battles, curate content, earn rewards</p>
            <div class="role-perks">
              <span class="perk">Voting power</span>
              <span class="perk">Judge badges</span>
              <span class="perk">XP bonuses</span>
            </div>
          </button>

          <button class="role-card card-retro" data-role="fan" onclick="selectRole('fan')">
            <div class="role-icon">‚≠ê</div>
            <h3 class="role-title mono">FAN</h3>
            <p class="role-desc">Support artists, collect NFTs, enjoy music</p>
            <div class="role-perks">
              <span class="perk">Early access</span>
              <span class="perk">NFT collection</span>
              <span class="perk">Fan rewards</span>
            </div>
          </button>

          <button class="role-card card-retro" data-role="educator" onclick="selectRole('educator')">
            <div class="role-icon">üìö</div>
            <h3 class="role-title mono">EDUCATOR</h3>
            <p class="role-desc">Teach sustainability, create quizzes, mentor</p>
            <div class="role-perks">
              <span class="perk">Quiz creator</span>
              <span class="perk">Student tracking</span>
              <span class="perk">Certificates</span>
            </div>
          </button>

          <button class="role-card card-retro" data-role="engineer" onclick="selectRole('engineer')">
            <div class="role-icon">üîß</div>
            <h3 class="role-title mono">ENGINEER</h3>
            <p class="role-desc">Environmental science, water safety, city planning</p>
            <div class="role-perks">
              <span class="perk">Expert content</span>
              <span class="perk">Project showcase</span>
              <span class="perk">Collaboration</span>
            </div>
          </button>
        </div>

        <div id="roleSelected" class="role-selected" style="display: none;">
          <span class="selected-label mono">Selected:</span>
          <span id="selectedRoleName" class="selected-value neon-text">None</span>
        </div>
      </div>
      <div class="step-actions">
        <button class="btn-wizard btn-retro" onclick="prevStep()">
          <span class="btn-arrow">‚Üê</span>
          <span>BACK</span>
        </button>
        <button class="btn-wizard btn-retro-neon" id="roleNextBtn" onclick="nextStep()" disabled>
          <span>CONTINUE</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </div>
    </div>

    <!-- Step 4: Areas of Interest -->
    <div class="wizard-step" data-step="4">
      <div class="step-header">
        <div class="step-icon">üéØ</div>
        <h2 class="step-title">
          <span class="neon-text">INTERESTS</span>
        </h2>
      </div>
      <div class="step-content">
        <p class="step-description mono">
          Select your areas of interest:<br/>
          <span class="text-muted">(Choose as many as you like)</span><br/>
          <span class="text-cyan blink">‚ñà</span>
        </p>

        <div class="interests-grid">
          <label class="interest-tag" data-interest="hip-hop">
            <input type="checkbox" value="hip-hop">
            <span class="tag-icon">üé§</span>
            <span class="tag-text">Hip-Hop Culture</span>
          </label>
          <label class="interest-tag" data-interest="music-production">
            <input type="checkbox" value="music-production">
            <span class="tag-icon">üéπ</span>
            <span class="tag-text">Music Production</span>
          </label>
          <label class="interest-tag" data-interest="beatmaking">
            <input type="checkbox" value="beatmaking">
            <span class="tag-icon">ü•Å</span>
            <span class="tag-text">Beatmaking</span>
          </label>
          <label class="interest-tag" data-interest="nft-art">
            <input type="checkbox" value="nft-art">
            <span class="tag-icon">üñºÔ∏è</span>
            <span class="tag-text">NFT Art</span>
          </label>
          <label class="interest-tag" data-interest="web3">
            <input type="checkbox" value="web3">
            <span class="tag-icon">üîó</span>
            <span class="tag-text">Web3 / Blockchain</span>
          </label>
          <label class="interest-tag" data-interest="sustainability">
            <input type="checkbox" value="sustainability">
            <span class="tag-icon">üå±</span>
            <span class="tag-text">Sustainability</span>
          </label>
          <label class="interest-tag" data-interest="water-engineering">
            <input type="checkbox" value="water-engineering">
            <span class="tag-icon">üíß</span>
            <span class="tag-text">Water Engineering</span>
          </label>
          <label class="interest-tag" data-interest="urban-planning">
            <input type="checkbox" value="urban-planning">
            <span class="tag-icon">üèôÔ∏è</span>
            <span class="tag-text">Urban Planning</span>
          </label>
          <label class="interest-tag" data-interest="refugee-support">
            <input type="checkbox" value="refugee-support">
            <span class="tag-icon">üèïÔ∏è</span>
            <span class="tag-text">Refugee Support</span>
          </label>
          <label class="interest-tag" data-interest="youth-empowerment">
            <input type="checkbox" value="youth-empowerment">
            <span class="tag-icon">üí™</span>
            <span class="tag-text">Youth Empowerment</span>
          </label>
          <label class="interest-tag" data-interest="education">
            <input type="checkbox" value="education">
            <span class="tag-icon">üìñ</span>
            <span class="tag-text">Education</span>
          </label>
          <label class="interest-tag" data-interest="community">
            <input type="checkbox" value="community">
            <span class="tag-icon">ü§ù</span>
            <span class="tag-text">Community Building</span>
          </label>
        </div>

        <div class="interests-count mono">
          <span id="interestsCount">0</span> selected
        </div>
      </div>
      <div class="step-actions">
        <button class="btn-wizard btn-retro" onclick="prevStep()">
          <span class="btn-arrow">‚Üê</span>
          <span>BACK</span>
        </button>
        <button class="btn-wizard btn-retro-neon" onclick="nextStep()">
          <span>CONTINUE</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </div>
    </div>

    <!-- Step 5: Assistance Preferences -->
    <div class="wizard-step" data-step="5">
      <div class="step-header">
        <div class="step-icon">ü§ù</div>
        <h2 class="step-title">
          <span class="neon-text">COLLABORATION</span>
        </h2>
      </div>
      <div class="step-content">
        <p class="step-description mono">
          Help us connect the community:<br/>
          <span class="text-cyan blink">‚ñà</span>
        </p>

        <div class="assistance-section">
          <h3 class="assistance-title mono neon-text">I CAN OFFER:</h3>
          <div class="assistance-grid">
            <label class="assistance-tag">
              <input type="checkbox" value="mentorship">
              <span class="tag-icon">üë®‚Äçüè´</span>
              <span class="tag-text">Mentorship</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="beat-making">
              <span class="tag-icon">üéπ</span>
              <span class="tag-text">Beat Making</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="mixing-mastering">
              <span class="tag-icon">üéöÔ∏è</span>
              <span class="tag-text">Mixing/Mastering</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="lyrics-writing">
              <span class="tag-icon">‚úçÔ∏è</span>
              <span class="tag-text">Lyrics Writing</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="art-design">
              <span class="tag-icon">üé®</span>
              <span class="tag-text">Art/Design</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="technical-help">
              <span class="tag-icon">üíª</span>
              <span class="tag-text">Technical Help</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="funding">
              <span class="tag-icon">üí∞</span>
              <span class="tag-text">Funding/Grants</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="connections">
              <span class="tag-icon">üîó</span>
              <span class="tag-text">Industry Connections</span>
            </label>
          </div>
        </div>

        <div class="assistance-section">
          <h3 class="assistance-title mono text-cyan">I NEED HELP WITH:</h3>
          <div class="assistance-grid">
            <label class="assistance-tag">
              <input type="checkbox" value="need-mentorship">
              <span class="tag-icon">üôã</span>
              <span class="tag-text">Finding a Mentor</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-beats">
              <span class="tag-icon">üéµ</span>
              <span class="tag-text">Finding Beats</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-mixing">
              <span class="tag-icon">üéß</span>
              <span class="tag-text">Mixing/Mastering</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-lyrics">
              <span class="tag-icon">üìù</span>
              <span class="tag-text">Lyrics Help</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-marketing">
              <span class="tag-icon">üì¢</span>
              <span class="tag-text">Marketing</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-web3">
              <span class="tag-icon">üåê</span>
              <span class="tag-text">Web3 Setup</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-equipment">
              <span class="tag-icon">üé§</span>
              <span class="tag-text">Equipment/Software</span>
            </label>
            <label class="assistance-tag">
              <input type="checkbox" value="need-collaboration">
              <span class="tag-icon">ü§ù</span>
              <span class="tag-text">Collaboration Partners</span>
            </label>
          </div>
        </div>
      </div>
      <div class="step-actions">
        <button class="btn-wizard btn-retro" onclick="prevStep()">
          <span class="btn-arrow">‚Üê</span>
          <span>BACK</span>
        </button>
        <button class="btn-wizard btn-retro-neon" onclick="nextStep()">
          <span>CONTINUE</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </div>
    </div>

    <!-- Step 6: Claim First NFT -->
    <div class="wizard-step" data-step="6">
      <div class="step-header">
        <div class="step-icon">üéÅ</div>
        <h2 class="step-title glitch">
          <span class="neon-text">CLAIM YOUR</span><br/>
          WELCOME NFT
        </h2>
      </div>
      <div class="step-content">
        <p class="step-description mono">
          > MINTING_WELCOME_NFT()<br/>
          > STATUS: <span class="text-neon blink">READY</span><br/>
          <span class="text-cyan blink">‚ñà</span>
        </p>

        <div class="nft-preview card-retro-neon">
          <div class="nft-preview-image">
            <div class="nft-badge">WELCOME CARD</div>
            <div class="nft-icon">üé§</div>
            <div class="nft-name mono" id="nftName">Loading...</div>
            <div class="nft-traits">
              <div class="trait">
                <span class="trait-label">Role:</span>
                <span class="trait-value" id="nftRole">-</span>
              </div>
              <div class="trait">
                <span class="trait-label">Joined:</span>
                <span class="trait-value" id="nftDate">-</span>
              </div>
              <div class="trait">
                <span class="trait-label">Rarity:</span>
                <span class="trait-value text-neon">FOUNDER</span>
              </div>
            </div>
          </div>
        </div>

        <div class="nft-benefits ska-pattern">
          <h3 class="benefits-title mono">YOUR WELCOME PACKAGE:</h3>
          <ul class="benefits-list mono">
            <li>‚úì Unique Founder NFT Card</li>
            <li>‚úì 100 XP Head Start</li>
            <li>‚úì Access to All Features</li>
            <li>‚úì Community Discord Invite</li>
            <li>‚úì Early Adopter Badge</li>
          </ul>
        </div>

        <div id="mintingStatus" class="minting-status" style="display: none;">
          <div class="status-spinner"></div>
          <div class="status-text mono">MINTING ON SOLANA...</div>
        </div>

        <div id="mintSuccess" class="mint-success" style="display: none;">
          <div class="success-icon">‚úì</div>
          <div class="success-text mono neon-text">NFT CLAIMED!</div>
          <div class="success-link">
            <a href="/profile" class="btn-retro mono">VIEW IN PROFILE</a>
          </div>
        </div>
      </div>
      <div class="step-actions">
        <button class="btn-wizard btn-retro" onclick="prevStep()">
          <span class="btn-arrow">‚Üê</span>
          <span>BACK</span>
        </button>
        <button class="btn-wizard btn-retro-neon" id="claimNFTBtn" onclick="claimWelcomeNFT()">
          <span class="btn-icon">üéÅ</span>
          <span>CLAIM NFT</span>
        </button>
        <button class="btn-wizard btn-retro-neon" id="finishBtn" onclick="finishWizard()" style="display: none;">
          <span>GET STARTED</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </div>
    </div>

    <!-- Close Button -->
    <button class="wizard-close" onclick="closeWizard()" title="Close wizard">
      ‚úï
    </button>
  </div>
</div>

<script is:inline>
  // Wizard state
  let wizardState = {
    currentStep: 1,
    totalSteps: 6,
    wallet: null,
    role: null,
    interests: [],
    canOffer: [],
    needHelp: [],
    nftClaimed: false
  };

  // Check if wizard should show
  function checkWizardStatus() {
    const completed = localStorage.getItem('wizardCompleted');
    const dismissed = sessionStorage.getItem('wizardDismissed');

    if (!completed && !dismissed) {
      showWizard();
    }
  }

  // Show wizard
  function showWizard() {
    document.getElementById('welcomeWizard').style.display = 'flex';
    document.body.style.overflow = 'hidden';
    updateProgress();
  }

  // Hide wizard
  function hideWizard() {
    document.getElementById('welcomeWizard').style.display = 'none';
    document.body.style.overflow = '';
  }

  // Close wizard (dismissible)
  function closeWizard() {
    sessionStorage.setItem('wizardDismissed', 'true');
    hideWizard();
  }

  // Skip wizard
  function skipWizard() {
    if (confirm('Skip onboarding? You can restart this from your profile settings.')) {
      sessionStorage.setItem('wizardDismissed', 'true');
      hideWizard();
    }
  }

  // Update progress bar
  function updateProgress() {
    const progress = (wizardState.currentStep / wizardState.totalSteps) * 100;
    document.getElementById('progressFill').style.width = `${progress}%`;

    // Update step indicators
    document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
      const stepNum = index + 1;
      indicator.classList.toggle('active', stepNum === wizardState.currentStep);
      indicator.classList.toggle('completed', stepNum < wizardState.currentStep);
    });
  }

  // Next step
  function nextStep() {
    if (wizardState.currentStep < wizardState.totalSteps) {
      // Hide current step
      document.querySelector(`.wizard-step[data-step="${wizardState.currentStep}"]`).classList.remove('active');

      // Increment
      wizardState.currentStep++;

      // Show next step
      document.querySelector(`.wizard-step[data-step="${wizardState.currentStep}"]`).classList.add('active');

      updateProgress();
      saveProgress();
    }
  }

  // Previous step
  function prevStep() {
    if (wizardState.currentStep > 1) {
      // Hide current step
      document.querySelector(`.wizard-step[data-step="${wizardState.currentStep}"]`).classList.remove('active');

      // Decrement
      wizardState.currentStep--;

      // Show previous step
      document.querySelector(`.wizard-step[data-step="${wizardState.currentStep}"]`).classList.add('active');

      updateProgress();
    }
  }

  // Save progress
  function saveProgress() {
    localStorage.setItem('wizardProgress', JSON.stringify(wizardState));
  }

  // Load progress
  function loadProgress() {
    const saved = localStorage.getItem('wizardProgress');
    if (saved) {
      wizardState = { ...wizardState, ...JSON.parse(saved) };
    }
  }

  // Connect Phantom
  async function connectPhantom() {
    try {
      if (window.solana && window.solana.isPhantom) {
        const response = await window.solana.connect();
        handleWalletConnected(response.publicKey.toString(), 'Phantom');
      } else {
        window.open('https://phantom.app/', '_blank');
      }
    } catch (err) {
      console.error('Phantom connection failed:', err);
    }
  }

  // Connect Solflare
  async function connectSolflare() {
    try {
      if (window.solflare) {
        await window.solflare.connect();
        handleWalletConnected(window.solflare.publicKey.toString(), 'Solflare');
      } else {
        window.open('https://solflare.com/', '_blank');
      }
    } catch (err) {
      console.error('Solflare connection failed:', err);
    }
  }

  // Create test wallet
  async function createTestWallet() {
    try {
      // Simulate wallet creation (in real implementation, use Solana Web3.js)
      const fakeAddress = 'TEST' + Math.random().toString(36).substr(2, 9).toUpperCase();
      handleWalletConnected(fakeAddress, 'Test Wallet');

      // Simulate airdrop
      setTimeout(() => {
        document.getElementById('walletBalance').textContent = '2.00 SOL';
      }, 1000);
    } catch (err) {
      console.error('Test wallet creation failed:', err);
    }
  }

  // Handle wallet connected
  function handleWalletConnected(address, walletType) {
    wizardState.wallet = { address, type: walletType };

    document.getElementById('walletAddress').textContent = address.slice(0, 8) + '...' + address.slice(-6);
    document.getElementById('walletConnected').style.display = 'block';
    document.getElementById('walletNextBtn').disabled = false;

    saveProgress();
  }

  // Select role
  function selectRole(role) {
    wizardState.role = role;

    // Update button states
    document.querySelectorAll('.role-card').forEach(card => {
      card.classList.toggle('selected', card.dataset.role === role);
    });

    // Show selection
    const roleNames = {
      'rapper': 'Rapper',
      'producer': 'Producer',
      'judge': 'Judge',
      'fan': 'Fan',
      'educator': 'Educator',
      'engineer': 'Environmental Engineer'
    };

    document.getElementById('selectedRoleName').textContent = roleNames[role];
    document.getElementById('roleSelected').style.display = 'flex';
    document.getElementById('roleNextBtn').disabled = false;

    saveProgress();
  }

  // Update interests count
  function updateInterestsCount() {
    const checked = document.querySelectorAll('.interests-grid input:checked');
    wizardState.interests = Array.from(checked).map(cb => cb.value);
    document.getElementById('interestsCount').textContent = checked.length;
  }

  // Claim welcome NFT
  async function claimWelcomeNFT() {
    const btn = document.getElementById('claimNFTBtn');
    btn.disabled = true;

    document.getElementById('mintingStatus').style.display = 'flex';

    // Update NFT preview
    const roleNames = {
      'rapper': 'Rapper',
      'producer': 'Producer',
      'judge': 'Judge',
      'fan': 'Fan',
      'educator': 'Educator',
      'engineer': 'Engineer'
    };

    document.getElementById('nftName').textContent = `${roleNames[wizardState.role]} Card`;
    document.getElementById('nftRole').textContent = roleNames[wizardState.role];
    document.getElementById('nftDate').textContent = new Date().toLocaleDateString();

    // Simulate minting (replace with actual minting logic)
    setTimeout(() => {
      document.getElementById('mintingStatus').style.display = 'none';
      document.getElementById('mintSuccess').style.display = 'flex';
      document.getElementById('claimNFTBtn').style.display = 'none';
      document.getElementById('finishBtn').style.display = 'flex';

      wizardState.nftClaimed = true;
      saveProgress();

      // Award XP
      if (window.progressManager) {
        window.progressManager.awardXP(100, 'onboarding_complete', 'Completed welcome wizard');
      }
    }, 3000);
  }

  // Finish wizard
  function finishWizard() {
    localStorage.setItem('wizardCompleted', 'true');

    // Save user profile data
    const profileData = {
      wallet: wizardState.wallet,
      role: wizardState.role,
      interests: wizardState.interests,
      canOffer: wizardState.canOffer,
      needHelp: wizardState.needHelp,
      onboardedAt: new Date().toISOString()
    };

    localStorage.setItem('userProfile', JSON.stringify(profileData));

    hideWizard();

    // Show success message
    alert('Welcome to Purple Point! üéâ\n\nYour profile has been created and your welcome NFT is in your collection.');

    // Optionally redirect to profile
    // window.location.href = '/profile';
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    loadProgress();

    // Check for wallets
    if (window.solana && window.solana.isPhantom) {
      document.getElementById('phantomStatus').innerHTML = '<span class="status-dot active"></span><span>Detected</span>';
    }

    if (window.solflare) {
      document.getElementById('solflareStatus').innerHTML = '<span class="status-dot active"></span><span>Detected</span>';
    }

    // Set up interests counter
    document.querySelectorAll('.interests-grid input').forEach(cb => {
      cb.addEventListener('change', updateInterestsCount);
    });

    // Collect assistance preferences
    document.querySelectorAll('.assistance-grid input').forEach(cb => {
      cb.addEventListener('change', () => {
        const section = cb.closest('.assistance-section');
        const isOffer = section.querySelector('.assistance-title').textContent.includes('OFFER');

        if (isOffer) {
          wizardState.canOffer = Array.from(section.querySelectorAll('input:checked')).map(cb => cb.value);
        } else {
          wizardState.needHelp = Array.from(section.querySelectorAll('input:checked')).map(cb => cb.value);
        }

        saveProgress();
      });
    });

    // Check if should show wizard
    setTimeout(checkWizardStatus, 1000);
  });
</script>

<style>
  .wizard-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .wizard-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
  }

  .wizard-modal {
    position: relative;
    width: 100%;
    max-width: 900px;
    max-height: 90vh;
    overflow-y: auto;
    padding: 3rem;
    background: var(--color-near-black);
    z-index: 1;
  }

  /* Progress */
  .wizard-progress {
    margin-bottom: 3rem;
  }

  .progress-bar {
    height: 8px;
    background: var(--color-dark-gray);
    border: 2px solid var(--color-white);
    margin-bottom: 1rem;
    position: relative;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--color-neon-green);
    transition: width 0.5s ease;
    box-shadow: 0 0 20px var(--color-neon-green-glow);
  }

  .progress-steps {
    display: flex;
    justify-content: space-between;
    padding: 0 0.5rem;
  }

  .step-indicator {
    width: 36px;
    height: 36px;
    border: 2px solid var(--color-white);
    background: var(--color-black);
    color: var(--color-white);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    transition: all 0.3s ease;
  }

  .step-indicator.active {
    background: var(--color-neon-green);
    color: var(--color-black);
    box-shadow: 0 0 15px var(--color-neon-green-glow);
  }

  .step-indicator.completed {
    background: var(--color-gray);
  }

  .step-indicator.completed::after {
    content: '‚úì';
  }

  /* Steps */
  .wizard-step {
    display: none;
  }

  .wizard-step.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .step-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .step-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .step-title {
    font-size: 2.5rem;
    font-weight: 900;
    font-family: var(--font-mono);
    letter-spacing: 3px;
    line-height: 1.2;
  }

  .step-content {
    margin-bottom: 3rem;
  }

  .step-description {
    font-size: 1.125rem;
    line-height: 2;
    margin-bottom: 2rem;
  }

  /* Feature Badges */
  .step-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .feature-badge {
    padding: 1.5rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
    text-align: center;
  }

  .feature-badge .badge-icon {
    font-size: 2.5rem;
    display: block;
    margin-bottom: 0.5rem;
  }

  .feature-badge .badge-text {
    font-family: var(--font-mono);
    font-weight: 700;
    font-size: 0.875rem;
  }

  /* Wallet Options */
  .wallet-options {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .wallet-option {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.5rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    width: 100%;
  }

  .wallet-option:hover {
    transform: translateX(10px);
    border-color: var(--color-neon-green);
    box-shadow: 0 0 20px var(--color-neon-green-glow);
  }

  .wallet-option .option-icon {
    font-size: 3rem;
    flex-shrink: 0;
  }

  .wallet-option .option-info {
    flex: 1;
  }

  .wallet-option .option-title {
    font-size: 1.125rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
  }

  .wallet-option .option-desc {
    font-size: 0.875rem;
    color: var(--color-light-gray);
    margin-bottom: 0.5rem;
  }

  .wallet-option .option-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
  }

  .wallet-option .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--color-gray);
  }

  .wallet-option .status-dot.active {
    background: var(--color-neon-green);
    box-shadow: 0 0 10px var(--color-neon-green-glow);
  }

  .wallet-option .option-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: var(--color-neon-green);
    color: var(--color-black);
    font-size: 0.75rem;
    font-weight: 900;
  }

  .wallet-option .option-arrow {
    font-size: 2rem;
    color: var(--color-neon-green);
  }

  /* Wallet Connected */
  .wallet-connected {
    padding: 2rem;
    background: var(--color-black);
    border: 2px solid var(--color-neon-green);
    text-align: center;
  }

  .wallet-connected .connected-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--color-neon-green);
    color: var(--color-black);
    font-weight: 900;
    margin-bottom: 1.5rem;
  }

  .wallet-connected .wallet-address,
  .wallet-connected .wallet-balance {
    padding: 0.75rem 0;
    font-size: 0.95rem;
  }

  /* Role Grid */
  .role-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .role-card {
    padding: 2rem 1.5rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
  }

  .role-card:hover {
    transform: translateY(-8px);
    border-color: var(--color-neon-green);
    box-shadow: 0 0 20px var(--color-neon-green-glow);
  }

  .role-card.selected {
    background: var(--color-neon-green);
    color: var(--color-black);
    border-color: var(--color-neon-green);
    box-shadow: 0 0 30px var(--color-neon-green-glow);
  }

  .role-card .role-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .role-card .role-title {
    font-size: 1.25rem;
    font-weight: 900;
    margin-bottom: 0.75rem;
  }

  .role-card .role-desc {
    font-size: 0.875rem;
    margin-bottom: 1rem;
    opacity: 0.9;
  }

  .role-card .role-perks {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    font-size: 0.75rem;
    opacity: 0.8;
  }

  .role-card.selected .role-perks .perk::before {
    content: '‚úì ';
  }

  .role-selected {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--color-black);
    border: 2px solid var(--color-neon-green);
  }

  /* Interests Grid */
  .interests-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .interest-tag {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .interest-tag input {
    display: none;
  }

  .interest-tag:hover {
    border-color: var(--color-neon-green);
    transform: scale(1.05);
  }

  .interest-tag:has(input:checked) {
    background: var(--color-neon-green);
    color: var(--color-black);
    border-color: var(--color-neon-green);
    box-shadow: 0 0 15px var(--color-neon-green-glow);
  }

  .interest-tag .tag-icon {
    font-size: 1.5rem;
  }

  .interest-tag .tag-text {
    font-family: var(--font-mono);
    font-size: 0.875rem;
    font-weight: 700;
  }

  .interests-count {
    text-align: center;
    padding: 1rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
    font-size: 1.125rem;
    font-weight: 900;
  }

  /* Assistance Section */
  .assistance-section {
    margin-bottom: 2.5rem;
  }

  .assistance-title {
    font-size: 1.25rem;
    font-weight: 900;
    margin-bottom: 1.5rem;
    letter-spacing: 2px;
  }

  .assistance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 1rem;
  }

  .assistance-tag {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
  }

  .assistance-tag input {
    display: none;
  }

  .assistance-tag:hover {
    border-color: var(--color-neon-green);
    transform: translateY(-4px);
  }

  .assistance-tag:has(input:checked) {
    background: var(--color-neon-green);
    color: var(--color-black);
    border-color: var(--color-neon-green);
  }

  .assistance-tag .tag-icon {
    font-size: 2rem;
  }

  .assistance-tag .tag-text {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 700;
  }

  /* NFT Preview */
  .nft-preview {
    padding: 3rem;
    margin-bottom: 2rem;
  }

  .nft-preview-image {
    text-align: center;
    position: relative;
  }

  .nft-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--color-neon-green);
    color: var(--color-black);
    font-family: var(--font-mono);
    font-weight: 900;
    font-size: 0.875rem;
    margin-bottom: 2rem;
  }

  .nft-icon {
    font-size: 6rem;
    margin-bottom: 1.5rem;
  }

  .nft-name {
    font-size: 1.5rem;
    font-weight: 900;
    margin-bottom: 2rem;
    color: var(--color-neon-green);
  }

  .nft-traits {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 400px;
    margin: 0 auto;
  }

  .nft-traits .trait {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    background: var(--color-black);
    border: 2px solid var(--color-white);
  }

  .trait-label {
    font-family: var(--font-mono);
    color: var(--color-light-gray);
  }

  .trait-value {
    font-family: var(--font-mono);
    font-weight: 900;
  }

  /* NFT Benefits */
  .nft-benefits {
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .benefits-title {
    font-size: 1.125rem;
    font-weight: 900;
    margin-bottom: 1.5rem;
    color: var(--color-neon-green);
  }

  .benefits-list {
    list-style: none;
    padding: 0;
    line-height: 2.5;
    font-size: 1rem;
  }

  /* Minting Status */
  .minting-status {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 3rem;
  }

  .status-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--color-gray);
    border-top-color: var(--color-neon-green);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .status-text {
    font-size: 1.25rem;
    font-weight: 900;
    color: var(--color-neon-green);
  }

  /* Mint Success */
  .mint-success {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 3rem;
  }

  .success-icon {
    width: 80px;
    height: 80px;
    background: var(--color-neon-green);
    color: var(--color-black);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    font-weight: 900;
    box-shadow: 0 0 30px var(--color-neon-green-glow);
  }

  .success-text {
    font-size: 2rem;
    font-weight: 900;
  }

  /* Actions */
  .step-actions {
    display: flex;
    gap: 1rem;
    justify-content: space-between;
  }

  .btn-wizard {
    flex: 1;
    padding: 1.25rem 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    font-size: 1.125rem;
    font-weight: 900;
    text-transform: uppercase;
  }

  .btn-wizard:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-wizard .btn-arrow {
    font-size: 1.5rem;
  }

  .btn-wizard-skip {
    background: none;
    border: none;
    color: var(--color-light-gray);
    font-family: var(--font-mono);
    font-size: 0.875rem;
    cursor: pointer;
    text-decoration: underline;
    padding: 0.5rem;
  }

  .btn-wizard-skip:hover {
    color: var(--color-white);
  }

  /* Close Button */
  .wizard-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 40px;
    height: 40px;
    background: var(--color-black);
    color: var(--color-white);
    border: 2px solid var(--color-white);
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .wizard-close:hover {
    background: #dc2626;
    border-color: #dc2626;
    transform: scale(1.1);
  }

  /* Mobile */
  @media (max-width: 768px) {
    .wizard-modal {
      padding: 2rem 1.5rem;
      max-height: 95vh;
    }

    .step-title {
      font-size: 1.75rem;
    }

    .role-grid,
    .interests-grid,
    .assistance-grid {
      grid-template-columns: 1fr;
    }

    .step-actions {
      flex-direction: column;
    }

    .btn-wizard {
      width: 100%;
    }

    .step-features {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
