---
/**
 * QuickRecordButton.astro
 * Floating "Record Now" button that opens the RecordingWizard
 *
 * Features:
 * - Pulsing microphone icon
 * - Opens full recording wizard modal
 * - Shows live waveform preview when clicked
 */
---

<!-- Floating Quick Record Button -->
<button class="quick-record-btn" id="quick-record-btn" type="button" aria-label="Start Recording">
  <div class="quick-record-pulse"></div>
  <div class="quick-record-content">
    <div class="mic-icon">
      <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
      <div class="sound-waves">
        <span class="wave wave-1"></span>
        <span class="wave wave-2"></span>
        <span class="wave wave-3"></span>
      </div>
    </div>
    <span class="quick-record-text">RECORD NOW</span>
  </div>
</button>

<!-- Recording Wizard Modal -->
<div class="recording-wizard-overlay" id="recording-wizard-overlay">
  <div class="recording-wizard-modal">

    <!-- Modal Header -->
    <div class="wizard-header">
      <div class="wizard-title">
        <span class="wizard-icon">üé§</span>
        <h2>Battle Recording Studio</h2>
      </div>
      <button class="wizard-close" id="wizard-close" type="button" aria-label="Close">
        <span>‚úï</span>
      </button>
    </div>

    <!-- Progress Steps -->
    <div class="wizard-progress">
      <div class="progress-step active" data-step="1">
        <div class="step-circle">1</div>
        <span class="step-label">Record</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="2">
        <div class="step-circle">2</div>
        <span class="step-label">Add Beat</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="3">
        <div class="step-circle">3</div>
        <span class="step-label">Preview</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" data-step="4">
        <div class="step-circle">4</div>
        <span class="step-label">Submit</span>
      </div>
    </div>

    <!-- Wizard Content -->
    <div class="wizard-content">

      <!-- Step 1: Record -->
      <div class="wizard-step active" id="wizard-step-1">
        <div class="step-header">
          <h3>Step 1: Record Your Vocals</h3>
          <p class="step-hint">Hit the button and start rapping! Max 2 minutes.</p>
        </div>

        <!-- Recording + Sampler Split Layout -->
        <div class="record-sampler-layout">
          <!-- Left: Record Section -->
          <div class="record-section-main">
            <!-- Recording Status -->
            <div class="recording-status-bar">
              <div class="status-indicator" id="wizard-rec-status">
                <span class="status-light"></span>
                <span class="status-text">READY</span>
              </div>
              <div class="timer mono neon-text" id="wizard-rec-timer">00:00</div>
            </div>

            <!-- Large Waveform Display -->
            <div class="waveform-display">
              <canvas id="wizard-waveform" width="500" height="160"></canvas>
              <div class="waveform-message" id="wizard-waveform-msg">
                <span class="mic-prompt">üé§</span>
                <span>Click record to start</span>
              </div>
            </div>

            <!-- Audio Level Meter -->
            <div class="level-meter-bar">
              <div class="level-label">INPUT:</div>
              <div class="level-track">
                <div class="level-fill" id="wizard-level-bar"></div>
              </div>
              <div class="level-hint">Keep it green!</div>
            </div>

            <!-- Big Record Button -->
            <div class="record-button-container">
              <button class="big-record-btn" id="wizard-record-btn" type="button">
                <span class="record-icon">‚¨§</span>
                <span class="record-text">RECORD</span>
              </button>
              <button class="big-stop-btn" id="wizard-stop-btn" type="button" style="display: none;">
                <span class="stop-icon">‚¨õ</span>
                <span class="stop-text">STOP</span>
              </button>
            </div>

            <!-- Playback after recording -->
            <div class="playback-section" id="wizard-playback" style="display: none;">
              <audio id="wizard-audio" controls></audio>
              <div class="playback-actions">
                <button class="btn-retro" id="wizard-rerecord-btn">
                  <span>üîÑ</span> Re-record
                </button>
              </div>
            </div>
          </div>

          <!-- Right: Quick Sampler Access -->
          <div class="sampler-access-panel">
            <div class="sampler-panel-header">
              <span class="sampler-icon">üéõÔ∏è</span>
              <h4>Beat Sampler</h4>
            </div>
            <p class="sampler-hint">Create a custom beat while recording</p>
            <div class="sampler-quick-pads">
              <button class="quick-pad" data-sound="kick">KICK</button>
              <button class="quick-pad" data-sound="snare">SNARE</button>
              <button class="quick-pad" data-sound="hihat">HI-HAT</button>
              <button class="quick-pad" data-sound="bass">808</button>
            </div>
            <button class="btn-open-sampler" id="inline-sampler-btn" type="button">
              <span>üéπ</span> OPEN FULL SAMPLER
            </button>
            <div class="sampler-divider"></div>
            <p class="or-text">‚Äî or ‚Äî</p>
            <button class="btn-quick-beat" id="quick-beat-btn" type="button">
              <span>‚ö°</span> USE PRESET BEAT
            </button>
          </div>
        </div>
      </div>

      <!-- Step 2: Add Beat -->
      <div class="wizard-step" id="wizard-step-2">
        <div class="step-header">
          <h3>Step 2: Add a Backing Beat (Optional)</h3>
          <p class="step-hint">Layer your vocals over a beat, or skip to submit acapella.</p>
        </div>

        <div class="beat-options">
          <!-- Quick Beat Selection -->
          <div class="beat-option-card active" data-beat="none">
            <div class="option-icon">üé§</div>
            <div class="option-label">No Beat (Acapella)</div>
            <div class="option-desc">Submit your raw vocals</div>
          </div>

          <div class="beat-option-card" data-beat="preset">
            <div class="option-icon">üéµ</div>
            <div class="option-label">Pro Beats</div>
            <div class="option-desc">High-quality preset beats</div>
          </div>

          <div class="beat-option-card" data-beat="mybeats">
            <div class="option-icon">üíæ</div>
            <div class="option-label">My Beats</div>
            <div class="option-desc">Load saved or NFT beats</div>
          </div>

          <div class="beat-option-card" data-beat="sampler">
            <div class="option-icon">üéõÔ∏è</div>
            <div class="option-label">Open Sampler</div>
            <div class="option-desc">Create your own beat</div>
          </div>

          <div class="beat-option-card" data-beat="upload">
            <div class="option-icon">üìÅ</div>
            <div class="option-label">Upload Beat</div>
            <div class="option-desc">Use your own audio file</div>
          </div>
        </div>

        <!-- Preset Beats Section - Expanded with all styles -->
        <div class="beat-section" id="preset-beats-section" style="display: none;">
          <h4>üî• Pro Rap Beats</h4>
          <div class="beat-category-tabs">
            <button class="beat-tab active" data-category="all">All</button>
            <button class="beat-tab" data-category="trap">Trap</button>
            <button class="beat-tab" data-category="boombap">Boom Bap</button>
            <button class="beat-tab" data-category="drill">Drill</button>
            <button class="beat-tab" data-category="reggae">Reggae</button>
            <button class="beat-tab" data-category="afro">Afro</button>
          </div>
          <div class="preset-beats-grid expanded">
            <!-- Trap Beats -->
            <button class="preset-beat-btn" data-genre="trap-hard" data-category="trap">
              <span class="beat-icon">üî•</span>
              <span class="beat-name">Hard Trap 808</span>
              <span class="beat-bpm">140 BPM</span>
              <span class="beat-tag">HOT</span>
            </button>
            <button class="preset-beat-btn" data-genre="trap-melodic" data-category="trap">
              <span class="beat-icon">üéπ</span>
              <span class="beat-name">Melodic Trap</span>
              <span class="beat-bpm">130 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="trap-dark" data-category="trap">
              <span class="beat-icon">üñ§</span>
              <span class="beat-name">Dark Trap</span>
              <span class="beat-bpm">145 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="trap-bounce" data-category="trap">
              <span class="beat-icon">üí•</span>
              <span class="beat-name">Trap Bounce</span>
              <span class="beat-bpm">135 BPM</span>
            </button>

            <!-- Boom Bap Beats -->
            <button class="preset-beat-btn" data-genre="boombap-classic" data-category="boombap">
              <span class="beat-icon">üíé</span>
              <span class="beat-name">Classic Boom Bap</span>
              <span class="beat-bpm">90 BPM</span>
              <span class="beat-tag">CLASSIC</span>
            </button>
            <button class="preset-beat-btn" data-genre="boombap-jazz" data-category="boombap">
              <span class="beat-icon">üé∑</span>
              <span class="beat-name">Jazz Hop</span>
              <span class="beat-bpm">88 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="boombap-soul" data-category="boombap">
              <span class="beat-icon">‚ù§Ô∏è</span>
              <span class="beat-name">Soul Sample</span>
              <span class="beat-bpm">92 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="boombap-golden" data-category="boombap">
              <span class="beat-icon">üëë</span>
              <span class="beat-name">Golden Era</span>
              <span class="beat-bpm">95 BPM</span>
            </button>

            <!-- Drill Beats -->
            <button class="preset-beat-btn" data-genre="drill-uk" data-category="drill">
              <span class="beat-icon">üá¨üáß</span>
              <span class="beat-name">UK Drill</span>
              <span class="beat-bpm">140 BPM</span>
              <span class="beat-tag">FIRE</span>
            </button>
            <button class="preset-beat-btn" data-genre="drill-ny" data-category="drill">
              <span class="beat-icon">üóΩ</span>
              <span class="beat-name">NY Drill</span>
              <span class="beat-bpm">142 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="drill-chicago" data-category="drill">
              <span class="beat-icon">üèôÔ∏è</span>
              <span class="beat-name">Chi Drill</span>
              <span class="beat-bpm">138 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="drill-melodic" data-category="drill">
              <span class="beat-icon">üéµ</span>
              <span class="beat-name">Melodic Drill</span>
              <span class="beat-bpm">140 BPM</span>
            </button>

            <!-- Reggae Beats -->
            <button class="preset-beat-btn" data-genre="reggae-roots" data-category="reggae">
              <span class="beat-icon">üå¥</span>
              <span class="beat-name">Roots Reggae</span>
              <span class="beat-bpm">75 BPM</span>
              <span class="beat-tag">IRIE</span>
            </button>
            <button class="preset-beat-btn" data-genre="reggae-dancehall" data-category="reggae">
              <span class="beat-icon">üîä</span>
              <span class="beat-name">Dancehall</span>
              <span class="beat-bpm">95 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="reggae-dub" data-category="reggae">
              <span class="beat-icon">üéöÔ∏è</span>
              <span class="beat-name">Dub Reggae</span>
              <span class="beat-bpm">70 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="reggae-modern" data-category="reggae">
              <span class="beat-icon">üåä</span>
              <span class="beat-name">Modern Reggae</span>
              <span class="beat-bpm">85 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="reggae-raggamuffin" data-category="reggae">
              <span class="beat-icon">ü¶Å</span>
              <span class="beat-name">Raggamuffin</span>
              <span class="beat-bpm">100 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="reggae-lovers" data-category="reggae">
              <span class="beat-icon">üíö</span>
              <span class="beat-name">Lovers Rock</span>
              <span class="beat-bpm">78 BPM</span>
            </button>

            <!-- Afro Beats -->
            <button class="preset-beat-btn" data-genre="afrobeat-classic" data-category="afro">
              <span class="beat-icon">üåç</span>
              <span class="beat-name">Afrobeat</span>
              <span class="beat-bpm">100 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="afroswing" data-category="afro">
              <span class="beat-icon">üíÉ</span>
              <span class="beat-name">Afroswing</span>
              <span class="beat-bpm">105 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="amapiano" data-category="afro">
              <span class="beat-icon">üéπ</span>
              <span class="beat-name">Amapiano</span>
              <span class="beat-bpm">112 BPM</span>
              <span class="beat-tag">NEW</span>
            </button>
            <button class="preset-beat-btn" data-genre="afro-drill" data-category="afro">
              <span class="beat-icon">‚ö°</span>
              <span class="beat-name">Afro Drill</span>
              <span class="beat-bpm">130 BPM</span>
            </button>

            <!-- Other Styles -->
            <button class="preset-beat-btn" data-genre="lofi" data-category="all">
              <span class="beat-icon">üåô</span>
              <span class="beat-name">Lo-Fi Chill</span>
              <span class="beat-bpm">85 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="conscious" data-category="all">
              <span class="beat-icon">‚úä</span>
              <span class="beat-name">Conscious Vibe</span>
              <span class="beat-bpm">88 BPM</span>
            </button>
            <button class="preset-beat-btn" data-genre="freestyle" data-category="all">
              <span class="beat-icon">üéØ</span>
              <span class="beat-name">Freestyle Ready</span>
              <span class="beat-bpm">95 BPM</span>
              <span class="beat-tag">REC</span>
            </button>
            <button class="preset-beat-btn" data-genre="battle" data-category="all">
              <span class="beat-icon">‚öîÔ∏è</span>
              <span class="beat-name">Battle Beat</span>
              <span class="beat-bpm">100 BPM</span>
            </button>
          </div>
          <div class="beat-preview" id="beat-preview" style="display: none;">
            <div class="beat-preview-info">
              <span class="preview-beat-name"></span>
              <span class="preview-beat-bpm"></span>
            </div>
            <audio id="beat-audio" controls loop></audio>
            <button class="btn-select-beat" id="select-beat-btn">‚úì USE THIS BEAT</button>
          </div>
        </div>

        <!-- My Beats Section - Saved/Created/NFT Beats -->
        <div class="beat-section" id="mybeats-section" style="display: none;">
          <h4>üíæ My Beats Library</h4>
          <div class="mybeats-tabs">
            <button class="mybeat-tab active" data-source="saved">Saved Beats</button>
            <button class="mybeat-tab" data-source="created">My Creations</button>
            <button class="mybeat-tab" data-source="nft">Beat NFTs</button>
          </div>

          <!-- Saved Beats -->
          <div class="mybeats-content" id="saved-beats-content">
            <div class="mybeats-list" id="saved-beats-list">
              <div class="mybeats-empty" id="saved-beats-empty">
                <span class="empty-icon">üìÇ</span>
                <p>No saved beats yet</p>
                <p class="empty-hint">Beats you save from the sampler will appear here</p>
              </div>
            </div>
          </div>

          <!-- Created Beats -->
          <div class="mybeats-content" id="created-beats-content" style="display: none;">
            <div class="mybeats-list" id="created-beats-list">
              <div class="mybeats-empty" id="created-beats-empty">
                <span class="empty-icon">üéõÔ∏è</span>
                <p>No beats created yet</p>
                <p class="empty-hint">Use the sampler to create and save your own beats</p>
                <button class="btn-retro-neon" id="go-to-sampler-btn">
                  <span>üéπ</span> OPEN SAMPLER
                </button>
              </div>
            </div>
          </div>

          <!-- NFT Beats -->
          <div class="mybeats-content" id="nft-beats-content" style="display: none;">
            <div class="mybeats-list" id="nft-beats-list">
              <div class="mybeats-empty" id="nft-beats-empty">
                <span class="empty-icon">üé®</span>
                <p>No Beat NFTs owned</p>
                <p class="empty-hint">Beat NFTs you own will be loaded here</p>
                <button class="btn-retro" id="connect-wallet-beats-btn">
                  <span>üîó</span> CONNECT WALLET
                </button>
              </div>
            </div>
            <div class="nft-beat-info">
              <p class="nft-hint">Own a beat NFT? It will automatically appear here when your wallet is connected.</p>
            </div>
          </div>

          <!-- Beat Preview for My Beats -->
          <div class="mybeat-preview" id="mybeat-preview" style="display: none;">
            <div class="mybeat-preview-header">
              <span class="preview-beat-icon">üéµ</span>
              <div class="preview-beat-details">
                <span class="preview-mybeat-name"></span>
                <span class="preview-mybeat-source"></span>
              </div>
            </div>
            <audio id="mybeat-audio" controls loop></audio>
            <button class="btn-select-beat" id="select-mybeat-btn">‚úì USE THIS BEAT</button>
          </div>
        </div>

        <!-- Upload Beat Section -->
        <div class="beat-section" id="upload-beat-section" style="display: none;">
          <div class="upload-zone" id="beat-upload-zone">
            <input type="file" id="beat-file-input" accept="audio/*" style="display: none;" />
            <div class="upload-prompt">
              <span class="upload-icon">üì§</span>
              <p>Drop audio file or click to browse</p>
              <p class="mono text-cyan">MP3, WAV, M4A ‚Ä¢ Max 10MB</p>
              <button class="btn-retro-neon" type="button" onclick="document.getElementById('beat-file-input').click()">
                SELECT FILE
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Preview & Mix -->
      <div class="wizard-step" id="wizard-step-3">
        <div class="step-header">
          <h3>Step 3: Preview Your Track</h3>
          <p class="step-hint">Listen to your combined audio before submitting.</p>
        </div>

        <div class="preview-container">
          <!-- Combined Audio Player -->
          <div class="combined-player">
            <div class="player-waveform">
              <canvas id="preview-waveform" width="700" height="100"></canvas>
            </div>
            <div class="player-controls">
              <button class="play-btn" id="preview-play-btn" type="button">
                <span class="play-icon">‚ñ∂</span>
              </button>
              <div class="progress-track">
                <div class="progress-fill" id="preview-progress"></div>
              </div>
              <div class="time-display" id="preview-time">0:00 / 0:00</div>
            </div>
          </div>

          <!-- Volume Mixers -->
          <div class="mixer-section">
            <div class="mixer-channel">
              <label>üé§ Vocals</label>
              <input type="range" id="vocal-volume" min="0" max="100" value="100" />
              <span class="volume-value">100%</span>
            </div>
            <div class="mixer-channel" id="beat-mixer" style="display: none;">
              <label>üéµ Beat</label>
              <input type="range" id="beat-volume" min="0" max="100" value="70" />
              <span class="volume-value">70%</span>
            </div>
          </div>
        </div>

        <div class="preview-actions">
          <button class="btn-retro" id="back-to-record-btn">
            <span>üîÑ</span> Re-record Vocals
          </button>
          <button class="btn-retro" id="change-beat-btn">
            <span>üéµ</span> Change Beat
          </button>
        </div>
      </div>

      <!-- Step 4: Submit to Battle -->
      <div class="wizard-step" id="wizard-step-4">
        <div class="step-header">
          <h3>Step 4: Submit to Battle</h3>
          <p class="step-hint">Choose a battle to enter or start a new one.</p>
        </div>

        <div class="submit-options">
          <!-- Battle Selection -->
          <div class="battle-select">
            <label>Select Battle:</label>
            <select id="battle-select">
              <option value="new">üÜï Start New Battle</option>
              <option value="" disabled>‚îÄ‚îÄ Active Battles ‚îÄ‚îÄ</option>
            </select>
          </div>

          <!-- New Battle Options -->
          <div class="new-battle-options" id="new-battle-options">
            <div class="form-group">
              <label>Battle Type:</label>
              <div class="battle-type-btns">
                <button class="type-btn active" data-type="open">Open Challenge</button>
                <button class="type-btn" data-type="1v1">1v1 Private</button>
                <button class="type-btn" data-type="practice">Practice Mode</button>
              </div>
            </div>
            <div class="form-group">
              <label>Category:</label>
              <select id="battle-category">
                <option value="freestyle">Freestyle</option>
                <option value="conscious">Conscious/Lyrical</option>
                <option value="comedy">Comedy/Humor</option>
                <option value="storytelling">Storytelling</option>
              </select>
            </div>
          </div>

          <!-- Rapper Name -->
          <div class="form-group">
            <label>Your Stage Name:</label>
            <input type="text" id="rapper-name" placeholder="Enter your rapper name" maxlength="30" />
          </div>

          <!-- Terms -->
          <div class="terms-check">
            <label>
              <input type="checkbox" id="terms-agree" />
              <span>I agree to the <a href="/terms" target="_blank">battle rules</a> and confirm this is my original content</span>
            </label>
          </div>
        </div>

        <!-- Final Submit -->
        <div class="final-submit">
          <div class="submit-preview">
            <div class="preview-icon">üé§</div>
            <div class="preview-info">
              <span class="preview-duration" id="final-duration">0:00</span>
              <span class="preview-format">WebM Audio</span>
            </div>
          </div>
          <button class="submit-battle-btn" id="submit-battle-btn" type="button" disabled>
            <span class="submit-icon">üöÄ</span>
            <span class="submit-text">SUBMIT TO BATTLE</span>
          </button>
        </div>
      </div>

    </div>

    <!-- Wizard Navigation -->
    <div class="wizard-nav">
      <button class="nav-btn nav-prev" id="wizard-prev" type="button" style="visibility: hidden;">
        <span>‚óÄ</span> Back
      </button>
      <div class="nav-dots">
        <span class="nav-dot active" data-step="1"></span>
        <span class="nav-dot" data-step="2"></span>
        <span class="nav-dot" data-step="3"></span>
        <span class="nav-dot" data-step="4"></span>
      </div>
      <button class="nav-btn nav-next" id="wizard-next" type="button">
        Next <span>‚ñ∂</span>
      </button>
    </div>

  </div>
</div>

<style>
  /* Quick Record Button - Floating */
  .quick-record-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
    background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
    border: 3px solid #fff;
    border-radius: 60px;
    padding: 15px 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), 0 8px 20px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
    animation: float 3s ease-in-out infinite;
  }

  .quick-record-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 50px rgba(0, 255, 0, 0.8), 0 12px 30px rgba(0, 0, 0, 0.5);
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  .quick-record-pulse {
    position: absolute;
    inset: -8px;
    border: 3px solid #00ff00;
    border-radius: 70px;
    animation: pulse-ring 2s ease-out infinite;
    pointer-events: none;
  }

  @keyframes pulse-ring {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.3); opacity: 0; }
  }

  .quick-record-content {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .mic-icon {
    position: relative;
    color: #000;
  }

  .mic-icon svg {
    display: block;
  }

  .sound-waves {
    position: absolute;
    right: -15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 3px;
  }

  .wave {
    width: 3px;
    background: #000;
    border-radius: 2px;
    animation: sound-wave 0.5s ease-in-out infinite;
  }

  .wave-1 { height: 8px; animation-delay: 0s; }
  .wave-2 { height: 16px; animation-delay: 0.1s; }
  .wave-3 { height: 12px; animation-delay: 0.2s; }

  @keyframes sound-wave {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(0.5); }
  }

  .quick-record-text {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 14px;
    color: #000;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Modal Overlay */
  .recording-wizard-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 10000;
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    overflow-y: auto;
  }

  .recording-wizard-overlay.active {
    display: flex;
  }

  /* Modal */
  .recording-wizard-modal {
    background: #0a0a0a;
    border: 3px solid #00ff00;
    border-radius: 0;
    width: 100%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 0 60px rgba(0, 255, 0, 0.3), inset 0 0 30px rgba(0, 255, 0, 0.1);
  }

  /* Header */
  .wizard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    border-bottom: 2px solid #333;
    background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
  }

  .wizard-title {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .wizard-title h2 {
    margin: 0;
    font-family: 'Courier New', monospace;
    font-size: 20px;
    color: #00ff00;
    text-transform: uppercase;
  }

  .wizard-icon {
    font-size: 28px;
  }

  .wizard-close {
    background: transparent;
    border: 2px solid #666;
    color: #fff;
    width: 40px;
    height: 40px;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .wizard-close:hover {
    border-color: #ff0000;
    color: #ff0000;
    background: rgba(255, 0, 0, 0.1);
  }

  /* Progress Steps */
  .wizard-progress {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 25px 20px;
    background: #111;
    border-bottom: 1px solid #333;
  }

  .progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .step-circle {
    width: 36px;
    height: 36px;
    border: 2px solid #444;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    color: #666;
    background: #1a1a1a;
    transition: all 0.3s;
  }

  .progress-step.active .step-circle,
  .progress-step.completed .step-circle {
    border-color: #00ff00;
    color: #00ff00;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
  }

  .progress-step.completed .step-circle {
    background: #00ff00;
    color: #000;
  }

  .step-label {
    font-size: 11px;
    color: #666;
    text-transform: uppercase;
    font-family: 'Courier New', monospace;
  }

  .progress-step.active .step-label,
  .progress-step.completed .step-label {
    color: #00ff00;
  }

  .progress-line {
    width: 60px;
    height: 2px;
    background: #333;
    margin: 0 10px;
    margin-bottom: 20px;
  }

  /* Wizard Content */
  .wizard-content {
    padding: 30px;
    min-height: 400px;
  }

  .wizard-step {
    display: none;
  }

  .wizard-step.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .step-header {
    text-align: center;
    margin-bottom: 25px;
  }

  .step-header h3 {
    margin: 0 0 8px;
    color: #fff;
    font-size: 18px;
  }

  .step-hint {
    color: #888;
    font-size: 14px;
    margin: 0;
  }

  /* Recording Status */
  .recording-status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: #1a1a1a;
    border: 1px solid #333;
    margin-bottom: 20px;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .status-light {
    width: 12px;
    height: 12px;
    background: #444;
    border-radius: 50%;
    transition: all 0.3s;
  }

  .status-light.recording {
    background: #ff0000;
    box-shadow: 0 0 10px #ff0000;
    animation: blink 1s infinite;
  }

  .status-light.complete {
    background: #00ff00;
    box-shadow: 0 0 10px #00ff00;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .status-text {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    color: #888;
    text-transform: uppercase;
  }

  .timer {
    font-size: 28px;
    letter-spacing: 2px;
  }

  /* Waveform Display */
  .waveform-display {
    position: relative;
    background: #000;
    border: 2px solid #333;
    margin-bottom: 20px;
    overflow: hidden;
  }

  #wizard-waveform {
    display: block;
    width: 100%;
    height: 180px;
  }

  .waveform-message {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 15px;
    background: rgba(0, 0, 0, 0.7);
    color: #888;
    font-family: 'Courier New', monospace;
  }

  .waveform-message.hidden {
    display: none;
  }

  .mic-prompt {
    font-size: 48px;
    animation: bounce 2s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  /* Level Meter */
  .level-meter-bar {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    background: #1a1a1a;
    border: 1px solid #333;
    margin-bottom: 25px;
  }

  .level-label {
    font-family: 'Courier New', monospace;
    font-size: 12px;
    color: #888;
    min-width: 60px;
  }

  .level-track {
    flex: 1;
    height: 10px;
    background: #333;
    border-radius: 5px;
    overflow: hidden;
  }

  .level-fill {
    height: 100%;
    width: 0%;
    background: #ffff00;
    transition: width 0.1s, background 0.2s;
    border-radius: 5px;
  }

  .level-hint {
    font-size: 11px;
    color: #666;
  }

  /* Record + Sampler Split Layout */
  .record-sampler-layout {
    display: grid;
    grid-template-columns: 1fr 250px;
    gap: 20px;
    margin-bottom: 20px;
  }

  .record-section-main {
    flex: 1;
  }

  .sampler-access-panel {
    background: linear-gradient(180deg, #1a1a1a 0%, #111 100%);
    border: 2px solid #333;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 12px;
  }

  .sampler-panel-header {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sampler-panel-header .sampler-icon {
    font-size: 28px;
  }

  .sampler-panel-header h4 {
    margin: 0;
    color: #00ff00;
    font-size: 14px;
    text-transform: uppercase;
  }

  .sampler-hint {
    font-size: 11px;
    color: #666;
    margin: 0;
  }

  .sampler-quick-pads {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    width: 100%;
  }

  .quick-pad {
    background: #222;
    border: 2px solid #444;
    color: #888;
    padding: 12px 8px;
    font-family: 'Courier New', monospace;
    font-size: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.15s;
  }

  .quick-pad:hover {
    border-color: #00ff00;
    color: #00ff00;
    background: rgba(0, 255, 0, 0.1);
  }

  .quick-pad:active {
    transform: scale(0.95);
    background: #00ff00;
    color: #000;
  }

  .btn-open-sampler {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
    border: 2px solid #00ff00;
    color: #000;
    font-family: 'Courier New', monospace;
    font-size: 11px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
  }

  .btn-open-sampler:hover {
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
    transform: scale(1.02);
  }

  .sampler-divider {
    width: 100%;
    height: 1px;
    background: #333;
    margin: 5px 0;
  }

  .or-text {
    font-size: 11px;
    color: #555;
    margin: 0;
  }

  .btn-quick-beat {
    width: 100%;
    padding: 10px;
    background: transparent;
    border: 2px solid #ff00ff;
    color: #ff00ff;
    font-family: 'Courier New', monospace;
    font-size: 11px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
  }

  .btn-quick-beat:hover {
    background: rgba(255, 0, 255, 0.1);
    box-shadow: 0 0 15px rgba(255, 0, 255, 0.3);
  }

  /* Big Record Button */
  .record-button-container {
    display: flex;
    justify-content: center;
    margin-bottom: 25px;
  }

  .big-record-btn,
  .big-stop-btn {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px 50px;
    font-family: 'Courier New', monospace;
    font-size: 18px;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
    border: 3px solid;
    transition: all 0.3s;
  }

  .big-record-btn {
    background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
    border-color: #00ff00;
    color: #000;
  }

  .big-record-btn:hover {
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
    transform: scale(1.05);
  }

  .big-stop-btn {
    background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
    border-color: #ff0000;
    color: #fff;
    animation: pulse-stop 1s infinite;
  }

  @keyframes pulse-stop {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); }
    50% { box-shadow: 0 0 40px rgba(255, 0, 0, 0.8); }
  }

  .record-icon,
  .stop-icon {
    font-size: 24px;
  }

  /* Playback Section */
  .playback-section {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 20px;
    text-align: center;
  }

  .playback-section audio {
    width: 100%;
    margin-bottom: 15px;
  }

  .playback-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
  }

  /* Beat Options */
  .beat-options {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
    margin-bottom: 25px;
  }

  .beat-option-card {
    background: #1a1a1a;
    border: 2px solid #333;
    padding: 15px 10px;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s;
  }

  .beat-option-card:hover {
    border-color: #666;
  }

  .beat-option-card.active {
    border-color: #00ff00;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
  }

  .beat-option-card[data-beat="mybeats"].active {
    border-color: #ff00ff;
    box-shadow: 0 0 20px rgba(255, 0, 255, 0.2);
  }

  .option-icon {
    font-size: 28px;
    margin-bottom: 8px;
  }

  .option-label {
    font-weight: bold;
    color: #fff;
    margin-bottom: 4px;
    font-size: 12px;
  }

  .option-desc {
    font-size: 10px;
    color: #888;
  }

  /* Preset Beats Grid */
  .beat-section {
    background: #111;
    border: 1px solid #333;
    padding: 20px;
  }

  .beat-section h4 {
    margin: 0 0 15px;
    color: #00ff00;
    font-size: 14px;
    text-transform: uppercase;
  }

  /* Beat Category Tabs */
  .beat-category-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }

  .beat-tab {
    background: #1a1a1a;
    border: 1px solid #333;
    color: #888;
    padding: 8px 16px;
    font-family: 'Courier New', monospace;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .beat-tab:hover {
    border-color: #666;
    color: #fff;
  }

  .beat-tab.active {
    border-color: #00ff00;
    color: #00ff00;
    background: rgba(0, 255, 0, 0.1);
  }

  .preset-beats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    max-height: 300px;
    overflow-y: auto;
  }

  .preset-beats-grid.expanded {
    grid-template-columns: repeat(4, 1fr);
  }

  .preset-beat-btn {
    background: #1a1a1a;
    border: 2px solid #333;
    padding: 12px 10px;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    position: relative;
  }

  .preset-beat-btn:hover,
  .preset-beat-btn.active {
    border-color: #00ff00;
    background: #0a0a0a;
  }

  .preset-beat-btn.active {
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
  }

  .preset-beat-btn[data-hidden="true"] {
    display: none;
  }

  .beat-icon {
    font-size: 22px;
  }

  .beat-name {
    color: #fff;
    font-size: 11px;
    font-weight: bold;
    line-height: 1.2;
  }

  .beat-bpm {
    color: #888;
    font-size: 10px;
  }

  .beat-tag {
    position: absolute;
    top: 4px;
    right: 4px;
    background: #ff00ff;
    color: #fff;
    font-size: 8px;
    font-weight: bold;
    padding: 2px 5px;
  }

  .beat-preview {
    margin-top: 15px;
    background: #0a0a0a;
    border: 1px solid #333;
    padding: 15px;
  }

  .beat-preview-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .preview-beat-name {
    color: #00ff00;
    font-weight: bold;
    font-size: 13px;
  }

  .preview-beat-bpm {
    color: #888;
    font-size: 12px;
  }

  .btn-select-beat {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
    border: 2px solid #00ff00;
    color: #000;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-select-beat:hover {
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
  }

  /* My Beats Section */
  .mybeats-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
    border-bottom: 1px solid #333;
    padding-bottom: 15px;
  }

  .mybeat-tab {
    background: transparent;
    border: 1px solid #333;
    color: #888;
    padding: 10px 20px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .mybeat-tab:hover {
    border-color: #666;
    color: #fff;
  }

  .mybeat-tab.active {
    border-color: #ff00ff;
    color: #ff00ff;
    background: rgba(255, 0, 255, 0.1);
  }

  .mybeats-content {
    min-height: 150px;
  }

  .mybeats-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .mybeats-empty {
    grid-column: 1 / -1;
    text-align: center;
    padding: 30px;
    color: #666;
  }

  .mybeats-empty .empty-icon {
    font-size: 48px;
    display: block;
    margin-bottom: 15px;
    opacity: 0.5;
  }

  .mybeats-empty p {
    margin: 5px 0;
  }

  .mybeats-empty .empty-hint {
    font-size: 12px;
    color: #555;
  }

  .mybeat-item {
    background: #1a1a1a;
    border: 2px solid #333;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .mybeat-item:hover {
    border-color: #ff00ff;
  }

  .mybeat-item.active {
    border-color: #ff00ff;
    box-shadow: 0 0 15px rgba(255, 0, 255, 0.3);
  }

  .mybeat-item-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }

  .mybeat-item-icon {
    font-size: 24px;
  }

  .mybeat-item-name {
    color: #fff;
    font-weight: bold;
    font-size: 13px;
  }

  .mybeat-item-meta {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: #666;
  }

  .mybeat-item-source {
    color: #ff00ff;
  }

  .mybeat-preview {
    margin-top: 15px;
    background: #0a0a0a;
    border: 1px solid #ff00ff;
    padding: 15px;
  }

  .mybeat-preview-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
  }

  .preview-beat-icon {
    font-size: 28px;
  }

  .preview-beat-details {
    display: flex;
    flex-direction: column;
  }

  .preview-mybeat-name {
    color: #ff00ff;
    font-weight: bold;
    font-size: 14px;
  }

  .preview-mybeat-source {
    color: #888;
    font-size: 11px;
  }

  .nft-beat-info {
    margin-top: 15px;
    padding: 12px;
    background: rgba(255, 0, 255, 0.05);
    border: 1px dashed #444;
  }

  .nft-beat-info .nft-hint {
    margin: 0;
    font-size: 11px;
    color: #888;
    text-align: center;
  }

  /* Upload Zone */
  .upload-zone {
    background: #111;
    border: 2px dashed #333;
    padding: 40px;
    text-align: center;
  }

  .upload-zone:hover {
    border-color: #00ff00;
  }

  .upload-icon {
    font-size: 48px;
    margin-bottom: 15px;
  }

  /* Preview Container */
  .preview-container {
    background: #111;
    border: 1px solid #333;
    padding: 25px;
    margin-bottom: 20px;
  }

  .combined-player {
    margin-bottom: 25px;
  }

  .player-waveform {
    background: #000;
    border: 1px solid #333;
    margin-bottom: 15px;
  }

  .player-waveform canvas {
    display: block;
    width: 100%;
  }

  .player-controls {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .play-btn {
    width: 50px;
    height: 50px;
    background: #00ff00;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.2s;
  }

  .play-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
  }

  .progress-track {
    flex: 1;
    height: 8px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
  }

  .progress-fill {
    height: 100%;
    width: 0%;
    background: #00ff00;
    transition: width 0.1s;
  }

  .time-display {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    color: #888;
    min-width: 100px;
  }

  /* Mixer */
  .mixer-section {
    display: flex;
    gap: 30px;
    padding: 15px 0;
    border-top: 1px solid #333;
  }

  .mixer-channel {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .mixer-channel label {
    min-width: 80px;
    font-size: 14px;
    color: #fff;
  }

  .mixer-channel input[type="range"] {
    flex: 1;
    height: 8px;
    -webkit-appearance: none;
    background: #333;
    border-radius: 4px;
  }

  .mixer-channel input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    background: #00ff00;
    border-radius: 50%;
    cursor: pointer;
  }

  .volume-value {
    min-width: 40px;
    font-size: 12px;
    color: #888;
    text-align: right;
  }

  .preview-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
  }

  /* Submit Options */
  .submit-options {
    background: #111;
    border: 1px solid #333;
    padding: 25px;
    margin-bottom: 25px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #888;
    font-size: 13px;
    text-transform: uppercase;
  }

  .form-group select,
  .form-group input[type="text"] {
    width: 100%;
    padding: 12px 15px;
    background: #1a1a1a;
    border: 2px solid #333;
    color: #fff;
    font-family: 'Courier New', monospace;
    font-size: 14px;
  }

  .form-group select:focus,
  .form-group input[type="text"]:focus {
    border-color: #00ff00;
    outline: none;
  }

  .battle-type-btns {
    display: flex;
    gap: 10px;
  }

  .type-btn {
    flex: 1;
    padding: 12px;
    background: #1a1a1a;
    border: 2px solid #333;
    color: #888;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
  }

  .type-btn:hover {
    border-color: #666;
  }

  .type-btn.active {
    border-color: #00ff00;
    color: #00ff00;
    background: rgba(0, 255, 0, 0.1);
  }

  .terms-check {
    padding-top: 10px;
    border-top: 1px solid #333;
  }

  .terms-check label {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    cursor: pointer;
    font-size: 13px;
    color: #888;
  }

  .terms-check input[type="checkbox"] {
    margin-top: 3px;
  }

  .terms-check a {
    color: #00ff00;
  }

  /* Final Submit */
  .final-submit {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 25px;
    background: #111;
    border: 2px solid #333;
  }

  .submit-preview {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .preview-icon {
    font-size: 36px;
  }

  .preview-info {
    display: flex;
    flex-direction: column;
  }

  .preview-duration {
    font-size: 24px;
    color: #00ff00;
    font-family: 'Courier New', monospace;
  }

  .preview-format {
    font-size: 12px;
    color: #888;
  }

  .submit-battle-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 18px 35px;
    background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
    border: 3px solid #00ff00;
    color: #000;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s;
  }

  .submit-battle-btn:disabled {
    background: #333;
    border-color: #333;
    color: #666;
    cursor: not-allowed;
  }

  .submit-battle-btn:not(:disabled):hover {
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
    transform: scale(1.02);
  }

  .submit-icon {
    font-size: 20px;
  }

  /* Wizard Navigation */
  .wizard-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 30px;
    border-top: 2px solid #333;
    background: #111;
  }

  .nav-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 25px;
    background: transparent;
    border: 2px solid #333;
    color: #888;
    font-family: 'Courier New', monospace;
    cursor: pointer;
    transition: all 0.2s;
  }

  .nav-btn:hover {
    border-color: #00ff00;
    color: #00ff00;
  }

  .nav-next {
    background: #00ff00;
    border-color: #00ff00;
    color: #000;
  }

  .nav-next:hover {
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
  }

  .nav-dots {
    display: flex;
    gap: 10px;
  }

  .nav-dot {
    width: 10px;
    height: 10px;
    background: #333;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s;
  }

  .nav-dot.active {
    background: #00ff00;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .quick-record-btn {
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
    }

    .quick-record-text {
      display: none;
    }

    .recording-wizard-modal {
      max-height: 95vh;
    }

    .wizard-progress {
      padding: 15px 10px;
    }

    .progress-line {
      width: 20px;
    }

    .step-label {
      font-size: 9px;
    }

    .wizard-content {
      padding: 20px;
    }

    .record-sampler-layout {
      grid-template-columns: 1fr;
    }

    .sampler-access-panel {
      order: -1;
      padding: 15px;
    }

    .sampler-quick-pads {
      grid-template-columns: repeat(4, 1fr);
    }

    .beat-options {
      grid-template-columns: repeat(2, 1fr);
    }

    .beat-option-card:last-child {
      grid-column: 1 / -1;
    }

    .beat-category-tabs {
      justify-content: center;
    }

    .preset-beats-grid,
    .preset-beats-grid.expanded {
      grid-template-columns: repeat(2, 1fr);
    }

    .mybeats-tabs {
      flex-wrap: wrap;
      justify-content: center;
    }

    .mybeats-list {
      grid-template-columns: 1fr;
    }

    .final-submit {
      flex-direction: column;
      gap: 20px;
    }
  }

  @media (max-width: 480px) {
    .sampler-quick-pads {
      grid-template-columns: repeat(2, 1fr);
    }

    .beat-category-tabs {
      gap: 5px;
    }

    .beat-tab {
      padding: 6px 10px;
      font-size: 10px;
    }
  }

  /* Retro button styles */
  .btn-retro {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: #fff;
    border: 3px solid #000;
    color: #000;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 4px 4px 0 #000;
    transition: all 0.1s;
  }

  .btn-retro:hover {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 #000;
  }

  .btn-retro-neon {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: #00ff00;
    border: 3px solid #00ff00;
    color: #000;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    transition: all 0.2s;
  }

  .btn-retro-neon:hover {
    box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
  }

  .neon-text {
    color: #00ff00;
    text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
  }
</style>

<script>
  // Recording Wizard State
  const wizardState = {
    currentStep: 1,
    maxSteps: 4,
    vocalBlob: null,
    vocalUrl: null,
    beatBlob: null,
    beatUrl: null,
    beatType: 'none',
    mediaRecorder: null,
    audioContext: null,
    analyser: null,
    recordingStartTime: 0,
    timerInterval: null,
    animationId: null,
    isRecording: false
  };

  // DOM Elements
  const quickRecordBtn = document.getElementById('quick-record-btn');
  const wizardOverlay = document.getElementById('recording-wizard-overlay');
  const wizardClose = document.getElementById('wizard-close');
  const wizardPrev = document.getElementById('wizard-prev');
  const wizardNext = document.getElementById('wizard-next');
  const wizardRecordBtn = document.getElementById('wizard-record-btn');
  const wizardStopBtn = document.getElementById('wizard-stop-btn');

  // Open wizard
  quickRecordBtn?.addEventListener('click', () => {
    wizardOverlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  });

  // Close wizard
  wizardClose?.addEventListener('click', closeWizard);
  wizardOverlay?.addEventListener('click', (e) => {
    if (e.target === wizardOverlay) closeWizard();
  });

  function closeWizard() {
    wizardOverlay.classList.remove('active');
    document.body.style.overflow = '';
    stopRecordingIfActive();
  }

  // Navigation
  wizardPrev?.addEventListener('click', () => navigateStep(-1));
  wizardNext?.addEventListener('click', () => navigateStep(1));

  // Nav dots
  document.querySelectorAll('.nav-dot').forEach(dot => {
    dot.addEventListener('click', () => {
      const step = parseInt(dot.dataset.step);
      if (step < wizardState.currentStep || canProceedToStep(step)) {
        goToStep(step);
      }
    });
  });

  function navigateStep(direction) {
    const newStep = wizardState.currentStep + direction;
    if (newStep >= 1 && newStep <= wizardState.maxSteps) {
      if (direction > 0 && !canProceedFromCurrentStep()) {
        return;
      }
      goToStep(newStep);
    }
  }

  function canProceedFromCurrentStep() {
    switch (wizardState.currentStep) {
      case 1:
        return wizardState.vocalBlob !== null;
      case 2:
        return true; // Beat is optional
      case 3:
        return true; // Preview step
      case 4:
        return document.getElementById('terms-agree')?.checked;
      default:
        return true;
    }
  }

  function canProceedToStep(step) {
    for (let i = wizardState.currentStep; i < step; i++) {
      wizardState.currentStep = i;
      if (!canProceedFromCurrentStep()) {
        wizardState.currentStep = 1;
        return false;
      }
    }
    wizardState.currentStep = 1;
    return true;
  }

  function goToStep(step) {
    // Update state
    wizardState.currentStep = step;

    // Update step visibility
    document.querySelectorAll('.wizard-step').forEach((el, i) => {
      el.classList.toggle('active', i + 1 === step);
    });

    // Update progress
    document.querySelectorAll('.progress-step').forEach((el, i) => {
      const stepNum = i + 1;
      el.classList.toggle('active', stepNum === step);
      el.classList.toggle('completed', stepNum < step);
    });

    // Update nav dots
    document.querySelectorAll('.nav-dot').forEach((el, i) => {
      el.classList.toggle('active', i + 1 === step);
    });

    // Update nav buttons
    wizardPrev.style.visibility = step === 1 ? 'hidden' : 'visible';

    if (step === wizardState.maxSteps) {
      wizardNext.style.display = 'none';
    } else {
      wizardNext.style.display = 'flex';
      wizardNext.innerHTML = step === 3 ? 'Submit <span>‚ñ∂</span>' : 'Next <span>‚ñ∂</span>';
    }

    // Step-specific setup
    if (step === 3) {
      setupPreviewStep();
    }
    if (step === 4) {
      setupSubmitStep();
    }
  }

  // Recording functionality
  wizardRecordBtn?.addEventListener('click', startRecording);
  wizardStopBtn?.addEventListener('click', stopRecording);

  async function startRecording() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        audio: {
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });

      // Setup audio context
      wizardState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
      wizardState.analyser = wizardState.audioContext.createAnalyser();
      wizardState.analyser.fftSize = 2048;

      const microphone = wizardState.audioContext.createMediaStreamSource(stream);
      microphone.connect(wizardState.analyser);

      // Setup MediaRecorder
      const chunks = [];
      wizardState.mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'audio/webm;codecs=opus'
      });

      wizardState.mediaRecorder.ondataavailable = (e) => {
        if (e.data.size > 0) chunks.push(e.data);
      };

      wizardState.mediaRecorder.onstop = () => {
        wizardState.vocalBlob = new Blob(chunks, { type: 'audio/webm' });
        wizardState.vocalUrl = URL.createObjectURL(wizardState.vocalBlob);
        onRecordingComplete();
      };

      wizardState.mediaRecorder.start(100);
      wizardState.recordingStartTime = Date.now();
      wizardState.isRecording = true;

      // Update UI
      updateRecordingUI(true);
      startVisualization();
      startTimer();

    } catch (error) {
      console.error('Microphone error:', error);
      alert('Cannot access microphone. Please grant permission.');
    }
  }

  function stopRecording() {
    if (wizardState.mediaRecorder && wizardState.mediaRecorder.state !== 'inactive') {
      wizardState.mediaRecorder.stop();
      wizardState.mediaRecorder.stream.getTracks().forEach(track => track.stop());
      wizardState.isRecording = false;

      clearInterval(wizardState.timerInterval);
      cancelAnimationFrame(wizardState.animationId);

      if (wizardState.audioContext) {
        wizardState.audioContext.close();
      }
    }
  }

  function stopRecordingIfActive() {
    if (wizardState.isRecording) {
      stopRecording();
    }
  }

  function updateRecordingUI(isRecording) {
    const statusLight = document.querySelector('#wizard-rec-status .status-light');
    const statusText = document.querySelector('#wizard-rec-status .status-text');
    const waveformMsg = document.getElementById('wizard-waveform-msg');

    if (isRecording) {
      statusLight.classList.add('recording');
      statusText.textContent = 'RECORDING';
      waveformMsg.classList.add('hidden');
      wizardRecordBtn.style.display = 'none';
      wizardStopBtn.style.display = 'flex';
    } else {
      statusLight.classList.remove('recording');
      wizardStopBtn.style.display = 'none';
    }
  }

  function onRecordingComplete() {
    const statusLight = document.querySelector('#wizard-rec-status .status-light');
    const statusText = document.querySelector('#wizard-rec-status .status-text');
    const playbackSection = document.getElementById('wizard-playback');
    const audioElement = document.getElementById('wizard-audio');

    statusLight.classList.add('complete');
    statusText.textContent = 'COMPLETE';

    // Show playback
    playbackSection.style.display = 'block';
    audioElement.src = wizardState.vocalUrl;

    // Enable next
    wizardNext.disabled = false;
  }

  function startTimer() {
    const timerEl = document.getElementById('wizard-rec-timer');
    const maxDuration = 120; // 2 minutes

    wizardState.timerInterval = setInterval(() => {
      const elapsed = Date.now() - wizardState.recordingStartTime;
      const seconds = Math.floor(elapsed / 1000);
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;

      timerEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

      if (seconds >= maxDuration) {
        stopRecording();
      }
    }, 100);
  }

  function startVisualization() {
    const canvas = document.getElementById('wizard-waveform');
    const ctx = canvas.getContext('2d');
    const analyser = wizardState.analyser;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    const levelBar = document.getElementById('wizard-level-bar');

    function draw() {
      if (!wizardState.isRecording) return;
      wizardState.animationId = requestAnimationFrame(draw);

      analyser.getByteTimeDomainData(dataArray);

      // Clear
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw waveform
      ctx.lineWidth = 3;
      ctx.strokeStyle = '#00ff00';
      ctx.shadowColor = '#00ff00';
      ctx.shadowBlur = 10;
      ctx.beginPath();

      const sliceWidth = canvas.width / bufferLength;
      let x = 0;

      for (let i = 0; i < bufferLength; i++) {
        const v = dataArray[i] / 128.0;
        const y = v * canvas.height / 2;

        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);

        x += sliceWidth;
      }

      ctx.lineTo(canvas.width, canvas.height / 2);
      ctx.stroke();

      // Level meter
      analyser.getByteFrequencyData(dataArray);
      const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
      const percentage = (average / 255) * 100;
      levelBar.style.width = percentage + '%';
      levelBar.style.background = percentage > 80 ? '#ff0000' : percentage > 50 ? '#00ff00' : '#ffff00';
    }

    draw();
  }

  // Beat selection
  document.querySelectorAll('.beat-option-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.beat-option-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
      wizardState.beatType = card.dataset.beat;

      // Show/hide sections
      document.getElementById('preset-beats-section').style.display =
        card.dataset.beat === 'preset' ? 'block' : 'none';
      document.getElementById('upload-beat-section').style.display =
        card.dataset.beat === 'upload' ? 'block' : 'none';
      document.getElementById('mybeats-section').style.display =
        card.dataset.beat === 'mybeats' ? 'block' : 'none';

      if (card.dataset.beat === 'sampler') {
        window.open('/sampler', '_blank');
      }

      if (card.dataset.beat === 'mybeats') {
        loadMyBeats();
      }
    });
  });

  // Beat category tabs
  document.querySelectorAll('.beat-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.beat-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const category = tab.dataset.category;

      document.querySelectorAll('.preset-beat-btn').forEach(btn => {
        const btnCategory = btn.dataset.category;
        if (category === 'all' || btnCategory === category || btnCategory === 'all') {
          btn.removeAttribute('data-hidden');
        } else {
          btn.setAttribute('data-hidden', 'true');
        }
      });
    });
  });

  // Preset beat selection
  document.querySelectorAll('.preset-beat-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.preset-beat-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const beatPreview = document.getElementById('beat-preview');
      const beatAudio = document.getElementById('beat-audio');
      const previewName = beatPreview.querySelector('.preview-beat-name');
      const previewBpm = beatPreview.querySelector('.preview-beat-bpm');

      previewName.textContent = btn.querySelector('.beat-name').textContent;
      previewBpm.textContent = btn.querySelector('.beat-bpm').textContent;

      // Set beat audio source (placeholder path - adjust to actual beat files)
      const genre = btn.dataset.genre;
      beatAudio.src = `/audio/beats/${genre}.mp3`;
      beatPreview.style.display = 'block';

      wizardState.beatUrl = beatAudio.src;
      wizardState.beatType = 'preset';
    });
  });

  // Select beat button
  document.getElementById('select-beat-btn')?.addEventListener('click', () => {
    // Beat is already selected, move to next step
    navigateStep(1);
  });

  // My Beats tabs
  document.querySelectorAll('.mybeat-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.mybeat-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const source = tab.dataset.source;

      document.getElementById('saved-beats-content').style.display =
        source === 'saved' ? 'block' : 'none';
      document.getElementById('created-beats-content').style.display =
        source === 'created' ? 'block' : 'none';
      document.getElementById('nft-beats-content').style.display =
        source === 'nft' ? 'block' : 'none';

      document.getElementById('mybeat-preview').style.display = 'none';
    });
  });

  // Load my beats from storage/API
  async function loadMyBeats() {
    // Load saved beats from localStorage
    const savedBeats = JSON.parse(localStorage.getItem('savedBeats') || '[]');
    const savedBeatsList = document.getElementById('saved-beats-list');
    const savedBeatsEmpty = document.getElementById('saved-beats-empty');

    if (savedBeats.length > 0) {
      savedBeatsEmpty.style.display = 'none';
      savedBeatsList.innerHTML = savedBeats.map(beat => `
        <div class="mybeat-item" data-beat-url="${beat.url}" data-beat-name="${beat.name}">
          <div class="mybeat-item-header">
            <span class="mybeat-item-icon">üéµ</span>
            <span class="mybeat-item-name">${beat.name}</span>
          </div>
          <div class="mybeat-item-meta">
            <span>${beat.bpm || '‚Äî'} BPM</span>
            <span class="mybeat-item-source">Saved</span>
          </div>
        </div>
      `).join('');
      attachMyBeatItemHandlers();
    }

    // Load created beats from localStorage
    const createdBeats = JSON.parse(localStorage.getItem('createdBeats') || '[]');
    const createdBeatsList = document.getElementById('created-beats-list');
    const createdBeatsEmpty = document.getElementById('created-beats-empty');

    if (createdBeats.length > 0) {
      createdBeatsEmpty.style.display = 'none';
      createdBeatsList.innerHTML = createdBeats.map(beat => `
        <div class="mybeat-item" data-beat-url="${beat.url}" data-beat-name="${beat.name}">
          <div class="mybeat-item-header">
            <span class="mybeat-item-icon">üéõÔ∏è</span>
            <span class="mybeat-item-name">${beat.name}</span>
          </div>
          <div class="mybeat-item-meta">
            <span>${beat.bpm || '‚Äî'} BPM</span>
            <span class="mybeat-item-source">Created</span>
          </div>
        </div>
      `).join('');
      attachMyBeatItemHandlers();
    }

    // Load NFT beats from wallet
    const walletAddress = localStorage.getItem('connectedWallet');
    if (walletAddress) {
      try {
        const response = await fetch(`/api/nft/beats?wallet=${walletAddress}`);
        const result = await response.json();
        if (result.success && result.beats?.length > 0) {
          const nftBeatsList = document.getElementById('nft-beats-list');
          const nftBeatsEmpty = document.getElementById('nft-beats-empty');
          nftBeatsEmpty.style.display = 'none';
          nftBeatsList.innerHTML = result.beats.map(beat => `
            <div class="mybeat-item nft-beat" data-beat-url="${beat.audioUrl}" data-beat-name="${beat.name}" data-token-id="${beat.tokenId}">
              <div class="mybeat-item-header">
                <span class="mybeat-item-icon">üé®</span>
                <span class="mybeat-item-name">${beat.name}</span>
              </div>
              <div class="mybeat-item-meta">
                <span>#${beat.tokenId}</span>
                <span class="mybeat-item-source">NFT</span>
              </div>
            </div>
          `).join('');
          attachMyBeatItemHandlers();
        }
      } catch (error) {
        console.warn('Could not load NFT beats:', error);
      }
    }
  }

  function attachMyBeatItemHandlers() {
    document.querySelectorAll('.mybeat-item').forEach(item => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.mybeat-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        const preview = document.getElementById('mybeat-preview');
        const audio = document.getElementById('mybeat-audio');
        const nameEl = preview.querySelector('.preview-mybeat-name');
        const sourceEl = preview.querySelector('.preview-mybeat-source');

        nameEl.textContent = item.dataset.beatName;
        sourceEl.textContent = item.querySelector('.mybeat-item-source').textContent;
        audio.src = item.dataset.beatUrl;
        preview.style.display = 'block';

        wizardState.beatUrl = item.dataset.beatUrl;
        wizardState.beatType = 'mybeat';
      });
    });
  }

  // Select my beat button
  document.getElementById('select-mybeat-btn')?.addEventListener('click', () => {
    navigateStep(1);
  });

  // Go to sampler buttons
  document.getElementById('go-to-sampler-btn')?.addEventListener('click', () => {
    window.open('/sampler', '_blank');
  });

  document.getElementById('inline-sampler-btn')?.addEventListener('click', () => {
    window.open('/sampler?mode=battle', '_blank');
  });

  // Quick beat button (jump to step 2)
  document.getElementById('quick-beat-btn')?.addEventListener('click', () => {
    // Select preset beats option and go to step 2
    const presetCard = document.querySelector('.beat-option-card[data-beat="preset"]');
    if (presetCard) {
      document.querySelectorAll('.beat-option-card').forEach(c => c.classList.remove('active'));
      presetCard.classList.add('active');
      wizardState.beatType = 'preset';
      document.getElementById('preset-beats-section').style.display = 'block';
    }
    goToStep(2);
  });

  // Connect wallet button in NFT beats
  document.getElementById('connect-wallet-beats-btn')?.addEventListener('click', async () => {
    if (typeof window.ethereum !== 'undefined') {
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        if (accounts[0]) {
          localStorage.setItem('connectedWallet', accounts[0]);
          loadMyBeats();
        }
      } catch (error) {
        console.error('Wallet connection error:', error);
      }
    } else {
      alert('Please install a Web3 wallet like MetaMask');
    }
  });

  // Quick sampler pads (simple sound triggers)
  const quickPadSounds = {
    kick: '/audio/samples/kick.mp3',
    snare: '/audio/samples/snare.mp3',
    hihat: '/audio/samples/hihat.mp3',
    bass: '/audio/samples/808.mp3'
  };

  document.querySelectorAll('.quick-pad').forEach(pad => {
    pad.addEventListener('click', () => {
      const sound = pad.dataset.sound;
      const audio = new Audio(quickPadSounds[sound]);
      audio.volume = 0.7;
      audio.play().catch(() => {});
    });
  });

  // Re-record button
  document.getElementById('wizard-rerecord-btn')?.addEventListener('click', () => {
    wizardState.vocalBlob = null;
    wizardState.vocalUrl = null;
    document.getElementById('wizard-playback').style.display = 'none';
    document.getElementById('wizard-waveform-msg').classList.remove('hidden');
    wizardRecordBtn.style.display = 'flex';
    document.querySelector('#wizard-rec-status .status-light').classList.remove('complete');
    document.querySelector('#wizard-rec-status .status-text').textContent = 'READY';
    document.getElementById('wizard-rec-timer').textContent = '00:00';
  });

  function setupPreviewStep() {
    // Setup audio preview with vocals + beat
    const beatMixer = document.getElementById('beat-mixer');
    beatMixer.style.display = wizardState.beatType !== 'none' ? 'flex' : 'none';
  }

  function setupSubmitStep() {
    // Calculate duration
    if (wizardState.vocalUrl) {
      const audio = new Audio(wizardState.vocalUrl);
      audio.addEventListener('loadedmetadata', () => {
        const mins = Math.floor(audio.duration / 60);
        const secs = Math.floor(audio.duration % 60);
        document.getElementById('final-duration').textContent =
          `${mins}:${String(secs).padStart(2, '0')}`;
      });
    }
  }

  // Terms checkbox
  document.getElementById('terms-agree')?.addEventListener('change', (e) => {
    document.getElementById('submit-battle-btn').disabled = !e.target.checked;
  });

  // Submit button
  document.getElementById('submit-battle-btn')?.addEventListener('click', async () => {
    const btn = document.getElementById('submit-battle-btn');
    btn.disabled = true;
    btn.innerHTML = '<span class="submit-icon">‚è≥</span><span class="submit-text">UPLOADING...</span>';

    try {
      // Step 1: Upload audio file
      const formData = new FormData();
      formData.append('audio', wizardState.vocalBlob, 'recording.webm');
      formData.append('battleId', document.getElementById('battle-select').value || 'new');
      formData.append('rapperName', document.getElementById('rapper-name').value || 'Anonymous');
      formData.append('category', document.getElementById('battle-category')?.value || 'freestyle');

      const uploadResponse = await fetch('/api/audio/upload', {
        method: 'POST',
        body: formData
      });

      const uploadResult = await uploadResponse.json();

      if (!uploadResponse.ok || !uploadResult.success) {
        throw new Error(uploadResult.error || 'Upload failed');
      }

      btn.innerHTML = '<span class="submit-icon">‚è≥</span><span class="submit-text">SUBMITTING...</span>';

      // Step 2: Submit to battle (if not a new battle that was already created)
      const battleId = uploadResult.battle.id;
      const audioUrl = uploadResult.audio.url;

      // Get wallet address from localStorage or use anonymous
      const walletAddress = localStorage.getItem('connectedWallet') || 'anonymous_' + Date.now();

      // Only submit entry if joining existing battle
      if (!uploadResult.battle.isNew) {
        const submitResponse = await fetch('/api/battles/submit-entry', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            battleId: battleId,
            userWallet: walletAddress,
            round: 1,
            audioUrl: audioUrl,
            roundType: 'opener'
          })
        });

        const submitResult = await submitResponse.json();

        if (!submitResponse.ok && !submitResult.success) {
          console.warn('Battle entry submission warning:', submitResult.error);
          // Continue anyway since audio was uploaded
        }
      }

      // Success!
      btn.innerHTML = '<span class="submit-icon">‚úì</span><span class="submit-text">SUBMITTED!</span>';
      btn.style.background = '#00ff00';

      // Store battle info for redirect
      localStorage.setItem('lastBattleId', battleId);
      localStorage.setItem('lastAudioUrl', audioUrl);

      setTimeout(() => {
        closeWizard();
        window.location.href = `/rap-battle?battle=${battleId}`;
      }, 1500);

    } catch (error) {
      console.error('Submit error:', error);
      btn.innerHTML = '<span class="submit-icon">‚úó</span><span class="submit-text">ERROR - TRY AGAIN</span>';
      btn.style.background = '#ff0000';
      btn.disabled = false;

      setTimeout(() => {
        btn.innerHTML = '<span class="submit-icon">üöÄ</span><span class="submit-text">SUBMIT TO BATTLE</span>';
        btn.style.background = '';
      }, 2000);
    }
  });
</script>
