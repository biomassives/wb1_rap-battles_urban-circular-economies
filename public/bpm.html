<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Old-Skool BPM Tapper</title>
<style>
  :root{
    --bg:#0b0b0b;
    --pad:#111;
    --accent:#ff3b3b;
    --digit:#ff6b6b;
    --sub:#9aa0a6;
    --glass: rgba(255,255,255,0.03);
    --shadow: 0 8px 24px rgba(0,0,0,0.7);
    --font: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#050505 0%, #0f0f10 100%);font-family:var(--font);color:#fff;}
  .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;box-sizing:border-box;}
  .device{
    width:360px;
    max-width:94vw;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:18px;
    padding:18px;
    box-shadow:var(--shadow);
    display:grid;
    grid-template-rows:auto 1fr;
    gap:12px;
  }
  .display {
    background:linear-gradient(180deg,#060608,#0f0f11);
    padding:14px;
    border-radius:12px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    box-shadow: inset 0 -6px 18px rgba(0,0,0,0.6);
  }
  .digits {
    display:flex;
    gap:8px;
    align-items:center;
  }
  .seg {
    width:58px;height:84px;
    background:linear-gradient(180deg,#030303,#060606);
    border-radius:6px;
    display:grid;
    place-items:center;
    box-shadow:inset 0 6px 18px rgba(0,0,0,0.7);
    padding:6px;
  }
  .sevenseg{
    --w:44px; --h:72px;
    position:relative;width:var(--w);height:var(--h);
  }
  /* seven-seg segments */
  .s {
    position:absolute;
    background:linear-gradient(180deg, rgba(255,110,110,0.98), rgba(255,90,90,0.95));
    border-radius:3px;
    opacity:0.12;
    transition:opacity 160ms ease;
    box-shadow:0 2px 6px rgba(0,0,0,0.45), 0 0 18px rgba(255,80,80,0.04);
  }
  .on{opacity:1;}
  .sa{top:0; left:6px; right:6px; height:8px;}           /* a */
  .sb{top:6px; right:0; width:8px; height:28px;}         /* b */
  .sc{bottom:6px; right:0; width:8px; height:28px;}      /* c */
  .sd{bottom:0; left:6px; right:6px; height:8px;}        /* d */
  .se{bottom:6px; left:0; width:8px; height:28px;}       /* e */
  .sf{top:6px; left:0; width:8px; height:28px;}         /* f */
  .sg{top:32px; left:6px; right:6px; height:8px;}       /* g */
  .colon {
    font-family:monospace;
    color:var(--accent);
    font-size:28px;
    line-height:1;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    height:84px;
    padding:8px 0;
  }
  .label {text-align:right;color:var(--sub);font-size:12px;}
  .info {
    background:var(--pad);
    border-radius:12px;
    padding:12px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
  }
  .pad {
    background:linear-gradient(180deg,#0b0b0d,#0d0d0e);
    border-radius:12px;
    height:220px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:crosshair;
    user-select:none;
    -webkit-user-select:none;
    touch-action:manipulation;
    position:relative;
    overflow:hidden;
  }
  .pad:active{transform:scale(0.998);}
  .pad .hit {
    position:absolute; width:28px;height:28px;border-radius:50%;
    background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18), rgba(255,255,255,0.02));
    box-shadow:0 6px 18px rgba(255,80,80,0.08), inset 0 2px 6px rgba(255,255,255,0.06);
    transform:translate(-50%,-50%) scale(0.6);
    animation:pop 420ms ease forwards;
    pointer-events:none;
  }
  @keyframes pop{0%{opacity:1;transform:translate(-50%,-50%) scale(0.6);}100%{opacity:0;transform:translate(-50%,-50%) scale(1.6);}}
  .small {
    color:var(--sub);
    font-size:13px;
    display:flex;
    gap:8px;
    align-items:center;
  }
  .btns {display:flex;gap:8px;}
  button {
    background:linear-gradient(180deg,#161616,#0f0f0f);
    color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;
    box-shadow:0 6px 16px rgba(0,0,0,0.6);
  }
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--sub);font-weight:500;padding:6px 10px;}
  .meta {font-size:13px;color:var(--sub);text-align:center;margin-top:6px;}
  /* responsive */
  @media(max-width:420px){
    .seg{width:44px;height:64px}
    .sevenseg{--w:36px;--h:60px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="device" role="application" aria-label="BPM tapper">
    <div class="display" aria-hidden="false">
      <div style="display:flex;flex-direction:column;">
        <div style="display:flex;align-items:end;gap:10px;">
          <div class="digits" id="bpmDigits" aria-hidden="true">
            <div class="seg"><div class="sevenseg" data-digit="0"></div></div>
            <div class="seg"><div class="sevenseg" data-digit="0"></div></div>
            <div style="width:8px"></div>
            <div class="seg"><div class="sevenseg" data-digit="0"></div></div>
            <div class="seg"><div class="sevenseg" data-digit="0"></div></div>
          </div>
          <div class="colon" aria-hidden="true">
            <div style="opacity:1;">●</div>
            <div style="opacity:1;">●</div>
          </div>
        </div>
        <div class="label" id="bpmLabel">BPM</div>
      </div>

      <div style="width:220px;">
        <div class="info">
          <div style="display:flex;flex-direction:column;">
            <div style="font-size:18px;font-weight:700" id="bpmBig">0000</div>
            <div style="font-size:12px;color:var(--sub)">Avg (5s): <span id="avg5">—</span> BPM</div>
          </div>
          <div style="text-align:right;">
            <div class="small">Last interval: <strong id="lastMs">—</strong> ms</div>
            <div style="height:8px"></div>
            <div class="small">Beats: <strong id="count">0</strong></div>
          </div>
        </div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:10px;">
      <div id="pad" class="pad" role="button" tabindex="0" aria-label="Tap pad to register beats (spacebar also works)">
        <div style="text-align:center;color:var(--sub)">
          <div style="font-size:18px;font-weight:600">TAP HERE</div>
          <div style="font-size:13px;margin-top:6px">Click or tap repeatedly to measure BPM</div>
        </div>
      </div>

      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div class="small">Status: <strong id="status">waiting</strong></div>
        <div class="btns">
          <button id="clearBtn" class="ghost">Clear</button>
          <button id="exportBtn">Export</button>
        </div>
      </div>

      <div class="meta">Spacebar also registers a beat. Tap cadence is averaged over a sliding 5-second window.</div>
    </div>
  </div>
</div>

<script>
/* Old-Skool BPM Tapper
   - Records timestamps on tap/click/spacebar
   - Computes intervals between consecutive taps
   - Maintains a sliding 5-second window: only intervals whose timestamp (end time) falls within last 5000ms are used
   - Displays instantaneous BPM from last interval and averaged BPM over the 5s window (converted from intervals)
*/

(function(){
  const pad = document.getElementById('pad');
  const clearBtn = document.getElementById('clearBtn');
  const exportBtn = document.getElementById('exportBtn');
  const statusEl = document.getElementById('status');
  const bpmBig = document.getElementById('bpmBig');
  const avg5El = document.getElementById('avg5');
  const lastMsEl = document.getElementById('lastMs');
  const countEl = document.getElementById('count');
  const bpmDigits = document.getElementById('bpmDigits');

  // seven segment mapping for digits 0-9, segments a-g
  const segMap = {
    0: ['a','b','c','d','e','f'],
    1: ['b','c'],
    2: ['a','b','g','e','d'],
    3: ['a','b','g','c','d'],
    4: ['f','g','b','c'],
    5: ['a','f','g','c','d'],
    6: ['a','f','e','d','c','g'],
    7: ['a','b','c'],
    8: ['a','b','c','d','e','f','g'],
    9: ['a','b','c','d','f','g']
  };

  // Create seven segment structure for each .sevenseg element
  function buildSevenSeg(elem){
    elem.innerHTML = '';
    const segs = ['sa','sb','sc','sd','se','sf','sg'];
    for(let s of segs){
      const d = document.createElement('div');
      d.className = 's ' + s;
      elem.appendChild(d);
    }
  }
  document.querySelectorAll('.sevenseg').forEach(buildSevenSeg);

  function setDigit(elem, n){
    const segs = ['sa','sb','sc','sd','se','sf','sg'];
    const want = segMap[n] || [];
    segs.forEach(sClass=>{
      const node = elem.querySelector('.' + sClass);
      if(!node) return;
      const segLetter = sClass.substring(1); // 'a'..'g'
      if(want.includes(segLetter)) node.classList.add('on');
      else node.classList.remove('on');
    });
  }

  // Format BPM into four digits and set seven-seg
  function showBpmDigits(n){
    const v = Math.round(n);
    const s = ('0000' + v).slice(-4);
    const segElems = document.querySelectorAll('.sevenseg');
    for(let i=0;i<4;i++){
      setDigit(segElems[i], parseInt(s[i],10));
    }
    bpmBig.textContent = s;
  }

  // Data: list of timestamps (ms)
  let taps = []; // store timestamps in ms
  function now(){ return performance.now(); }

  function registerTap(x,y){
    const t = now();
    taps.push(t);
    // visual ripple
    const hit = document.createElement('div');
    hit.className='hit';
    hit.style.left = (x !== undefined ? x + 'px' : '50%');
    hit.style.top = (y !== undefined ? y + 'px' : '50%');
    pad.appendChild(hit);
    setTimeout(()=>hit.remove(),450);

    compute();
  }

  function compute(){
    const t = now();
    // compute intervals array as objects {end, interval}
    const intervals = [];
    for(let i=1;i<taps.length;i++){
      intervals.push({end:taps[i], interval: taps[i] - taps[i-1]});
    }

    // keep only intervals whose end is within last 5000ms
    const windowMs = 5000;
    const recent = intervals.filter(it => (t - it.end) <= windowMs);

    const countBeats = taps.length;
    countEl.textContent = countBeats;

    if(recent.length === 0){
      statusEl.textContent = 'waiting';
      avg5El.textContent = '—';
      lastMsEl.textContent = '—';
      showBpmDigits(0);
      return;
    }

    statusEl.textContent = 'tapping';

    // last interval = most recent interval overall (not just within window) if exists
    const lastInterval = intervals.length ? intervals[intervals.length -1].interval : null;
    lastMsEl.textContent = lastInterval ? Math.round(lastInterval) : '—';

    // Convert intervals to instantaneous BPM: bpm = 60000 / ms
    const bpms = recent.map(it => 60000 / it.interval);
    // Average by arithmetic mean
    const avgBpm = bpms.reduce((a,b)=>a+b,0)/bpms.length;

    avg5El.textContent = Math.round(avgBpm);
    showBpmDigits(avgBpm);
  }

  // keep taps list trimmed (older than some large horizon) to avoid growth
  function trimTaps(){
    const horizon = 60000; // keep last minute
    const t = now();
    taps = taps.filter(ts => (t - ts) <= horizon);
  }

  // pad event handlers
  pad.addEventListener('pointerdown', (ev) => {
    ev.preventDefault();
    const rect = pad.getBoundingClientRect();
    const x = ev.clientX - rect.left;
    const y = ev.clientY - rect.top;
    registerTap(x, y);
    trimTaps();
  });

  // keyboard: spacebar registers tap
  window.addEventListener('keydown', (ev)=>{
    if(ev.code === 'Space'){
      ev.preventDefault();
      // center visual
      const rect = pad.getBoundingClientRect();
      registerTap(rect.width/2, rect.height/2);
      trimTaps();
    }
    if(ev.key === 'Escape'){
      clearAll();
    }
  });

  // Clear/export
  function clearAll(){
    taps = [];
    compute();
    statusEl.textContent = 'cleared';
  }
  clearBtn.addEventListener('click', clearAll);

  exportBtn.addEventListener('click', ()=>{
    if(taps.length === 0) return alert('No taps to export.');
    const data = {
      generated: new Date().toISOString(),
      taps: taps.slice()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'bpm_taps.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // Periodic recompute to drop out-of-window intervals
  setInterval(()=>{
    compute();
    trimTaps();
  }, 200);

  // initialize visuals
  compute();

  // Accessibility: focusable pad triggers on Enter/Space
  pad.addEventListener('keydown', (ev)=>{
    if(ev.code === 'Space' || ev.code === 'Enter'){
      ev.preventDefault();
      const rect = pad.getBoundingClientRect();
      registerTap(rect.width/2, rect.height/2);
      trimTaps();
    }
  });

})();
</script>
</body>
</html>
<! 
Cornell West - 4 q at the center of his own calling
that have to do with our humanity.

how does integrity face oppression?
how does decency face insult?
how does courage face brute force
how does honesty face deception?
>
